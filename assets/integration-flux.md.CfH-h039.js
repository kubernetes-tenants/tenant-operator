import{_ as c,C as i,c as E,o as a,a3 as l,b as p,w as n,a as o,G as r,a9 as t}from"./chunks/framework.DddEBHwx.js";const C=JSON.parse('{"title":"Flux Integration Guide","description":"","frontmatter":{},"headers":[],"relativePath":"integration-flux.md","filePath":"integration-flux.md","lastUpdated":1763437307000}'),u={name:"integration-flux.md"};function y(b,s,m,d,F,h){const e=i("Mermaid");return a(),E("div",null,[s[2]||(s[2]=l('<h1 id="flux-integration-guide" tabindex="-1">Flux Integration Guide <a class="header-anchor" href="#flux-integration-guide" aria-label="Permalink to &quot;Flux Integration Guide&quot;">‚Äã</a></h1><div class="info custom-block"><p class="custom-block-title">Multi-Tenancy Example</p><p>This guide uses <strong>Multi-Tenancy</strong> (SaaS application with multiple customers/nodes) as an example, which is the most common use case for Lynq. The pattern shown here can be adapted for any GitOps-driven multi-node deployment scenario.</p></div><p>This guide shows how to integrate Lynq with Flux for GitOps-based application deployment per node.</p><nav class="table-of-contents"><ul><li><a href="#overview">Overview</a><ul><li><a href="#key-benefits">Key Benefits</a></li><li><a href="#use-cases">Use Cases</a></li></ul></li><li><a href="#prerequisites">Prerequisites</a></li><li><a href="#installation">Installation</a><ul><li><a href="#_1-install-flux">1. Install Flux</a></li><li><a href="#_2-prepare-git-repository">2. Prepare Git Repository</a></li><li><a href="#_3-create-git-credentials-if-private-repository">3. Create Git Credentials (if private repository)</a></li></ul></li><li><a href="#basic-example-gitops-deployment-per-node">Basic Example: GitOps Deployment per Node</a></li><li><a href="#advanced-examples">Advanced Examples</a><ul><li><a href="#example-1-helm-chart-deployment-per-node">Example 1: Helm Chart Deployment per Node</a></li><li><a href="#example-2-multi-source-kustomization">Example 2: Multi-Source Kustomization</a></li><li><a href="#example-3-oci-artifact-deployment">Example 3: OCI Artifact Deployment</a></li><li><a href="#example-4-image-automation">Example 4: Image Automation</a></li></ul></li><li><a href="#how-it-works">How It Works</a><ul><li><a href="#workflow">Workflow</a></li><li><a href="#reconciliation-loop">Reconciliation Loop</a></li><li><a href="#state-management">State Management</a></li></ul></li><li><a href="#best-practices">Best Practices</a><ul><li><a href="#_1-use-branch-per-node-strategy">1. Use Branch-per-Node Strategy</a></li><li><a href="#_2-implement-progressive-rollouts">2. Implement Progressive Rollouts</a></li><li><a href="#_3-use-kustomize-for-environment-specific-configuration">3. Use Kustomize for Environment-Specific Configuration</a></li><li><a href="#_4-set-appropriate-sync-intervals">4. Set Appropriate Sync Intervals</a></li><li><a href="#_5-use-health-checks">5. Use Health Checks</a></li><li><a href="#_6-use-webhook-receivers-for-instant-updates">6. Use Webhook Receivers for Instant Updates</a></li><li><a href="#_7-monitor-flux-resources">7. Monitor Flux Resources</a></li></ul></li><li><a href="#troubleshooting">Troubleshooting</a><ul><li><a href="#gitrepository-sync-fails">GitRepository Sync Fails</a></li><li><a href="#kustomization-apply-fails">Kustomization Apply Fails</a></li><li><a href="#health-check-timeout">Health Check Timeout</a></li><li><a href="#suspended-flux-resources">Suspended Flux Resources</a></li><li><a href="#post-build-substitution-fails">Post-Build Substitution Fails</a></li></ul></li><li><a href="#integration-with-other-tools">Integration with Other Tools</a><ul><li><a href="#sealed-secrets">Sealed Secrets</a></li><li><a href="#external-secrets-operator">External Secrets Operator</a></li><li><a href="#prometheus-monitoring">Prometheus Monitoring</a></li></ul></li><li><a href="#performance-considerations">Performance Considerations</a><ul><li><a href="#optimize-git-repository-structure">Optimize Git Repository Structure</a></li><li><a href="#reduce-api-load">Reduce API Load</a></li><li><a href="#scale-flux-controllers">Scale Flux Controllers</a></li></ul></li><li><a href="#see-also">See Also</a></li></ul></nav><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">‚Äã</a></h2><p><strong>Flux</strong> is a GitOps toolkit for Kubernetes that keeps clusters in sync with configuration sources (Git repositories, Helm repositories, OCI artifacts). When integrated with Lynq, each node can automatically deploy and manage its own set of applications and configurations using GitOps principles.</p>',6)),(a(),p(t,null,{default:n(()=>[r(e,{id:"mermaid-20",class:"mermaid my-class",graph:"flowchart%20LR%0A%20%20%20%20Node%5B%22LynqNode%20CR%22%5D%0A%20%20%20%20Template%5B%22Flux%3Cbr%2F%3Emanifests%22%5D%0A%20%20%20%20Flux%5B%22Flux%20Controllers%3Cbr%2F%3E(GitRepository%2C%20Kustomization)%22%5D%0A%20%20%20%20Git%5B%22Git%20Repository%3Cbr%2F%3E(Source%20of%20Truth)%22%5D%0A%20%20%20%20Apps%5B%22Applications%3Cbr%2F%3E(Deployed%20per%20node)%22%5D%0A%0A%20%20%20%20Node%20--%3E%20Template%20--%3E%20Flux%20--%3E%20Git%20--%3E%20Apps%0A%0A%20%20%20%20classDef%20node%20fill%3A%23e3f2fd%2Cstroke%3A%2364b5f6%2Cstroke-width%3A2px%3B%0A%20%20%20%20class%20Node%20node%3B%0A%20%20%20%20classDef%20flux%20fill%3A%23e8f5e9%2Cstroke%3A%2381c784%2Cstroke-width%3A2px%3B%0A%20%20%20%20class%20Template%2CFlux%20flux%3B%0A%20%20%20%20classDef%20git%20fill%3A%23fff3e0%2Cstroke%3A%23ffb74d%2Cstroke-width%3A2px%3B%0A%20%20%20%20class%20Git%20git%3B%0A%20%20%20%20classDef%20apps%20fill%3A%23fce4ec%2Cstroke%3A%23f48fb1%2Cstroke-width%3A2px%3B%0A%20%20%20%20class%20Apps%20apps%3B%0A"})]),fallback:n(()=>[...s[0]||(s[0]=[o(" Loading... ",-1)])]),_:1})),s[3]||(s[3]=l(`<h3 id="key-benefits" tabindex="-1">Key Benefits <a class="header-anchor" href="#key-benefits" aria-label="Permalink to &quot;Key Benefits&quot;">‚Äã</a></h3><p><strong>GitOps-Driven Deployment</strong>:</p><ul><li>üîÑ <strong>Single Source of Truth</strong>: All configuration stored in Git</li><li>üöÄ <strong>Automated Sync</strong>: Flux continuously reconciles desired state</li><li>üìú <strong>Audit Trail</strong>: Git history provides complete deployment history</li><li>üîí <strong>Security</strong>: Git-based access control and approval workflows</li><li>‚ö° <strong>Fast Rollback</strong>: Git revert for instant rollback</li></ul><p><strong>Per-Node Isolation</strong>:</p><ul><li>üéØ <strong>Isolated GitRepository</strong>: Each node can track different branches/paths</li><li>üì¶ <strong>Independent Kustomizations</strong>: Node-specific overlays and patches</li><li>üîê <strong>Separate Secrets</strong>: Node-specific secret management</li><li>üé® <strong>Custom Helm Values</strong>: Per-node Helm chart customization</li></ul><p><strong>Flux Resource Types</strong>:</p><ul><li><strong>GitRepository</strong>: Track Git repositories as deployment sources</li><li><strong>OCIRepository</strong>: Use OCI artifacts (container images) as sources</li><li><strong>HelmRepository</strong>: Track Helm chart repositories</li><li><strong>HelmRelease</strong>: Deploy Helm charts with custom values</li><li><strong>Kustomization</strong>: Apply Kustomize overlays and transformations</li><li><strong>ImageRepository/ImagePolicy</strong>: Automate image updates</li></ul><h3 id="use-cases" tabindex="-1">Use Cases <a class="header-anchor" href="#use-cases" aria-label="Permalink to &quot;Use Cases&quot;">‚Äã</a></h3><h4 id="multi-tenant-saas-application" tabindex="-1">Multi-Tenant SaaS Application <a class="header-anchor" href="#multi-tenant-saas-application" aria-label="Permalink to &quot;Multi-Tenant SaaS Application&quot;">‚Äã</a></h4><ul><li><strong>Separate Git Branches</strong>: Each node deploys from its own branch (e.g., <code>customers/acme</code>, <code>customers/beta</code>)</li><li><strong>Kustomize Overlays</strong>: Base configuration + per-node overlays</li><li><strong>Feature Flags</strong>: Node-specific feature toggles via ConfigMaps</li><li><strong>Progressive Rollouts</strong>: Deploy to staging nodes first, then production</li></ul><h4 id="microservices-architecture" tabindex="-1">Microservices Architecture <a class="header-anchor" href="#microservices-architecture" aria-label="Permalink to &quot;Microservices Architecture&quot;">‚Äã</a></h4><ul><li><strong>Service Mesh per Node</strong>: Istio/Linkerd configurations per node</li><li><strong>API Gateway</strong>: Node-specific ingress routing</li><li><strong>Service Discovery</strong>: Consul/Eureka per node</li><li><strong>Monitoring Stack</strong>: Prometheus + Grafana per node</li></ul><h4 id="multi-region-deployment" tabindex="-1">Multi-Region Deployment <a class="header-anchor" href="#multi-region-deployment" aria-label="Permalink to &quot;Multi-Region Deployment&quot;">‚Äã</a></h4><ul><li><strong>Region-Specific Configurations</strong>: Different configs per region</li><li><strong>Compliance Requirements</strong>: GDPR, HIPAA per node</li><li><strong>Geo-Distributed Applications</strong>: Edge deployments</li><li><strong>Disaster Recovery</strong>: Multi-region failover configurations</li></ul><h4 id="development-environments" tabindex="-1">Development Environments <a class="header-anchor" href="#development-environments" aria-label="Permalink to &quot;Development Environments&quot;">‚Äã</a></h4><ul><li><strong>Developer Sandboxes</strong>: Isolated environments per developer</li><li><strong>PR Previews</strong>: Ephemeral environments per pull request</li><li><strong>Testing Environments</strong>: Integration test environments per feature branch</li></ul><h2 id="prerequisites" tabindex="-1">Prerequisites <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;Prerequisites&quot;">‚Äã</a></h2><div class="info custom-block"><p class="custom-block-title">Requirements</p><ul><li>Kubernetes cluster v1.20+</li><li>Lynq installed</li><li>Git repository for storing manifests</li><li>Flux CLI v2.0+ (optional, for installation)</li></ul></div><h2 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to &quot;Installation&quot;">‚Äã</a></h2><h3 id="_1-install-flux" tabindex="-1">1. Install Flux <a class="header-anchor" href="#_1-install-flux" aria-label="Permalink to &quot;1. Install Flux&quot;">‚Äã</a></h3><p>Flux provides multiple installation methods. Choose the one that fits your workflow.</p><h4 id="installation-via-flux-cli-recommended" tabindex="-1">Installation via Flux CLI (Recommended) <a class="header-anchor" href="#installation-via-flux-cli-recommended" aria-label="Permalink to &quot;Installation via Flux CLI (Recommended)&quot;">‚Äã</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Install Flux CLI</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#79B8FF;"> -s</span><span style="color:#9ECBFF;"> https://fluxcd.io/install.sh</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> sudo</span><span style="color:#9ECBFF;"> bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Bootstrap Flux (creates GitOps repository structure)</span></span>
<span class="line"><span style="color:#B392F0;">flux</span><span style="color:#9ECBFF;"> bootstrap</span><span style="color:#9ECBFF;"> github</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --owner=myorg</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --repository=fleet-infra</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --branch=main</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --path=clusters/my-cluster</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --personal</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Or bootstrap with GitLab</span></span>
<span class="line"><span style="color:#B392F0;">flux</span><span style="color:#9ECBFF;"> bootstrap</span><span style="color:#9ECBFF;"> gitlab</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --owner=myorg</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --repository=fleet-infra</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --branch=main</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --path=clusters/my-cluster</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --personal</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="installation-via-manifests" tabindex="-1">Installation via Manifests <a class="header-anchor" href="#installation-via-manifests" aria-label="Permalink to &quot;Installation via Manifests&quot;">‚Äã</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Install Flux controllers directly</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> apply</span><span style="color:#79B8FF;"> -f</span><span style="color:#9ECBFF;"> https://github.com/fluxcd/flux2/releases/latest/download/install.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="verify-installation" tabindex="-1">Verify Installation <a class="header-anchor" href="#verify-installation" aria-label="Permalink to &quot;Verify Installation&quot;">‚Äã</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Check Flux controllers</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> pods</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> flux-system</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check Flux CRDs</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> crd</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> grep</span><span style="color:#9ECBFF;"> fluxcd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check Flux version</span></span>
<span class="line"><span style="color:#B392F0;">flux</span><span style="color:#79B8FF;"> --version</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check cluster status</span></span>
<span class="line"><span style="color:#B392F0;">flux</span><span style="color:#9ECBFF;"> check</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_2-prepare-git-repository" tabindex="-1">2. Prepare Git Repository <a class="header-anchor" href="#_2-prepare-git-repository" aria-label="Permalink to &quot;2. Prepare Git Repository&quot;">‚Äã</a></h3><p>Create a Git repository structure for your node configurations:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">my-fleet/</span></span>
<span class="line"><span style="color:#B392F0;">‚îú‚îÄ‚îÄ</span><span style="color:#9ECBFF;"> base/</span><span style="color:#6A737D;">                    # Shared base configurations</span></span>
<span class="line"><span style="color:#B392F0;">‚îÇ</span><span style="color:#9ECBFF;">   ‚îú‚îÄ‚îÄ</span><span style="color:#9ECBFF;"> deployment.yaml</span></span>
<span class="line"><span style="color:#B392F0;">‚îÇ</span><span style="color:#9ECBFF;">   ‚îú‚îÄ‚îÄ</span><span style="color:#9ECBFF;"> service.yaml</span></span>
<span class="line"><span style="color:#B392F0;">‚îÇ</span><span style="color:#9ECBFF;">   ‚îî‚îÄ‚îÄ</span><span style="color:#9ECBFF;"> kustomization.yaml</span></span>
<span class="line"><span style="color:#B392F0;">‚îú‚îÄ‚îÄ</span><span style="color:#9ECBFF;"> nodes/</span><span style="color:#6A737D;">                   # Per-node overlays</span></span>
<span class="line"><span style="color:#B392F0;">‚îÇ</span><span style="color:#9ECBFF;">   ‚îú‚îÄ‚îÄ</span><span style="color:#9ECBFF;"> node-alpha/</span></span>
<span class="line"><span style="color:#B392F0;">‚îÇ</span><span style="color:#9ECBFF;">   ‚îÇ</span><span style="color:#9ECBFF;">   ‚îú‚îÄ‚îÄ</span><span style="color:#9ECBFF;"> kustomization.yaml</span></span>
<span class="line"><span style="color:#B392F0;">‚îÇ</span><span style="color:#9ECBFF;">   ‚îÇ</span><span style="color:#9ECBFF;">   ‚îî‚îÄ‚îÄ</span><span style="color:#9ECBFF;"> patches.yaml</span></span>
<span class="line"><span style="color:#B392F0;">‚îÇ</span><span style="color:#9ECBFF;">   ‚îú‚îÄ‚îÄ</span><span style="color:#9ECBFF;"> node-beta/</span></span>
<span class="line"><span style="color:#B392F0;">‚îÇ</span><span style="color:#9ECBFF;">   ‚îÇ</span><span style="color:#9ECBFF;">   ‚îú‚îÄ‚îÄ</span><span style="color:#9ECBFF;"> kustomization.yaml</span></span>
<span class="line"><span style="color:#B392F0;">‚îÇ</span><span style="color:#9ECBFF;">   ‚îÇ</span><span style="color:#9ECBFF;">   ‚îî‚îÄ‚îÄ</span><span style="color:#9ECBFF;"> patches.yaml</span></span>
<span class="line"><span style="color:#B392F0;">‚îî‚îÄ‚îÄ</span><span style="color:#9ECBFF;"> README.md</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_3-create-git-credentials-if-private-repository" tabindex="-1">3. Create Git Credentials (if private repository) <a class="header-anchor" href="#_3-create-git-credentials-if-private-repository" aria-label="Permalink to &quot;3. Create Git Credentials (if private repository)&quot;">‚Äã</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Create Git credentials secret</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> create</span><span style="color:#9ECBFF;"> secret</span><span style="color:#9ECBFF;"> generic</span><span style="color:#9ECBFF;"> git-credentials</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --namespace</span><span style="color:#9ECBFF;"> default</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --from-literal=username=git</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --from-literal=password=your-personal-access-token</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Or use SSH key</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> create</span><span style="color:#9ECBFF;"> secret</span><span style="color:#9ECBFF;"> generic</span><span style="color:#9ECBFF;"> git-ssh-credentials</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --namespace</span><span style="color:#9ECBFF;"> default</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --from-file=identity=/path/to/private-key</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --from-file=identity.pub=/path/to/public-key</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --from-literal=known_hosts=</span><span style="color:#9ECBFF;">&quot;$(</span><span style="color:#B392F0;">ssh-keyscan</span><span style="color:#9ECBFF;"> github.com)&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="basic-example-gitops-deployment-per-node" tabindex="-1">Basic Example: GitOps Deployment per Node <a class="header-anchor" href="#basic-example-gitops-deployment-per-node" aria-label="Permalink to &quot;Basic Example: GitOps Deployment per Node&quot;">‚Äã</a></h2><p>Here&#39;s a complete example showing how to deploy applications using GitOps for each node:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.lynq.sh/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">LynqForm</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-with-gitops</span></span>
<span class="line"><span style="color:#85E89D;">  namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  hubId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-hub</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Flux GitRepository for source</span></span>
<span class="line"><span style="color:#85E89D;">  manifests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">git-source</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-gitrepo&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">source.toolkit.fluxcd.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">GitRepository</span></span>
<span class="line"><span style="color:#85E89D;">      metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          lynq.sh/node-id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#85E89D;">        url</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">https://github.com/myorg/my-fleet</span></span>
<span class="line"><span style="color:#85E89D;">        ref</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          branch</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">main</span></span>
<span class="line"><span style="color:#85E89D;">        secretRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">git-credentials</span><span style="color:#6A737D;">  # Optional, for private repos</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Flux Kustomization for deployment</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kustomization</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-kustomization&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    dependIds</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;git-source&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">    waitForReady</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#85E89D;">    timeoutSeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">600</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kustomize.toolkit.fluxcd.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Kustomization</span></span>
<span class="line"><span style="color:#85E89D;">      metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          lynq.sh/node-id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5m</span></span>
<span class="line"><span style="color:#85E89D;">        path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;./nodes/{{ .uid }}&quot;</span><span style="color:#6A737D;">  # Node-specific path</span></span>
<span class="line"><span style="color:#85E89D;">        prune</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#85E89D;">        wait</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#85E89D;">        timeout</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5m</span></span>
<span class="line"><span style="color:#85E89D;">        sourceRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">GitRepository</span></span>
<span class="line"><span style="color:#85E89D;">          name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-gitrepo&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">        # Post-build variable substitution</span></span>
<span class="line"><span style="color:#85E89D;">        postBuild</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          substitute</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            NODE_ID</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#6A737D;">            # Use extraValueMappings for custom variables</span></span>
<span class="line"><span style="color:#85E89D;">            NODE_URL</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ index . </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">nodeUrl</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;"> }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">            PLAN_ID</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ index . </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">planId</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;"> | default </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">basic</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;"> }}&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">        # Health checks</span></span>
<span class="line"><span style="color:#85E89D;">        healthChecks</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">          kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">          name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-app&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><p><strong>What happens:</strong></p><ol><li>Lynq creates GitRepository CR for each active node</li><li>Flux syncs from Git repository at specified interval</li><li>Kustomization applies manifests from node-specific path</li><li>Variables substituted via <code>postBuild.substitute</code></li><li>Flux monitors health checks and reports readiness</li><li>When node is deleted, Flux resources are cleaned up automatically</li></ol><div class="tip custom-block"><p class="custom-block-title">More Examples</p><p>Additional examples including Helm charts, OCI artifacts, and multi-source deployments are provided throughout this guide below.</p></div><h2 id="advanced-examples" tabindex="-1">Advanced Examples <a class="header-anchor" href="#advanced-examples" aria-label="Permalink to &quot;Advanced Examples&quot;">‚Äã</a></h2><h3 id="example-1-helm-chart-deployment-per-node" tabindex="-1">Example 1: Helm Chart Deployment per Node <a class="header-anchor" href="#example-1-helm-chart-deployment-per-node" aria-label="Permalink to &quot;Example 1: Helm Chart Deployment per Node&quot;">‚Äã</a></h3><p>Deploy Helm charts with per-node custom values:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.lynq.sh/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">LynqForm</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-with-helm</span></span>
<span class="line"><span style="color:#85E89D;">  namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  hubId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-hub</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Helm repository source</span></span>
<span class="line"><span style="color:#85E89D;">  manifests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">helm-repo</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-helmrepo&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">source.toolkit.fluxcd.io/v1beta2</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">HelmRepository</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">10m</span></span>
<span class="line"><span style="color:#85E89D;">        url</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">https://charts.bitnami.com/bitnami</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Helm release with custom values</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">helm-release</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-app-release&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    dependIds</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;helm-repo&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">    waitForReady</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#85E89D;">    timeoutSeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">900</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">helm.toolkit.fluxcd.io/v2beta1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">HelmRelease</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5m</span></span>
<span class="line"><span style="color:#85E89D;">        chart</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            chart</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">postgresql</span></span>
<span class="line"><span style="color:#85E89D;">            version</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;12.x.x&quot;</span></span>
<span class="line"><span style="color:#85E89D;">            sourceRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">              kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">HelmRepository</span></span>
<span class="line"><span style="color:#85E89D;">              name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-helmrepo&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">        # Per-node values</span></span>
<span class="line"><span style="color:#85E89D;">        values</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          auth</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">            database</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}_db&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          primary</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            persistence</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">              size</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">10Gi</span></span>
<span class="line"><span style="color:#85E89D;">          metrics</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">        # Override with ConfigMap/Secret</span></span>
<span class="line"><span style="color:#85E89D;">        valuesFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="color:#85E89D;">          name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-helm-values&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          optional</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h3 id="example-2-multi-source-kustomization" tabindex="-1">Example 2: Multi-Source Kustomization <a class="header-anchor" href="#example-2-multi-source-kustomization" aria-label="Permalink to &quot;Example 2: Multi-Source Kustomization&quot;">‚Äã</a></h3><p>Combine base configuration from one repository with overlays from another:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.lynq.sh/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">LynqForm</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-multi-source</span></span>
<span class="line"><span style="color:#85E89D;">  namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  hubId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-hub</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">  manifests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#6A737D;">  # Base configuration source</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">base-source</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-base-gitrepo&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">source.toolkit.fluxcd.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">GitRepository</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5m</span></span>
<span class="line"><span style="color:#85E89D;">        url</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">https://github.com/myorg/app-base</span></span>
<span class="line"><span style="color:#85E89D;">        ref</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          tag</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1.0.0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Node-specific overlays source</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">overlay-source</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-overlay-gitrepo&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">source.toolkit.fluxcd.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">GitRepository</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#85E89D;">        url</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">https://github.com/myorg/node-configs</span></span>
<span class="line"><span style="color:#85E89D;">        ref</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          branch</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;nodes/{{ .uid }}&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Kustomization combining both sources</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">multi-kustomization</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-multi-kustomization&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    dependIds</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;base-source&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;overlay-source&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kustomize.toolkit.fluxcd.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Kustomization</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5m</span></span>
<span class="line"><span style="color:#85E89D;">        path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;./base&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        sourceRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">GitRepository</span></span>
<span class="line"><span style="color:#85E89D;">          name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-base-gitrepo&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">        # Apply overlays from second source</span></span>
<span class="line"><span style="color:#85E89D;">        patches</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">patch</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#9ECBFF;">            apiVersion: apps/v1</span></span>
<span class="line"><span style="color:#9ECBFF;">            kind: Deployment</span></span>
<span class="line"><span style="color:#9ECBFF;">            metadata:</span></span>
<span class="line"><span style="color:#9ECBFF;">              name: app</span></span>
<span class="line"><span style="color:#9ECBFF;">            spec:</span></span>
<span class="line"><span style="color:#9ECBFF;">              template:</span></span>
<span class="line"><span style="color:#9ECBFF;">                metadata:</span></span>
<span class="line"><span style="color:#9ECBFF;">                  labels:</span></span>
<span class="line"><span style="color:#9ECBFF;">                    node-id: &quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          target</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><h3 id="example-3-oci-artifact-deployment" tabindex="-1">Example 3: OCI Artifact Deployment <a class="header-anchor" href="#example-3-oci-artifact-deployment" aria-label="Permalink to &quot;Example 3: OCI Artifact Deployment&quot;">‚Äã</a></h3><p>Deploy from OCI registry (container registry as artifact storage):</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.lynq.sh/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">LynqForm</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-with-oci</span></span>
<span class="line"><span style="color:#85E89D;">  namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  hubId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-hub</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">  manifests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">oci-source</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-oci-repo&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">source.toolkit.fluxcd.io/v1beta2</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">OCIRepository</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5m</span></span>
<span class="line"><span style="color:#85E89D;">        url</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">oci://ghcr.io/myorg/manifests</span></span>
<span class="line"><span style="color:#85E89D;">        ref</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          tag</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">latest</span></span>
<span class="line"><span style="color:#85E89D;">        secretRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">oci-credentials</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">oci-kustomization</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-oci-kustomization&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    dependIds</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;oci-source&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kustomize.toolkit.fluxcd.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Kustomization</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5m</span></span>
<span class="line"><span style="color:#85E89D;">        path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;./deploy&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        sourceRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">OCIRepository</span></span>
<span class="line"><span style="color:#85E89D;">          name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-oci-repo&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        postBuild</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          substitute</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            NODE_ID</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h3 id="example-4-image-automation" tabindex="-1">Example 4: Image Automation <a class="header-anchor" href="#example-4-image-automation" aria-label="Permalink to &quot;Example 4: Image Automation&quot;">‚Äã</a></h3><p>Automatically update images when new versions are pushed:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.lynq.sh/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">LynqForm</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-with-image-automation</span></span>
<span class="line"><span style="color:#85E89D;">  namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  hubId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-hub</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">  manifests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#6A737D;">  # Git source with write access</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">git-source</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-gitrepo&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">source.toolkit.fluxcd.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">GitRepository</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#85E89D;">        url</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">https://github.com/myorg/my-fleet</span></span>
<span class="line"><span style="color:#85E89D;">        ref</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          branch</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;nodes/{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        secretRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">git-write-credentials</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Image repository to scan</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">image-repo</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-imagerepo&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">image.toolkit.fluxcd.io/v1beta2</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ImageRepository</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#85E89D;">        image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ghcr.io/myorg/myapp</span></span>
<span class="line"><span style="color:#85E89D;">        secretRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">registry-credentials</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Image policy (semver, alphabetical, etc.)</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">image-policy</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-imagepolicy&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    dependIds</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;image-repo&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">image.toolkit.fluxcd.io/v1beta2</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ImagePolicy</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        imageRepositoryRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-imagerepo&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        policy</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          semver</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            range</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&gt;=1.0.0 &lt;2.0.0&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Image update automation</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">image-update</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-imageupdate&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    dependIds</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;git-source&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;image-policy&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">image.toolkit.fluxcd.io/v1beta1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ImageUpdateAutomation</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#85E89D;">        sourceRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">GitRepository</span></span>
<span class="line"><span style="color:#85E89D;">          name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-gitrepo&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        git</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          checkout</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            ref</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">              branch</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;nodes/{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          commit</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            author</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">              email</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">fluxcdbot@users.noreply.github.com</span></span>
<span class="line"><span style="color:#85E89D;">              name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">fluxcdbot</span></span>
<span class="line"><span style="color:#85E89D;">            messageTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;[{{ .uid }}] Update image&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        update</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;./deploy&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          strategy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Setters</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Kustomization to deploy</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kustomization</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-kustomization&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    dependIds</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;git-source&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kustomize.toolkit.fluxcd.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Kustomization</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5m</span></span>
<span class="line"><span style="color:#85E89D;">        path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;./deploy&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        sourceRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">GitRepository</span></span>
<span class="line"><span style="color:#85E89D;">          name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-gitrepo&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br></div></div><h2 id="how-it-works" tabindex="-1">How It Works <a class="header-anchor" href="#how-it-works" aria-label="Permalink to &quot;How It Works&quot;">‚Äã</a></h2><h3 id="workflow" tabindex="-1">Workflow <a class="header-anchor" href="#workflow" aria-label="Permalink to &quot;Workflow&quot;">‚Äã</a></h3><ol><li><strong>Node Created</strong>: LynqHub creates LynqNode CR from database</li><li><strong>Flux Sources Created</strong>: LynqNode controller creates GitRepository/HelmRepository/OCIRepository CRs</li><li><strong>Flux Controllers Process</strong>: Source controllers fetch artifacts, Kustomize/Helm controllers apply</li><li><strong>Applications Deployed</strong>: Kubernetes resources created from Git/Helm/OCI sources</li><li><strong>Continuous Sync</strong>: Flux polls sources at <code>interval</code> and reconciles drift</li><li><strong>Health Monitoring</strong>: Flux health checks ensure resources are ready</li><li><strong>Node Deleted</strong>: Flux resources deleted (if <code>deletionPolicy=Delete</code>)</li></ol><h3 id="reconciliation-loop" tabindex="-1">Reconciliation Loop <a class="header-anchor" href="#reconciliation-loop" aria-label="Permalink to &quot;Reconciliation Loop&quot;">‚Äã</a></h3>`,55)),(a(),p(t,null,{default:n(()=>[r(e,{id:"mermaid-395",class:"mermaid my-class",graph:"sequenceDiagram%0A%20%20%20%20participant%20DB%20as%20Database%0A%20%20%20%20participant%20Hub%20as%20LynqHub%0A%20%20%20%20participant%20Node%20as%20LynqNode%0A%20%20%20%20participant%20Flux%20as%20Flux%20Controllers%0A%20%20%20%20participant%20Git%20as%20Git%20Repository%0A%20%20%20%20participant%20K8s%20as%20Kubernetes%0A%0A%20%20%20%20DB-%3E%3EHub%3A%20Sync%20(every%20interval)%0A%20%20%20%20Hub-%3E%3ENode%3A%20Create%2FUpdate%20LynqNode%0A%20%20%20%20Node-%3E%3EFlux%3A%20Create%20GitRepository%20CR%0A%20%20%20%20Flux-%3E%3EGit%3A%20Poll%20for%20changes%0A%20%20%20%20Git-%3E%3EFlux%3A%20Return%20manifests%0A%20%20%20%20Flux-%3E%3EK8s%3A%20Apply%20manifests%0A%20%20%20%20K8s-%3E%3EFlux%3A%20Report%20status%0A%20%20%20%20Flux-%3E%3ENode%3A%20Update%20readiness%0A%20%20%20%20Node-%3E%3EHub%3A%20Aggregate%20status%0A"})]),fallback:n(()=>[...s[1]||(s[1]=[o(" Loading... ",-1)])]),_:1})),s[4]||(s[4]=l(`<h3 id="state-management" tabindex="-1">State Management <a class="header-anchor" href="#state-management" aria-label="Permalink to &quot;State Management&quot;">‚Äã</a></h3><ul><li><strong>Git as Source of Truth</strong>: All configuration stored in Git</li><li><strong>Flux State</strong>: Stored in Kubernetes CRs (GitRepository, Kustomization status)</li><li><strong>No Local State</strong>: Flux is stateless, can be redeployed without data loss</li></ul><h2 id="best-practices" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices" aria-label="Permalink to &quot;Best Practices&quot;">‚Äã</a></h2><h3 id="_1-use-branch-per-node-strategy" tabindex="-1">1. Use Branch-per-Node Strategy <a class="header-anchor" href="#_1-use-branch-per-node-strategy" aria-label="Permalink to &quot;1. Use Branch-per-Node Strategy&quot;">‚Äã</a></h3><p>Isolate node configurations in separate branches:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  manifests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">git-source</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">source.toolkit.fluxcd.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">GitRepository</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        ref</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          branch</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;nodes/{{ .uid }}&quot;</span><span style="color:#6A737D;">  # Per-node branch</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_2-implement-progressive-rollouts" tabindex="-1">2. Implement Progressive Rollouts <a class="header-anchor" href="#_2-implement-progressive-rollouts" aria-label="Permalink to &quot;2. Implement Progressive Rollouts&quot;">‚Äã</a></h3><p>Deploy to staging nodes first, then production:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># LynqForm for staging nodes</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.lynq.sh/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">LynqForm</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">staging-nodes</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  hubId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-hub</span></span>
<span class="line"><span style="color:#85E89D;">  manifests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">git-source</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">source.toolkit.fluxcd.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">GitRepository</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        ref</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          branch</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">staging</span><span style="color:#6A737D;">  # Staging branch</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#6A737D;"># LynqForm for production nodes</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.lynq.sh/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">LynqForm</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">production-nodes</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  hubId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-hub</span></span>
<span class="line"><span style="color:#85E89D;">  manifests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">git-source</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">source.toolkit.fluxcd.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">GitRepository</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        ref</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          branch</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">production</span><span style="color:#6A737D;">  # Production branch (stable)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="_3-use-kustomize-for-environment-specific-configuration" tabindex="-1">3. Use Kustomize for Environment-Specific Configuration <a class="header-anchor" href="#_3-use-kustomize-for-environment-specific-configuration" aria-label="Permalink to &quot;3. Use Kustomize for Environment-Specific Configuration&quot;">‚Äã</a></h3><p>Structure your repository with base + overlays:</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>my-fleet/</span></span>
<span class="line"><span>‚îú‚îÄ‚îÄ base/</span></span>
<span class="line"><span>‚îÇ   ‚îú‚îÄ‚îÄ deployment.yaml</span></span>
<span class="line"><span>‚îÇ   ‚îú‚îÄ‚îÄ service.yaml</span></span>
<span class="line"><span>‚îÇ   ‚îî‚îÄ‚îÄ kustomization.yaml</span></span>
<span class="line"><span>‚îî‚îÄ‚îÄ overlays/</span></span>
<span class="line"><span>    ‚îú‚îÄ‚îÄ staging/</span></span>
<span class="line"><span>    ‚îÇ   ‚îú‚îÄ‚îÄ kustomization.yaml</span></span>
<span class="line"><span>    ‚îÇ   ‚îî‚îÄ‚îÄ patches.yaml</span></span>
<span class="line"><span>    ‚îî‚îÄ‚îÄ production/</span></span>
<span class="line"><span>        ‚îú‚îÄ‚îÄ kustomization.yaml</span></span>
<span class="line"><span>        ‚îî‚îÄ‚îÄ patches.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_4-set-appropriate-sync-intervals" tabindex="-1">4. Set Appropriate Sync Intervals <a class="header-anchor" href="#_4-set-appropriate-sync-intervals" aria-label="Permalink to &quot;4. Set Appropriate Sync Intervals&quot;">‚Äã</a></h3><p>Balance freshness vs. load:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  manifests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">git-source</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">source.toolkit.fluxcd.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">GitRepository</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span><span style="color:#6A737D;">  # Fast sync for development</span></span>
<span class="line"><span style="color:#6A737D;">        # interval: 10m  # Slower sync for production (reduce API calls)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_5-use-health-checks" tabindex="-1">5. Use Health Checks <a class="header-anchor" href="#_5-use-health-checks" aria-label="Permalink to &quot;5. Use Health Checks&quot;">‚Äã</a></h3><p>Ensure resources are truly ready before marking complete:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  manifests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kustomization</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kustomize.toolkit.fluxcd.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Kustomization</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        wait</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#6A737D;">  # Wait for resources to be ready</span></span>
<span class="line"><span style="color:#85E89D;">        timeout</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5m</span></span>
<span class="line"><span style="color:#85E89D;">        healthChecks</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">          kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">          name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app</span></span>
<span class="line"><span style="color:#85E89D;">          namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_6-use-webhook-receivers-for-instant-updates" tabindex="-1">6. Use Webhook Receivers for Instant Updates <a class="header-anchor" href="#_6-use-webhook-receivers-for-instant-updates" aria-label="Permalink to &quot;6. Use Webhook Receivers for Instant Updates&quot;">‚Äã</a></h3><p>Avoid polling delays with Git webhooks:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Install Flux webhook receiver</span></span>
<span class="line"><span style="color:#B392F0;">flux</span><span style="color:#9ECBFF;"> create</span><span style="color:#9ECBFF;"> receiver</span><span style="color:#9ECBFF;"> github-receiver</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --type</span><span style="color:#9ECBFF;"> github</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --event</span><span style="color:#9ECBFF;"> ping</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --event</span><span style="color:#9ECBFF;"> push</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --secret-ref</span><span style="color:#9ECBFF;"> webhook-token</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --resource</span><span style="color:#9ECBFF;"> GitRepository/my-gitrepo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Configure GitHub webhook to POST to receiver URL</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_7-monitor-flux-resources" tabindex="-1">7. Monitor Flux Resources <a class="header-anchor" href="#_7-monitor-flux-resources" aria-label="Permalink to &quot;7. Monitor Flux Resources&quot;">‚Äã</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Check Flux sources</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> gitrepositories,helmrepositories,ocirepositories</span><span style="color:#79B8FF;"> -A</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check Flux deployments</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> kustomizations,helmreleases</span><span style="color:#79B8FF;"> -A</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check specific node&#39;s Flux resources</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> gitrepository,kustomization</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> lynq.sh/node-id=node-alpha</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># View Flux events</span></span>
<span class="line"><span style="color:#B392F0;">flux</span><span style="color:#9ECBFF;"> events</span><span style="color:#79B8FF;"> --for</span><span style="color:#9ECBFF;"> Kustomization/node-alpha-kustomization</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># View Flux logs</span></span>
<span class="line"><span style="color:#B392F0;">flux</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> --follow</span><span style="color:#79B8FF;"> --level=info</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">‚Äã</a></h2><h3 id="gitrepository-sync-fails" tabindex="-1">GitRepository Sync Fails <a class="header-anchor" href="#gitrepository-sync-fails" aria-label="Permalink to &quot;GitRepository Sync Fails&quot;">‚Äã</a></h3><p><strong>Problem:</strong> Flux fails to sync from Git repository.</p><p><strong>Solution:</strong></p><ol><li><p><strong>Check GitRepository status:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> describe</span><span style="color:#9ECBFF;"> gitrepository</span><span style="color:#9ECBFF;"> node-alpha-gitrepo</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>Verify Git credentials:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> secret</span><span style="color:#9ECBFF;"> git-credentials</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>Test Git connectivity:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">flux</span><span style="color:#9ECBFF;"> reconcile</span><span style="color:#9ECBFF;"> source</span><span style="color:#9ECBFF;"> git</span><span style="color:#9ECBFF;"> node-alpha-gitrepo</span><span style="color:#79B8FF;"> --with-source</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>Check Flux logs:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> flux-system</span><span style="color:#9ECBFF;"> deploy/source-controller</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ol><h3 id="kustomization-apply-fails" tabindex="-1">Kustomization Apply Fails <a class="header-anchor" href="#kustomization-apply-fails" aria-label="Permalink to &quot;Kustomization Apply Fails&quot;">‚Äã</a></h3><p><strong>Problem:</strong> Flux fails to apply manifests from Git.</p><p><strong>Solution:</strong></p><ol><li><p><strong>Check Kustomization status:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> describe</span><span style="color:#9ECBFF;"> kustomization</span><span style="color:#9ECBFF;"> node-alpha-kustomization</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>View last applied revision:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">flux</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> kustomizations</span><span style="color:#9ECBFF;"> node-alpha-kustomization</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>Manually reconcile:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">flux</span><span style="color:#9ECBFF;"> reconcile</span><span style="color:#9ECBFF;"> kustomization</span><span style="color:#9ECBFF;"> node-alpha-kustomization</span><span style="color:#79B8FF;"> --with-source</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>Check for invalid manifests:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Clone repo and validate</span></span>
<span class="line"><span style="color:#B392F0;">kustomize</span><span style="color:#9ECBFF;"> build</span><span style="color:#9ECBFF;"> ./path/to/manifests</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol><h3 id="health-check-timeout" tabindex="-1">Health Check Timeout <a class="header-anchor" href="#health-check-timeout" aria-label="Permalink to &quot;Health Check Timeout&quot;">‚Äã</a></h3><p><strong>Problem:</strong> Kustomization fails with health check timeout.</p><p><strong>Solution:</strong></p><ol><li><p><strong>Check resource status directly:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> deployment</span><span style="color:#9ECBFF;"> node-alpha-app</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> wide</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> describe</span><span style="color:#9ECBFF;"> deployment</span><span style="color:#9ECBFF;"> node-alpha-app</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p><strong>Increase timeout:</strong></p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  timeout</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">10m</span><span style="color:#6A737D;">  # Increase from 5m</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p><strong>Disable wait for troubleshooting:</strong></p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  wait</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span><span style="color:#6A737D;">  # Temporarily disable</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol><h3 id="suspended-flux-resources" tabindex="-1">Suspended Flux Resources <a class="header-anchor" href="#suspended-flux-resources" aria-label="Permalink to &quot;Suspended Flux Resources&quot;">‚Äã</a></h3><p><strong>Problem:</strong> Flux resources are suspended and not reconciling.</p><p><strong>Solution:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Check if suspended</span></span>
<span class="line"><span style="color:#B392F0;">flux</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> sources</span><span style="color:#9ECBFF;"> git</span></span>
<span class="line"><span style="color:#B392F0;">flux</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> kustomizations</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Resume reconciliation</span></span>
<span class="line"><span style="color:#B392F0;">flux</span><span style="color:#9ECBFF;"> resume</span><span style="color:#9ECBFF;"> source</span><span style="color:#9ECBFF;"> git</span><span style="color:#9ECBFF;"> node-alpha-gitrepo</span></span>
<span class="line"><span style="color:#B392F0;">flux</span><span style="color:#9ECBFF;"> resume</span><span style="color:#9ECBFF;"> kustomization</span><span style="color:#9ECBFF;"> node-alpha-kustomization</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="post-build-substitution-fails" tabindex="-1">Post-Build Substitution Fails <a class="header-anchor" href="#post-build-substitution-fails" aria-label="Permalink to &quot;Post-Build Substitution Fails&quot;">‚Äã</a></h3><p><strong>Problem:</strong> Variables not substituted in manifests.</p><p><strong>Solution:</strong></p><ol><li><p><strong>Check variable syntax in manifests:</strong></p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Correct syntax</span></span>
<span class="line"><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${NODE_ID}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># NOT this</span></span>
<span class="line"><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">: {{ </span><span style="color:#9ECBFF;">.NODE_ID</span><span style="color:#E1E4E8;"> }}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p><strong>Verify substitution config:</strong></p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  postBuild</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    substitute</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      NODE_ID</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;node-alpha&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    substituteFrom</span><span style="color:#E1E4E8;">:  </span><span style="color:#6A737D;"># Optional: Load from ConfigMap/Secret</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="color:#85E89D;">      name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">cluster-vars</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li><li><p><strong>Check Kustomization logs:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> flux-system</span><span style="color:#9ECBFF;"> deploy/kustomize-controller</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> grep</span><span style="color:#9ECBFF;"> node-alpha</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ol><h2 id="integration-with-other-tools" tabindex="-1">Integration with Other Tools <a class="header-anchor" href="#integration-with-other-tools" aria-label="Permalink to &quot;Integration with Other Tools&quot;">‚Äã</a></h2><h3 id="sealed-secrets" tabindex="-1">Sealed Secrets <a class="header-anchor" href="#sealed-secrets" aria-label="Permalink to &quot;Sealed Secrets&quot;">‚Äã</a></h3><p>Encrypt secrets before committing to Git:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.lynq.sh/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">LynqForm</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-with-sealed-secrets</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  hubId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-hub</span></span>
<span class="line"><span style="color:#85E89D;">  manifests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">git-source</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-gitrepo&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">source.toolkit.fluxcd.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">GitRepository</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        url</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">https://github.com/myorg/my-fleet</span></span>
<span class="line"><span style="color:#85E89D;">        ref</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          branch</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kustomization</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-kustomization&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    dependIds</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;git-source&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kustomize.toolkit.fluxcd.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Kustomization</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;./nodes/{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        sourceRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">GitRepository</span></span>
<span class="line"><span style="color:#85E89D;">          name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-gitrepo&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">        # Decrypt SealedSecrets</span></span>
<span class="line"><span style="color:#85E89D;">        decryption</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          provider</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">sops</span></span>
<span class="line"><span style="color:#85E89D;">          secretRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">sops-gpg</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="external-secrets-operator" tabindex="-1">External Secrets Operator <a class="header-anchor" href="#external-secrets-operator" aria-label="Permalink to &quot;External Secrets Operator&quot;">‚Äã</a></h3><p>Sync secrets from external vaults:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># In your Git repository</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">external-secrets.io/v1beta1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ExternalSecret</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${NODE_ID}-db-credentials</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  refreshInterval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1h</span></span>
<span class="line"><span style="color:#85E89D;">  secretStoreRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">vault-backend</span></span>
<span class="line"><span style="color:#85E89D;">    kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">SecretStore</span></span>
<span class="line"><span style="color:#85E89D;">  target</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${NODE_ID}-db-credentials</span></span>
<span class="line"><span style="color:#85E89D;">  data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">secretKey</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">password</span></span>
<span class="line"><span style="color:#85E89D;">    remoteRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nodes/\${NODE_ID}/db-password</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="prometheus-monitoring" tabindex="-1">Prometheus Monitoring <a class="header-anchor" href="#prometheus-monitoring" aria-label="Permalink to &quot;Prometheus Monitoring&quot;">‚Äã</a></h3><p>Monitor Flux resources with Prometheus:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Flux exports metrics on :8080/metrics</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> port-forward</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> flux-system</span><span style="color:#9ECBFF;"> deploy/source-controller</span><span style="color:#9ECBFF;"> 8080:8080</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Sample metrics</span></span>
<span class="line"><span style="color:#B392F0;">gotk_reconcile_duration_seconds_bucket</span></span>
<span class="line"><span style="color:#B392F0;">gotk_reconcile_condition</span><span style="color:#9ECBFF;">{</span><span style="color:#79B8FF;">type</span><span style="color:#9ECBFF;">=</span><span style="color:#B392F0;">&quot;Ready&quot;</span><span style="color:#B392F0;">,status</span><span style="color:#9ECBFF;">=</span><span style="color:#B392F0;">&quot;True&quot;</span><span style="color:#B392F0;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="performance-considerations" tabindex="-1">Performance Considerations <a class="header-anchor" href="#performance-considerations" aria-label="Permalink to &quot;Performance Considerations&quot;">‚Äã</a></h2><h3 id="optimize-git-repository-structure" tabindex="-1">Optimize Git Repository Structure <a class="header-anchor" href="#optimize-git-repository-structure" aria-label="Permalink to &quot;Optimize Git Repository Structure&quot;">‚Äã</a></h3><ul><li><strong>Use shallow clones</strong>: Flux automatically uses shallow clones</li><li><strong>Split large repositories</strong>: Use multiple GitRepository CRs for large monorepos</li><li><strong>Use sparse checkout</strong> (Flux v2.2+): Only clone specific paths</li></ul><h3 id="reduce-api-load" tabindex="-1">Reduce API Load <a class="header-anchor" href="#reduce-api-load" aria-label="Permalink to &quot;Reduce API Load&quot;">‚Äã</a></h3><ul><li><strong>Increase sync intervals</strong> for stable environments</li><li><strong>Use webhook receivers</strong> instead of polling</li><li><strong>Enable persistent storage</strong> for source-controller cache:<div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">source-controller</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  persistence</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#85E89D;">    size</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">10Gi</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul><h3 id="scale-flux-controllers" tabindex="-1">Scale Flux Controllers <a class="header-anchor" href="#scale-flux-controllers" aria-label="Permalink to &quot;Scale Flux Controllers&quot;">‚Äã</a></h3><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Increase controller replicas (requires leader election)</span></span>
<span class="line"><span style="color:#85E89D;">kustomize-controller</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#85E89D;">  resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">200m</span></span>
<span class="line"><span style="color:#85E89D;">      memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">256Mi</span></span>
<span class="line"><span style="color:#85E89D;">    limits</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1000m</span></span>
<span class="line"><span style="color:#85E89D;">      memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1Gi</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="see-also" tabindex="-1">See Also <a class="header-anchor" href="#see-also" aria-label="Permalink to &quot;See Also&quot;">‚Äã</a></h2><ul><li><a href="https://fluxcd.io/docs/" target="_blank" rel="noreferrer">Flux Documentation</a></li><li><a href="https://toolkit.fluxcd.io/" target="_blank" rel="noreferrer">Flux GitOps Toolkit</a></li><li><a href="https://kustomize.io/" target="_blank" rel="noreferrer">Kustomize Documentation</a></li><li><a href="https://helm.sh/docs/" target="_blank" rel="noreferrer">Helm Documentation</a></li><li><a href="./templates.html">Lynq Templates Guide</a></li><li><a href="./integration-external-dns.html">ExternalDNS Integration</a></li></ul>`,63))])}const B=c(u,[["render",y]]);export{C as __pageData,B as default};
