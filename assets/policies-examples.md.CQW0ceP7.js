import{_ as p,C as c,c as d,o as n,a2 as s,b as l,w as a,a as o,G as r,a5 as i}from"./chunks/framework.BNM54Z5_.js";const m=JSON.parse('{"title":"Policy Combinations - Practical Examples","description":"","frontmatter":{},"headers":[],"relativePath":"policies-examples.md","filePath":"policies-examples.md","lastUpdated":1762822981000}'),E={name:"policies-examples.md"};function C(A,e,u,y,b,h){const t=c("Mermaid");return n(),d("div",null,[e[7]||(e[7]=s(`<h1 id="policy-combinations-practical-examples" tabindex="-1">Policy Combinations - Practical Examples <a class="header-anchor" href="#policy-combinations-practical-examples" aria-label="Permalink to &quot;Policy Combinations - Practical Examples&quot;">‚Äã</a></h1><p>Real-world examples showing how to combine CreationPolicy, DeletionPolicy, ConflictPolicy, and PatchStrategy for different resource types.</p><nav class="table-of-contents"><ul><li><a href="#overview">Overview</a></li><li><a href="#example-1-stateful-data-pvc">Example 1: Stateful Data (PVC)</a><ul><li><a href="#configuration">Configuration</a></li><li><a href="#lifecycle-flow">Lifecycle Flow</a></li><li><a href="#rationale">Rationale</a></li><li><a href="#key-behaviors">Key Behaviors</a></li><li><a href="#delete-and-recreate-scenario">Delete and Recreate Scenario</a></li></ul></li><li><a href="#example-2-init-job">Example 2: Init Job</a><ul><li><a href="#configuration-1">Configuration</a></li><li><a href="#lifecycle-flow-1">Lifecycle Flow</a></li><li><a href="#rationale-1">Rationale</a></li><li><a href="#key-behaviors-1">Key Behaviors</a></li></ul></li><li><a href="#example-3-application-deployment">Example 3: Application Deployment</a><ul><li><a href="#configuration-2">Configuration</a></li><li><a href="#lifecycle-flow-2">Lifecycle Flow</a></li><li><a href="#rationale-2">Rationale</a></li><li><a href="#key-behaviors-2">Key Behaviors</a></li></ul></li><li><a href="#example-4-shared-infrastructure">Example 4: Shared Infrastructure</a><ul><li><a href="#configuration-3">Configuration</a></li><li><a href="#lifecycle-flow-3">Lifecycle Flow</a></li><li><a href="#rationale-3">Rationale</a></li><li><a href="#key-behaviors-3">Key Behaviors</a></li><li><a href="#delete-and-recreate-with-whenneeded">Delete and Recreate with WhenNeeded</a></li></ul></li><li><a href="#policy-combinations-summary">Policy Combinations Summary</a></li><li><a href="#decision-tree">Decision Tree</a></li><li><a href="#see-also">See Also</a></li></ul></nav><div class="tip custom-block"><p class="custom-block-title">Core Concepts First</p><p>If you&#39;re new to policies, start with the <a href="./policies.html">Policies Guide</a> to understand each policy type before diving into these examples.</p></div><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">‚Äã</a></h2><p>This guide demonstrates how policies work together through four common scenarios:</p><table tabindex="0"><thead><tr><th>Example</th><th>Use Case</th><th>Key Pattern</th><th>Policies</th></tr></thead><tbody><tr><td><a href="#example-1-stateful-data-pvc">Example 1</a></td><td>Persistent Data</td><td>Immutable + Retained</td><td><code>Once + Retain + Stuck</code></td></tr><tr><td><a href="#example-2-init-job">Example 2</a></td><td>One-time Setup</td><td>Run Once + Cleanup</td><td><code>Once + Delete + Force</code></td></tr><tr><td><a href="#example-3-application-deployment">Example 3</a></td><td>Main Application</td><td>Sync + Cleanup</td><td><code>WhenNeeded + Delete + Stuck</code></td></tr><tr><td><a href="#example-4-shared-infrastructure">Example 4</a></td><td>Shared Config</td><td>Sync + Retained</td><td><code>WhenNeeded + Retain + Force</code></td></tr></tbody></table><h2 id="example-1-stateful-data-pvc" tabindex="-1">Example 1: Stateful Data (PVC) <a class="header-anchor" href="#example-1-stateful-data-pvc" aria-label="Permalink to &quot;Example 1: Stateful Data (PVC)&quot;">‚Äã</a></h2><p><strong>Use Case:</strong> Persistent storage that must survive tenant lifecycle changes and never lose data.</p><h3 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-label="Permalink to &quot;Configuration&quot;">‚Äã</a></h3><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">persistentVolumeClaims</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">data</span></span>
<span class="line"><span style="color:#85E89D;">    creationPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Once</span><span style="color:#6A737D;">        # Create only once</span></span>
<span class="line"><span style="color:#85E89D;">    deletionPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Retain</span><span style="color:#6A737D;">      # Keep data after tenant deletion</span></span>
<span class="line"><span style="color:#85E89D;">    conflictPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Stuck</span><span style="color:#6A737D;">       # Don&#39;t overwrite existing PVCs</span></span>
<span class="line"><span style="color:#85E89D;">    patchStrategy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apply</span><span style="color:#6A737D;">        # Standard SSA</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-data&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        accessModes</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;ReadWriteOnce&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">        resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            storage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">10Gi</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="lifecycle-flow" tabindex="-1">Lifecycle Flow <a class="header-anchor" href="#lifecycle-flow" aria-label="Permalink to &quot;Lifecycle Flow&quot;">‚Äã</a></h3>`,12)),(n(),l(i,null,{default:a(()=>[r(t,{id:"mermaid-109",class:"mermaid my-class",graph:"flowchart%20TD%0A%20%20%20%20Start(%5BTenant%20Created%5D)%0A%20%20%20%20CheckExists%7BPVC%20Exists%3F%7D%0A%20%20%20%20HasAnnotation%7BHas%20created-once%3Cbr%2F%3Eannotation%3F%7D%0A%20%20%20%20CreatePVC%5BCreate%20PVC%3Cbr%2F%3E%2B%20Add%20annotation%3Cbr%2F%3E%2B%20Label%20tracking%20only%3Cbr%2F%3ENO%20ownerReference%5D%0A%20%20%20%20SkipCreate%5BSkip%20Creation%3Cbr%2F%3ECount%20as%20Ready%5D%0A%20%20%20%20TemplateChange%5BTemplate%20Updated%5D%0A%20%20%20%20SkipUpdate%5BSkip%20Update%3Cbr%2F%3ECreationPolicy%3DOnce%5D%0A%20%20%20%20TenantDelete%5BTenant%20Deleted%5D%0A%20%20%20%20RemoveLabels%5BRemove%20Tracking%20Labels%3Cbr%2F%3EAdd%20Orphan%20Labels%5D%0A%20%20%20%20PVCRetained%5BPVC%20Retained%20in%20Cluster%3Cbr%2F%3EData%20Preserved%5D%0A%20%20%20%20ConflictDetect%7BPVC%20owned%20by%3Cbr%2F%3Eanother%20controller%3F%7D%0A%20%20%20%20MarkDegraded%5BMark%20Tenant%20Degraded%3Cbr%2F%3EEmit%20ResourceConflict%20Event%5D%0A%0A%20%20%20%20Start%20--%3E%20CheckExists%0A%20%20%20%20CheckExists%20--%3E%7CNo%7C%20ConflictDetect%0A%20%20%20%20CheckExists%20--%3E%7CYes%7C%20HasAnnotation%0A%0A%20%20%20%20ConflictDetect%20--%3E%7CNo%7C%20CreatePVC%0A%20%20%20%20ConflictDetect%20--%3E%7CYes%7C%20MarkDegraded%0A%0A%20%20%20%20HasAnnotation%20--%3E%7CYes%7C%20SkipCreate%0A%20%20%20%20HasAnnotation%20--%3E%7CNo%7C%20CreatePVC%0A%0A%20%20%20%20CreatePVC%20--%3E%20TemplateChange%0A%20%20%20%20SkipCreate%20--%3E%20TemplateChange%0A%20%20%20%20TemplateChange%20--%3E%20SkipUpdate%0A%0A%20%20%20%20SkipUpdate%20--%3E%20TenantDelete%0A%20%20%20%20TenantDelete%20--%3E%20RemoveLabels%0A%20%20%20%20RemoveLabels%20--%3E%20PVCRetained%0A%0A%20%20%20%20classDef%20createStyle%20fill%3A%23e8f5e9%2Cstroke%3A%234caf50%2Cstroke-width%3A2px%3B%0A%20%20%20%20classDef%20skipStyle%20fill%3A%23fff3e0%2Cstroke%3A%23ff9800%2Cstroke-width%3A2px%3B%0A%20%20%20%20classDef%20retainStyle%20fill%3A%23e3f2fd%2Cstroke%3A%232196f3%2Cstroke-width%3A2px%3B%0A%20%20%20%20classDef%20errorStyle%20fill%3A%23ffebee%2Cstroke%3A%23f44336%2Cstroke-width%3A2px%3B%0A%0A%20%20%20%20class%20CreatePVC%20createStyle%3B%0A%20%20%20%20class%20SkipCreate%2CSkipUpdate%20skipStyle%3B%0A%20%20%20%20class%20PVCRetained%2CRemoveLabels%20retainStyle%3B%0A%20%20%20%20class%20MarkDegraded%20errorStyle%3B%0A"})]),fallback:a(()=>[...e[0]||(e[0]=[o(" Loading... ",-1)])]),_:1})),e[8]||(e[8]=s('<h3 id="rationale" tabindex="-1">Rationale <a class="header-anchor" href="#rationale" aria-label="Permalink to &quot;Rationale&quot;">‚Äã</a></h3><ul><li><strong><code>Once</code></strong>: PVC spec shouldn&#39;t change (size immutable in many storage classes)</li><li><strong><code>Retain</code></strong>: Data survives tenant deletion - <strong>NO ownerReference</strong> set to prevent automatic deletion</li><li><strong><code>Stuck</code></strong>: Safety - don&#39;t overwrite someone else&#39;s PVC on initial creation</li><li><strong><code>apply</code></strong>: Standard SSA for declarative management</li></ul><h3 id="key-behaviors" tabindex="-1">Key Behaviors <a class="header-anchor" href="#key-behaviors" aria-label="Permalink to &quot;Key Behaviors&quot;">‚Äã</a></h3><ul><li>‚úÖ Created once, never updated (even if template changes)</li><li>‚úÖ Survives tenant deletion (label-based tracking)</li><li>‚úÖ Safe conflict detection on initial creation</li><li>üìä Data persists indefinitely</li><li>‚ö†Ô∏è <strong>Important</strong>: Once <code>created-once</code> annotation is set, <code>ApplyResource</code> is never called again</li></ul><h3 id="delete-and-recreate-scenario" tabindex="-1">Delete and Recreate Scenario <a class="header-anchor" href="#delete-and-recreate-scenario" aria-label="Permalink to &quot;Delete and Recreate Scenario&quot;">‚Äã</a></h3><div class="warning custom-block"><p class="custom-block-title">CreationPolicy=Once Limitation</p><p>With <code>CreationPolicy: Once</code>, the operator <strong>SKIPS</strong> resources that have the <code>created-once</code> annotation. This means on Tenant recreation:</p><ul><li><strong>NO re-adoption</strong> occurs</li><li><strong>Orphan markers remain</strong> on the resource</li><li><strong>NO conflict detection</strong> (ApplyResource is not called)</li><li>Resource is <strong>counted as Ready</strong> but not actively managed</li></ul></div><p><strong>Scenario Timeline:</strong></p>',7)),(n(),l(i,null,{default:a(()=>[r(t,{id:"mermaid-198",class:"mermaid my-class",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%0A%20%20%20%20participant%20Tenant%20as%20Tenant%20CR%0A%20%20%20%20participant%20Operator%0A%20%20%20%20participant%20PVC%20as%20PVC%20(acme-data)%0A%0A%20%20%20%20Note%20over%20Tenant%2CPVC%3A%20Phase%201%3A%20Initial%20State%0A%20%20%20%20User-%3E%3ETenant%3A%20Create%20Tenant%20(uid%3A%20acme)%0A%20%20%20%20Tenant-%3E%3EOperator%3A%20Reconcile%0A%20%20%20%20Operator-%3E%3EPVC%3A%20Create%20PVC%3Cbr%2F%3E%2B%20created-once%3A%20true%3Cbr%2F%3E%2B%20NO%20ownerReference%0A%20%20%20%20Note%20over%20PVC%3A%20Active%20%26%20Managed%20Once%0A%0A%20%20%20%20Note%20over%20Tenant%2CPVC%3A%20Phase%202%3A%20Deletion%0A%20%20%20%20User-%3E%3ETenant%3A%20Delete%20Tenant%0A%20%20%20%20Tenant-%3E%3EOperator%3A%20Finalizer%20runs%0A%20%20%20%20Operator-%3E%3EPVC%3A%20Add%20orphan%20labels%3Cbr%2F%3E(created-once%3A%20true%20REMAINS)%0A%20%20%20%20Note%20over%20PVC%3A%20Orphaned%20but%20exists%3Cbr%2F%3Eorphaned%3A%20true%3Cbr%2F%3Ecreated-once%3A%20true%0A%0A%20%20%20%20Note%20over%20Tenant%2CPVC%3A%20Phase%203%3A%20Recreation%20(Same%20UID)%0A%20%20%20%20User-%3E%3ETenant%3A%20Create%20Tenant%20(uid%3A%20acme)%0A%20%20%20%20Tenant-%3E%3EOperator%3A%20Reconcile%0A%20%20%20%20Operator-%3E%3EPVC%3A%20Check%20exists%20%26%20has%20created-once%3F%0A%20%20%20%20PVC--%3E%3EOperator%3A%20Yes%2C%20has%20created-once%0A%20%20%20%20Operator-%3E%3EOperator%3A%20SKIP%20(continue)%3Cbr%2F%3ECount%20as%20Ready%3Cbr%2F%3ENO%20ApplyResource%20call%0A%20%20%20%20Note%20over%20PVC%3A%20STILL%20ORPHANED%3Cbr%2F%3Eorphaned%3A%20true%20remains%3Cbr%2F%3Ecreated-once%3A%20true%20remains%0A"})]),fallback:a(()=>[...e[1]||(e[1]=[o(" Loading... ",-1)])]),_:1})),e[9]||(e[9]=s(`<p><strong>Manual Recovery:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Remove the created-once annotation to allow re-adoption</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> annotate</span><span style="color:#9ECBFF;"> pvc</span><span style="color:#9ECBFF;"> acme-data</span><span style="color:#9ECBFF;"> kubernetes-tenants.org/created-once-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Next reconciliation will call ApplyResource and remove orphan markers</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><hr><h2 id="example-2-init-job" tabindex="-1">Example 2: Init Job <a class="header-anchor" href="#example-2-init-job" aria-label="Permalink to &quot;Example 2: Init Job&quot;">‚Äã</a></h2><p><strong>Use Case:</strong> One-time initialization task that runs once per tenant and cleans up after tenant deletion.</p><h3 id="configuration-1" tabindex="-1">Configuration <a class="header-anchor" href="#configuration-1" aria-label="Permalink to &quot;Configuration&quot;">‚Äã</a></h3><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">jobs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">init</span></span>
<span class="line"><span style="color:#85E89D;">    creationPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Once</span><span style="color:#6A737D;">        # Run only once</span></span>
<span class="line"><span style="color:#85E89D;">    deletionPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Delete</span><span style="color:#6A737D;">      # Clean up after tenant deletion</span></span>
<span class="line"><span style="color:#85E89D;">    conflictPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Force</span><span style="color:#6A737D;">       # Re-create if needed</span></span>
<span class="line"><span style="color:#85E89D;">    patchStrategy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">replace</span><span style="color:#6A737D;">      # Exact job spec</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-init&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">batch/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Job</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">init</span></span>
<span class="line"><span style="color:#85E89D;">              image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">busybox</span></span>
<span class="line"><span style="color:#85E89D;">              command</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;sh&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;-c&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;echo Initializing {{ .uid }}&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">            restartPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Never</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="lifecycle-flow-1" tabindex="-1">Lifecycle Flow <a class="header-anchor" href="#lifecycle-flow-1" aria-label="Permalink to &quot;Lifecycle Flow&quot;">‚Äã</a></h3>`,8)),(n(),l(i,null,{default:a(()=>[r(t,{id:"mermaid-217",class:"mermaid my-class",graph:"flowchart%20TD%0A%20%20%20%20Start(%5BTenant%20Created%5D)%0A%20%20%20%20CheckExists%7BJob%20Exists%3F%7D%0A%20%20%20%20HasAnnotation%7BHas%20created-once%3Cbr%2F%3Eannotation%3F%7D%0A%20%20%20%20CheckConflict%7BJob%20owned%20by%3Cbr%2F%3Eanother%20controller%3F%7D%0A%20%20%20%20ForceApply%5BForce%20Take%20Ownership%3Cbr%2F%3ESSA%20with%20force%3Dtrue%5D%0A%20%20%20%20CreateJob%5BCreate%20Job%3Cbr%2F%3E%2B%20Add%20annotation%3Cbr%2F%3E%2B%20ownerReference%5D%0A%20%20%20%20SkipCreate%5BSkip%20Creation%3Cbr%2F%3EJob%20Already%20Completed%5D%0A%20%20%20%20RunJob%5BJob%20Executes%20Once%5D%0A%20%20%20%20TemplateChange%5BTemplate%20Updated%5D%0A%20%20%20%20SkipUpdate%5BSkip%20Update%3Cbr%2F%3ECreationPolicy%3DOnce%3Cbr%2F%3EJob%20keeps%20running%5D%0A%20%20%20%20ManualDelete%5BUser%20Manually%3Cbr%2F%3EDeletes%20Job%5D%0A%20%20%20%20RecreateJob%5BRecreate%20Job%3Cbr%2F%3Eon%20Next%20Reconcile%5D%0A%20%20%20%20TenantDelete%5BTenant%20Deleted%5D%0A%20%20%20%20AutoDelete%5BKubernetes%20GC%3Cbr%2F%3EDeletes%20Job%3Cbr%2F%3Evia%20ownerReference%5D%0A%20%20%20%20Cleanup%5BCleanup%20Complete%5D%0A%0A%20%20%20%20Start%20--%3E%20CheckExists%0A%20%20%20%20CheckExists%20--%3E%7CNo%7C%20CreateJob%0A%20%20%20%20CheckExists%20--%3E%7CYes%7C%20HasAnnotation%0A%0A%20%20%20%20HasAnnotation%20--%3E%7CYes%7C%20SkipCreate%0A%20%20%20%20HasAnnotation%20--%3E%7CNo%7C%20CheckConflict%0A%0A%20%20%20%20CheckConflict%20--%3E%7CYes%7C%20ForceApply%0A%20%20%20%20CheckConflict%20--%3E%7CNo%7C%20CreateJob%0A%0A%20%20%20%20CreateJob%20--%3E%20RunJob%0A%20%20%20%20ForceApply%20--%3E%20RunJob%0A%20%20%20%20SkipCreate%20--%3E%20TemplateChange%0A%0A%20%20%20%20RunJob%20--%3E%20TemplateChange%0A%20%20%20%20TemplateChange%20--%3E%20SkipUpdate%0A%20%20%20%20SkipUpdate%20--%3E%20ManualDelete%0A%20%20%20%20ManualDelete%20--%3E%20RecreateJob%0A%20%20%20%20RecreateJob%20--%3E%20TenantDelete%0A%0A%20%20%20%20SkipUpdate%20--%3E%20TenantDelete%0A%20%20%20%20TenantDelete%20--%3E%20AutoDelete%0A%20%20%20%20AutoDelete%20--%3E%20Cleanup%0A%0A%20%20%20%20classDef%20createStyle%20fill%3A%23e8f5e9%2Cstroke%3A%234caf50%2Cstroke-width%3A2px%3B%0A%20%20%20%20classDef%20skipStyle%20fill%3A%23fff3e0%2Cstroke%3A%23ff9800%2Cstroke-width%3A2px%3B%0A%20%20%20%20classDef%20deleteStyle%20fill%3A%23ffebee%2Cstroke%3A%23f44336%2Cstroke-width%3A2px%3B%0A%20%20%20%20classDef%20forceStyle%20fill%3A%23fce4ec%2Cstroke%3A%23e91e63%2Cstroke-width%3A2px%3B%0A%0A%20%20%20%20class%20CreateJob%2CRecreateJob%20createStyle%3B%0A%20%20%20%20class%20SkipCreate%2CSkipUpdate%20skipStyle%3B%0A%20%20%20%20class%20AutoDelete%2CCleanup%20deleteStyle%3B%0A%20%20%20%20class%20ForceApply%20forceStyle%3B%0A"})]),fallback:a(()=>[...e[2]||(e[2]=[o(" Loading... ",-1)])]),_:1})),e[10]||(e[10]=s(`<h3 id="rationale-1" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-1" aria-label="Permalink to &quot;Rationale&quot;">‚Äã</a></h3><ul><li><strong><code>Once</code></strong>: Initialization runs only once - even if template changes, job won&#39;t re-run</li><li><strong><code>Delete</code></strong>: No need to keep job history after tenant deletion</li><li><strong><code>Force</code></strong>: Operator owns this resource exclusively - takes ownership if conflict</li><li><strong><code>replace</code></strong>: Ensures exact job spec match</li></ul><h3 id="key-behaviors-1" tabindex="-1">Key Behaviors <a class="header-anchor" href="#key-behaviors-1" aria-label="Permalink to &quot;Key Behaviors&quot;">‚Äã</a></h3><ul><li>‚úÖ Runs once per tenant lifetime</li><li>‚úÖ Automatically cleaned up on tenant deletion</li><li>‚úÖ Force takes ownership from conflicts</li><li>üîÑ Re-creates if manually deleted (but still runs only once due to created-once annotation)</li></ul><hr><h2 id="example-3-application-deployment" tabindex="-1">Example 3: Application Deployment <a class="header-anchor" href="#example-3-application-deployment" aria-label="Permalink to &quot;Example 3: Application Deployment&quot;">‚Äã</a></h2><p><strong>Use Case:</strong> Main application that should stay synchronized with template changes and clean up completely on deletion.</p><h3 id="configuration-2" tabindex="-1">Configuration <a class="header-anchor" href="#configuration-2" aria-label="Permalink to &quot;Configuration&quot;">‚Äã</a></h3><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">deployments</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app</span></span>
<span class="line"><span style="color:#85E89D;">    creationPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">WhenNeeded</span><span style="color:#6A737D;">  # Keep updated</span></span>
<span class="line"><span style="color:#85E89D;">    deletionPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Delete</span><span style="color:#6A737D;">      # Clean up on deletion</span></span>
<span class="line"><span style="color:#85E89D;">    conflictPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Stuck</span><span style="color:#6A737D;">       # Safe default</span></span>
<span class="line"><span style="color:#85E89D;">    patchStrategy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apply</span><span style="color:#6A737D;">        # Kubernetes best practice</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-app&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#85E89D;">        selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">              app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app</span></span>
<span class="line"><span style="color:#85E89D;">              image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;nginx:latest&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="lifecycle-flow-2" tabindex="-1">Lifecycle Flow <a class="header-anchor" href="#lifecycle-flow-2" aria-label="Permalink to &quot;Lifecycle Flow&quot;">‚Äã</a></h3>`,10)),(n(),l(i,null,{default:a(()=>[r(t,{id:"mermaid-282",class:"mermaid my-class",graph:"flowchart%20TD%0A%20%20%20%20Start(%5BTenant%20Created%5D)%0A%20%20%20%20CheckExists%7BDeployment%3Cbr%2F%3EExists%3F%7D%0A%20%20%20%20CheckConflict%7BOwned%20by%20another%3Cbr%2F%3Econtroller%3F%7D%0A%20%20%20%20MarkDegraded%5BMark%20Tenant%20Degraded%3Cbr%2F%3EStop%20Reconciliation%3Cbr%2F%3EEmit%20ResourceConflict%5D%0A%20%20%20%20CreateDeploy%5BCreate%20Deployment%3Cbr%2F%3ESSA%20with%20fieldManager%3Cbr%2F%3E%2B%20ownerReference%5D%0A%20%20%20%20DeployRunning%5BDeployment%20Running%5D%0A%20%20%20%20TemplateChange%5BTemplate%20Updated%3Cbr%2F%3EDB%20Data%20Changed%5D%0A%20%20%20%20ApplyUpdate%5BApply%20Changes%3Cbr%2F%3ESSA%20updates%20only%3Cbr%2F%3Emanaged%20fields%5D%0A%20%20%20%20DriftDetect%5BManual%20Change%3Cbr%2F%3EDetected%5D%0A%20%20%20%20AutoCorrect%5BAuto-Correct%20Drift%3Cbr%2F%3ERevert%20to%20desired%20state%5D%0A%20%20%20%20TenantDelete%5BTenant%20Deleted%5D%0A%20%20%20%20AutoDelete%5BKubernetes%20GC%3Cbr%2F%3EDeletes%20Deployment%3Cbr%2F%3E%2B%20Pods%20%2B%20ReplicaSets%5D%0A%20%20%20%20Cleanup%5BComplete%20Cleanup%5D%0A%0A%20%20%20%20Start%20--%3E%20CheckExists%0A%20%20%20%20CheckExists%20--%3E%7CNo%7C%20CreateDeploy%0A%20%20%20%20CheckExists%20--%3E%7CYes%7C%20CheckConflict%0A%0A%20%20%20%20CheckConflict%20--%3E%7CYes%7C%20MarkDegraded%0A%20%20%20%20CheckConflict%20--%3E%7CNo%7C%20DeployRunning%0A%0A%20%20%20%20CreateDeploy%20--%3E%20DeployRunning%0A%20%20%20%20DeployRunning%20--%3E%20TemplateChange%0A%20%20%20%20TemplateChange%20--%3E%20ApplyUpdate%0A%20%20%20%20ApplyUpdate%20--%3E%20DeployRunning%0A%0A%20%20%20%20DeployRunning%20--%3E%20DriftDetect%0A%20%20%20%20DriftDetect%20--%3E%20AutoCorrect%0A%20%20%20%20AutoCorrect%20--%3E%20DeployRunning%0A%0A%20%20%20%20DeployRunning%20--%3E%20TenantDelete%0A%20%20%20%20TenantDelete%20--%3E%20AutoDelete%0A%20%20%20%20AutoDelete%20--%3E%20Cleanup%0A%0A%20%20%20%20classDef%20createStyle%20fill%3A%23e8f5e9%2Cstroke%3A%234caf50%2Cstroke-width%3A2px%3B%0A%20%20%20%20classDef%20updateStyle%20fill%3A%23e3f2fd%2Cstroke%3A%232196f3%2Cstroke-width%3A2px%3B%0A%20%20%20%20classDef%20deleteStyle%20fill%3A%23ffebee%2Cstroke%3A%23f44336%2Cstroke-width%3A2px%3B%0A%20%20%20%20classDef%20errorStyle%20fill%3A%23fce4ec%2Cstroke%3A%23e91e63%2Cstroke-width%3A2px%3B%0A%0A%20%20%20%20class%20CreateDeploy%20createStyle%3B%0A%20%20%20%20class%20ApplyUpdate%2CAutoCorrect%20updateStyle%3B%0A%20%20%20%20class%20AutoDelete%2CCleanup%20deleteStyle%3B%0A%20%20%20%20class%20MarkDegraded%20errorStyle%3B%0A"})]),fallback:a(()=>[...e[3]||(e[3]=[o(" Loading... ",-1)])]),_:1})),e[11]||(e[11]=s(`<h3 id="rationale-2" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-2" aria-label="Permalink to &quot;Rationale&quot;">‚Äã</a></h3><ul><li><strong><code>WhenNeeded</code></strong>: Always keep deployment in sync with template and database</li><li><strong><code>Delete</code></strong>: Standard cleanup via ownerReference</li><li><strong><code>Stuck</code></strong>: Safe default - investigate conflicts rather than force override</li><li><strong><code>apply</code></strong>: SSA best practice - preserves fields from other controllers (e.g., HPA)</li></ul><h3 id="key-behaviors-2" tabindex="-1">Key Behaviors <a class="header-anchor" href="#key-behaviors-2" aria-label="Permalink to &quot;Key Behaviors&quot;">‚Äã</a></h3><ul><li>‚úÖ Continuously synchronized with template</li><li>‚úÖ Auto-corrects manual drift</li><li>‚úÖ Plays well with other controllers (HPA, VPA)</li><li>‚úÖ Complete cleanup on deletion</li><li>‚ö†Ô∏è Stops on conflicts for safety</li></ul><hr><h2 id="example-4-shared-infrastructure" tabindex="-1">Example 4: Shared Infrastructure <a class="header-anchor" href="#example-4-shared-infrastructure" aria-label="Permalink to &quot;Example 4: Shared Infrastructure&quot;">‚Äã</a></h2><p><strong>Use Case:</strong> Configuration data that should stay updated but survive tenant deletion for debugging or shared resource references.</p><h3 id="configuration-3" tabindex="-1">Configuration <a class="header-anchor" href="#configuration-3" aria-label="Permalink to &quot;Configuration&quot;">‚Äã</a></h3><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">configMaps</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">shared-config</span></span>
<span class="line"><span style="color:#85E89D;">    creationPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">WhenNeeded</span><span style="color:#6A737D;">  # Maintain config</span></span>
<span class="line"><span style="color:#85E89D;">    deletionPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Retain</span><span style="color:#6A737D;">      # Keep config for investigation</span></span>
<span class="line"><span style="color:#85E89D;">    conflictPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Force</span><span style="color:#6A737D;">       # Operator manages configs</span></span>
<span class="line"><span style="color:#85E89D;">    patchStrategy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apply</span><span style="color:#6A737D;">        # SSA</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-shared-config&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="color:#85E89D;">      data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        config.json</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#9ECBFF;">          {</span></span>
<span class="line"><span style="color:#9ECBFF;">            &quot;tenantId&quot;: &quot;{{ .uid }}&quot;,</span></span>
<span class="line"><span style="color:#9ECBFF;">            &quot;environment&quot;: &quot;production&quot;,</span></span>
<span class="line"><span style="color:#9ECBFF;">            &quot;version&quot;: &quot;1.0&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">          }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="lifecycle-flow-3" tabindex="-1">Lifecycle Flow <a class="header-anchor" href="#lifecycle-flow-3" aria-label="Permalink to &quot;Lifecycle Flow&quot;">‚Äã</a></h3>`,10)),(n(),l(i,null,{default:a(()=>[r(t,{id:"mermaid-352",class:"mermaid my-class",graph:"flowchart%20TD%0A%20%20%20%20Start(%5BTenant%20Created%5D)%0A%20%20%20%20CheckExists%7BConfigMap%3Cbr%2F%3EExists%3F%7D%0A%20%20%20%20CheckConflict%7BOwned%20by%20another%3Cbr%2F%3Econtroller%3F%7D%0A%20%20%20%20ForceTake%5BForce%20Take%20Ownership%3Cbr%2F%3ESSA%20with%20force%3Dtrue%3Cbr%2F%3E%2B%20Label%20tracking%20only%3Cbr%2F%3ENO%20ownerReference%5D%0A%20%20%20%20CreateCM%5BCreate%20ConfigMap%3Cbr%2F%3ESSA%20apply%3Cbr%2F%3E%2B%20Label%20tracking%20only%3Cbr%2F%3ENO%20ownerReference%5D%0A%20%20%20%20CMActive%5BConfigMap%20Active%5D%0A%20%20%20%20TemplateChange%5BTemplate%20Updated%3Cbr%2F%3EDB%20Data%20Changed%5D%0A%20%20%20%20ApplyUpdate%5BApply%20Changes%3Cbr%2F%3ESSA%20updates%20config%20data%3Cbr%2F%3EForce%20if%20conflict%5D%0A%20%20%20%20OtherPodRef%5BOther%20Pods%2FServices%3Cbr%2F%3EReference%20ConfigMap%5D%0A%20%20%20%20TenantDelete%5BTenant%20Deleted%5D%0A%20%20%20%20RemoveLabels%5BRemove%20Tracking%20Labels%3Cbr%2F%3EAdd%20Orphan%20Labels%3Cbr%2F%3E%2B%20Timestamp%20%2B%20Reason%5D%0A%20%20%20%20CMRetained%5BConfigMap%20Retained%3Cbr%2F%3EAvailable%20for%20Investigation%3Cbr%2F%3Eor%20Shared%20Use%5D%0A%0A%20%20%20%20Start%20--%3E%20CheckExists%0A%20%20%20%20CheckExists%20--%3E%7CNo%7C%20CreateCM%0A%20%20%20%20CheckExists%20--%3E%7CYes%7C%20CheckConflict%0A%0A%20%20%20%20CheckConflict%20--%3E%7CYes%7C%20ForceTake%0A%20%20%20%20CheckConflict%20--%3E%7CNo%7C%20CMActive%0A%0A%20%20%20%20CreateCM%20--%3E%20CMActive%0A%20%20%20%20ForceTake%20--%3E%20CMActive%0A%0A%20%20%20%20CMActive%20--%3E%20TemplateChange%0A%20%20%20%20TemplateChange%20--%3E%20ApplyUpdate%0A%20%20%20%20ApplyUpdate%20--%3E%20CMActive%0A%0A%20%20%20%20CMActive%20--%3E%20OtherPodRef%0A%20%20%20%20OtherPodRef%20--%3E%20CMActive%0A%0A%20%20%20%20CMActive%20--%3E%20TenantDelete%0A%20%20%20%20TenantDelete%20--%3E%20RemoveLabels%0A%20%20%20%20RemoveLabels%20--%3E%20CMRetained%0A%0A%20%20%20%20classDef%20createStyle%20fill%3A%23e8f5e9%2Cstroke%3A%234caf50%2Cstroke-width%3A2px%3B%0A%20%20%20%20classDef%20updateStyle%20fill%3A%23e3f2fd%2Cstroke%3A%232196f3%2Cstroke-width%3A2px%3B%0A%20%20%20%20classDef%20retainStyle%20fill%3A%23fff3e0%2Cstroke%3A%23ff9800%2Cstroke-width%3A2px%3B%0A%20%20%20%20classDef%20forceStyle%20fill%3A%23fce4ec%2Cstroke%3A%23e91e63%2Cstroke-width%3A2px%3B%0A%0A%20%20%20%20class%20CreateCM%20createStyle%3B%0A%20%20%20%20class%20ApplyUpdate%20updateStyle%3B%0A%20%20%20%20class%20RemoveLabels%2CCMRetained%20retainStyle%3B%0A%20%20%20%20class%20ForceTake%20forceStyle%3B%0A"})]),fallback:a(()=>[...e[4]||(e[4]=[o(" Loading... ",-1)])]),_:1})),e[12]||(e[12]=s('<h3 id="rationale-3" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-3" aria-label="Permalink to &quot;Rationale&quot;">‚Äã</a></h3><ul><li><strong><code>WhenNeeded</code></strong>: Keep configmap data updated as template/database changes</li><li><strong><code>Retain</code></strong>: ConfigMap might be referenced by other resources or needed for debugging - <strong>NO ownerReference</strong> to prevent deletion</li><li><strong><code>Force</code></strong>: Operator is authoritative for this config - takes ownership if conflict exists</li><li><strong><code>apply</code></strong>: SSA for declarative configuration management</li></ul><h3 id="key-behaviors-3" tabindex="-1">Key Behaviors <a class="header-anchor" href="#key-behaviors-3" aria-label="Permalink to &quot;Key Behaviors&quot;">‚Äã</a></h3><ul><li>‚úÖ Continuously synchronized with changes</li><li>‚úÖ Force takes ownership from conflicts</li><li>‚úÖ Survives tenant deletion (label-based tracking)</li><li>üìä Available for investigation post-deletion</li><li>üîó Can be referenced by non-tenant resources</li></ul><h3 id="delete-and-recreate-with-whenneeded" tabindex="-1">Delete and Recreate with WhenNeeded <a class="header-anchor" href="#delete-and-recreate-with-whenneeded" aria-label="Permalink to &quot;Delete and Recreate with WhenNeeded&quot;">‚Äã</a></h3><p>Unlike Example 1 (PVC with <code>Once</code>), resources with <code>WhenNeeded</code> automatically re-adopt on recreation:</p>',6)),(n(),l(i,null,{default:a(()=>[r(t,{id:"mermaid-414",class:"mermaid my-class",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%0A%20%20%20%20participant%20Tenant%20as%20Tenant%20CR%0A%20%20%20%20participant%20Operator%0A%20%20%20%20participant%20ConfigMap%20as%20ConfigMap%3Cbr%2F%3E(acme-shared-config)%0A%0A%20%20%20%20Note%20over%20Tenant%2CConfigMap%3A%20Phase%201%3A%20Active%20Updates%0A%20%20%20%20User-%3E%3ETenant%3A%20Create%20Tenant%20(uid%3A%20acme)%0A%20%20%20%20Tenant-%3E%3EOperator%3A%20Reconcile%0A%20%20%20%20Operator-%3E%3EConfigMap%3A%20Create%20ConfigMap%3Cbr%2F%3ELabels%3A%20tenant%3Dacme-web%3Cbr%2F%3ENO%20ownerReference%0A%20%20%20%20Note%20over%20ConfigMap%3A%20Active%20%26%20Managed%3Cbr%2F%3ESyncs%20with%20template%0A%0A%20%20%20%20User-%3E%3ETenant%3A%20Update%20Template%3Cbr%2F%3E(change%20config%20data)%0A%20%20%20%20Tenant-%3E%3EOperator%3A%20Reconcile%0A%20%20%20%20Operator-%3E%3EConfigMap%3A%20Apply%20Updates%3Cbr%2F%3EForce%20if%20conflict%0A%20%20%20%20Note%20over%20ConfigMap%3A%20Updated%20with%20new%20data%0A%0A%20%20%20%20Note%20over%20Tenant%2CConfigMap%3A%20Phase%202%3A%20Deletion%20%26%20Retention%0A%20%20%20%20User-%3E%3ETenant%3A%20Delete%20Tenant%0A%20%20%20%20Tenant-%3E%3EOperator%3A%20Finalizer%20runs%0A%20%20%20%20Operator-%3E%3EConfigMap%3A%20Remove%20tracking%20labels%3Cbr%2F%3EAdd%20orphan%20labels%0A%20%20%20%20Note%20over%20ConfigMap%3A%20Orphaned%20but%20exists%3Cbr%2F%3ELast%20data%20preserved%0A%0A%20%20%20%20Note%20over%20Tenant%2CConfigMap%3A%20Phase%203%3A%20Re-adoption%20%26%20Resume%20Updates%0A%20%20%20%20User-%3E%3ETenant%3A%20Create%20Tenant%20(uid%3A%20acme)%0A%20%20%20%20Tenant-%3E%3EOperator%3A%20Reconcile%0A%20%20%20%20Operator-%3E%3EConfigMap%3A%20Check%20exists%20%26%20orphan%3F%0A%20%20%20%20ConfigMap--%3E%3EOperator%3A%20Yes%2C%20found%20orphan%0A%20%20%20%20Operator-%3E%3EConfigMap%3A%20Re-adopt%20%2B%20Apply%20Updates%0A%20%20%20%20Note%20over%20ConfigMap%3A%20Active%20%26%20Managed%20again%3Cbr%2F%3EUpdates%20resume%0A%0A%20%20%20%20User-%3E%3ETenant%3A%20Update%20Template%3Cbr%2F%3E(more%20changes)%0A%20%20%20%20Tenant-%3E%3EOperator%3A%20Reconcile%0A%20%20%20%20Operator-%3E%3EConfigMap%3A%20Apply%20Updates%0A%20%20%20%20Note%20over%20ConfigMap%3A%20Syncs%20continuously%0A"})]),fallback:a(()=>[...e[5]||(e[5]=[o(" Loading... ",-1)])]),_:1})),e[13]||(e[13]=s('<p><strong>Key Differences from Example 1:</strong></p><table tabindex="0"><thead><tr><th>Aspect</th><th>Example 1 (PVC)<br>Once + Retain</th><th>Example 4 (ConfigMap)<br>WhenNeeded + Retain</th></tr></thead><tbody><tr><td><strong>Updates</strong></td><td>üö´ Never (frozen after creation)</td><td>‚úÖ Always (syncs with template)</td></tr><tr><td><strong>Retention</strong></td><td>‚úÖ Yes (orphaned on delete)</td><td>‚úÖ Yes (orphaned on delete)</td></tr><tr><td><strong>Re-adoption</strong></td><td>‚ùå No (skipped due to created-once)</td><td>‚úÖ Yes (automatic on recreate)</td></tr><tr><td><strong>Force Ownership</strong></td><td>‚ùå No (Stuck policy)</td><td>‚úÖ Yes (Force policy)</td></tr></tbody></table><hr><h2 id="policy-combinations-summary" tabindex="-1">Policy Combinations Summary <a class="header-anchor" href="#policy-combinations-summary" aria-label="Permalink to &quot;Policy Combinations Summary&quot;">‚Äã</a></h2><p>Quick reference comparing all four examples:</p><table tabindex="0"><thead><tr><th>Aspect</th><th>PVC (Stateful)</th><th>Init Job</th><th>App Deployment</th><th>Shared Config</th></tr></thead><tbody><tr><td><strong>CreationPolicy</strong></td><td><code>Once</code></td><td><code>Once</code></td><td><code>WhenNeeded</code></td><td><code>WhenNeeded</code></td></tr><tr><td><strong>DeletionPolicy</strong></td><td><code>Retain</code></td><td><code>Delete</code></td><td><code>Delete</code></td><td><code>Retain</code></td></tr><tr><td><strong>ConflictPolicy</strong></td><td><code>Stuck</code></td><td><code>Force</code></td><td><code>Stuck</code></td><td><code>Force</code></td></tr><tr><td><strong>PatchStrategy</strong></td><td><code>apply</code></td><td><code>replace</code></td><td><code>apply</code></td><td><code>apply</code></td></tr><tr><td><strong>ownerReference</strong></td><td>‚ùå No</td><td>‚úÖ Yes</td><td>‚úÖ Yes</td><td>‚ùå No</td></tr><tr><td><strong>Updates</strong></td><td>üö´ Never</td><td>üö´ Never</td><td>‚úÖ Always</td><td>‚úÖ Always</td></tr><tr><td><strong>Survives Deletion</strong></td><td>‚úÖ Yes</td><td>‚ùå No</td><td>‚ùå No</td><td>‚úÖ Yes</td></tr><tr><td><strong>Auto-Cleanup</strong></td><td>‚ùå Manual</td><td>‚úÖ Auto (GC)</td><td>‚úÖ Auto (GC)</td><td>‚ùå Manual</td></tr><tr><td><strong>Drift Correction</strong></td><td>N/A (Once)</td><td>N/A (Once)</td><td>‚úÖ Yes</td><td>‚úÖ Yes</td></tr><tr><td><strong>Conflict Handling</strong></td><td>‚ö†Ô∏è Stop</td><td>üí™ Force</td><td>‚ö†Ô∏è Stop</td><td>üí™ Force</td></tr></tbody></table><p><strong>Legend:</strong></p><ul><li>‚úÖ Enabled / Yes</li><li>‚ùå Disabled / No</li><li>üö´ Never updates</li><li>‚ö†Ô∏è Safe mode (stops on conflict)</li><li>üí™ Aggressive (forces ownership)</li><li>N/A: Not applicable</li></ul><h2 id="decision-tree" tabindex="-1">Decision Tree <a class="header-anchor" href="#decision-tree" aria-label="Permalink to &quot;Decision Tree&quot;">‚Äã</a></h2><p>Choose the right policy combination for your use case:</p>',10)),(n(),l(i,null,{default:a(()=>[r(t,{id:"mermaid-720",class:"mermaid my-class",graph:"flowchart%20TD%0A%20%20%20%20Start(%5BChoose%20Policy%20Combination%5D)%0A%20%20%20%20Q1%7BResource%20holds%3Cbr%2F%3Epersistent%20data%3F%7D%0A%20%20%20%20Q2%7BNeeds%20continuous%3Cbr%2F%3Eupdates%3F%7D%0A%20%20%20%20Q3%7BRuns%20only%20once%3F%7D%0A%20%20%20%20Q4%7BShould%20survive%3Cbr%2F%3Etenant%20deletion%3F%7D%0A%20%20%20%20Q5%7BConflict%3Cbr%2F%3Etolerance%3F%7D%0A%0A%20%20%20%20Result1%5BExample%201%3A%20PVC%3Cbr%2F%3EOnce%20%2B%20Retain%20%2B%20Stuck%5D%0A%20%20%20%20Result2%5BExample%202%3A%20Init%20Job%3Cbr%2F%3EOnce%20%2B%20Delete%20%2B%20Force%5D%0A%20%20%20%20Result3%5BExample%203%3A%20App%20Deployment%3Cbr%2F%3EWhenNeeded%20%2B%20Delete%20%2B%20Stuck%5D%0A%20%20%20%20Result4%5BExample%204%3A%20Shared%20Config%3Cbr%2F%3EWhenNeeded%20%2B%20Retain%20%2B%20Force%5D%0A%0A%20%20%20%20Start%20--%3E%20Q1%0A%20%20%20%20Q1%20--%3E%7CYes%7C%20Q4%0A%20%20%20%20Q1%20--%3E%7CNo%7C%20Q2%0A%0A%20%20%20%20Q4%20--%3E%7CYes%7C%20Result1%0A%20%20%20%20Q4%20--%3E%7CNo%7C%20Q3%0A%0A%20%20%20%20Q3%20--%3E%7CYes%7C%20Q5%0A%20%20%20%20Q3%20--%3E%7CNo%7C%20Q2%0A%0A%20%20%20%20Q5%20--%3E%7CForce%7C%20Result2%0A%20%20%20%20Q5%20--%3E%7CStuck%7C%20Result1%0A%0A%20%20%20%20Q2%20--%3E%7CYes%7C%20Q4%0A%20%20%20%20Q2%20--%3E%7CNo%7C%20Q3%0A%0A%20%20%20%20Q4%20--%3E%7CYes%7C%20Result4%0A%20%20%20%20Q4%20--%3E%7CNo%7C%20Result3%0A%0A%20%20%20%20classDef%20decisionStyle%20fill%3A%23fff3e0%2Cstroke%3A%23ff9800%2Cstroke-width%3A2px%3B%0A%20%20%20%20classDef%20resultStyle%20fill%3A%23e8f5e9%2Cstroke%3A%234caf50%2Cstroke-width%3A2px%3B%0A%0A%20%20%20%20class%20Q1%2CQ2%2CQ3%2CQ4%2CQ5%20decisionStyle%3B%0A%20%20%20%20class%20Result1%2CResult2%2CResult3%2CResult4%20resultStyle%3B%0A"})]),fallback:a(()=>[...e[6]||(e[6]=[o(" Loading... ",-1)])]),_:1})),e[14]||(e[14]=s('<h2 id="see-also" tabindex="-1">See Also <a class="header-anchor" href="#see-also" aria-label="Permalink to &quot;See Also&quot;">‚Äã</a></h2><ul><li><a href="./policies.html">Policies Guide</a> - Core concepts and policy types</li><li><a href="./field-ignore.html">Field-Level Ignore Control</a> - Fine-grained field management</li><li><a href="./dependencies.html">Dependencies Guide</a> - Resource ordering</li><li><a href="./troubleshooting.html">Troubleshooting</a> - Common policy issues</li></ul>',2))])}const g=p(E,[["render",C]]);export{m as __pageData,g as default};
