import{_ as n,c as a,o as l,a2 as e}from"./chunks/framework.9Uv4PgnO.js";const u=JSON.parse('{"title":"Runbook: High Conflict Rate","description":"","frontmatter":{},"headers":[],"relativePath":"runbooks/high-conflict-rate.md","filePath":"runbooks/high-conflict-rate.md","lastUpdated":1762417427000}'),p={name:"runbooks/high-conflict-rate.md"};function o(t,s,r,c,i,F){return l(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="runbook-high-conflict-rate" tabindex="-1">Runbook: High Conflict Rate <a class="header-anchor" href="#runbook-high-conflict-rate" aria-label="Permalink to &quot;Runbook: High Conflict Rate&quot;">​</a></h1><h2 id="alert-details" tabindex="-1">Alert Details <a class="header-anchor" href="#alert-details" aria-label="Permalink to &quot;Alert Details&quot;">​</a></h2><p><strong>Alert Name:</strong> <code>TenantHighConflictRate</code><strong>Severity:</strong> Warning <strong>Threshold:</strong> rate(tenant_conflicts_total[5m]) &gt; 0.1 for 10+ minutes</p><h2 id="description" tabindex="-1">Description <a class="header-anchor" href="#description" aria-label="Permalink to &quot;Description&quot;">​</a></h2><p>This alert fires when a tenant is experiencing a high rate of conflicts (&gt;0.1 conflicts per second sustained for 10+ minutes). This indicates repeated attempts to create or update resources that conflict with existing ones, suggesting a persistent configuration or naming issue.</p><h2 id="symptoms" tabindex="-1">Symptoms <a class="header-anchor" href="#symptoms" aria-label="Permalink to &quot;Symptoms&quot;">​</a></h2><ul><li>Tenant experiencing continuous conflict errors</li><li>Reconciliation repeatedly attempting same operations</li><li>Resource creation/updates failing repeatedly</li><li>Events showing recurring conflict messages</li><li>Tenant may be degraded or stuck</li></ul><h2 id="possible-causes" tabindex="-1">Possible Causes <a class="header-anchor" href="#possible-causes" aria-label="Permalink to &quot;Possible Causes&quot;">​</a></h2><ol><li><p><strong>Reconciliation Loop</strong></p><ul><li>Operator repeatedly trying to apply same conflicting resource</li><li>Conflict not resolving automatically</li><li>ConflictPolicy set to Stuck (default) preventing resolution</li></ul></li><li><p><strong>Naming Pattern Issues</strong></p><ul><li>Insufficient uniqueness in name generation</li><li>Template variables not providing uniqueness</li><li>Multiple tenants generating same names</li></ul></li><li><p><strong>External Changes</strong></p><ul><li>External system continuously modifying resources</li><li>Another controller competing for same resources</li><li>Manual interventions fighting operator changes</li></ul></li><li><p><strong>Rapid Tenant Churn</strong></p><ul><li>Tenants being created and deleted rapidly</li><li>Resources not cleaned up before recreation</li><li>Timing issues with resource lifecycle</li></ul></li><li><p><strong>Template Changes</strong></p><ul><li>Recent template update causing naming conflicts</li><li>Changes to nameTemplate creating collisions</li><li>Multiple versions of template active</li></ul></li></ol><h2 id="diagnosis" tabindex="-1">Diagnosis <a class="header-anchor" href="#diagnosis" aria-label="Permalink to &quot;Diagnosis&quot;">​</a></h2><h3 id="_1-check-conflict-rate-and-pattern" tabindex="-1">1. Check Conflict Rate and Pattern <a class="header-anchor" href="#_1-check-conflict-rate-and-pattern" aria-label="Permalink to &quot;1. Check Conflict Rate and Pattern&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Check current conflict count for tenant</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">tenant-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -o</span><span style="color:#9ECBFF;"> jsonpath=&#39;{.status.resourcesConflicted}&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Get conflict events</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> describe</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">tenant-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> grep</span><span style="color:#79B8FF;"> -i</span><span style="color:#9ECBFF;"> conflict</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check operator logs for conflict pattern</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app=tenant-operator</span><span style="color:#79B8FF;"> --tail=500</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> grep</span><span style="color:#79B8FF;"> -i</span><span style="color:#9ECBFF;"> &quot;conflict.*&lt;tenant-name&gt;&quot;</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> head</span><span style="color:#79B8FF;"> -20</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_2-identify-conflicting-resources" tabindex="-1">2. Identify Conflicting Resources <a class="header-anchor" href="#_2-identify-conflicting-resources" aria-label="Permalink to &quot;2. Identify Conflicting Resources&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Get detailed conflict information from logs</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app=tenant-operator</span><span style="color:#79B8FF;"> --tail=1000</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> grep</span><span style="color:#79B8FF;"> -i</span><span style="color:#9ECBFF;"> &quot;conflict&quot;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> grep</span><span style="color:#9ECBFF;"> &quot;&lt;tenant-name&gt;&quot;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> awk</span><span style="color:#9ECBFF;"> &#39;{print $NF}&#39;</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> sort</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> uniq</span><span style="color:#79B8FF;"> -c</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check resource kinds involved</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app=tenant-operator</span><span style="color:#79B8FF;"> --tail=500</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> grep</span><span style="color:#9ECBFF;"> &quot;&lt;tenant-name&gt;.*conflict&quot;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> grep</span><span style="color:#79B8FF;"> -oP</span><span style="color:#9ECBFF;"> &#39;kind=\\K\\w+&#39;</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> sort</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> uniq</span><span style="color:#79B8FF;"> -c</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_3-check-conflict-policy" tabindex="-1">3. Check Conflict Policy <a class="header-anchor" href="#_3-check-conflict-policy" aria-label="Permalink to &quot;3. Check Conflict Policy&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Check tenant&#39;s conflict policies</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">tenant-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> grep</span><span style="color:#79B8FF;"> -A</span><span style="color:#79B8FF;"> 2</span><span style="color:#9ECBFF;"> conflictPolicy</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check if using Stuck policy (default)</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">tenant-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -o</span><span style="color:#9ECBFF;"> jsonpath=&#39;{.spec.resources[*].conflictPolicy}&#39;</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> tr</span><span style="color:#9ECBFF;"> &#39; &#39;</span><span style="color:#9ECBFF;"> &#39;\\n&#39;</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> sort</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> uniq</span><span style="color:#79B8FF;"> -c</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_4-check-resource-ownership" tabindex="-1">4. Check Resource Ownership <a class="header-anchor" href="#_4-check-resource-ownership" aria-label="Permalink to &quot;4. Check Resource Ownership&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Find the conflicting resource name from logs</span></span>
<span class="line"><span style="color:#E1E4E8;">RESOURCE_NAME</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;&lt;resource-name&gt;&quot;</span><span style="color:#6A737D;">  # Get from logs</span></span>
<span class="line"><span style="color:#E1E4E8;">RESOURCE_KIND</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;&lt;resource-kind&gt;&quot;</span><span style="color:#6A737D;">  # Get from logs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check who owns the resource</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#E1E4E8;"> $RESOURCE_KIND $RESOURCE_NAME </span><span style="color:#79B8FF;">-n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -o</span><span style="color:#9ECBFF;"> jsonpath=&#39;{.metadata.ownerReferences[*].name}&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check SSA field managers</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#E1E4E8;"> $RESOURCE_KIND $RESOURCE_NAME </span><span style="color:#79B8FF;">-n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -o</span><span style="color:#9ECBFF;"> jsonpath=&#39;{.metadata.managedFields[*].manager}&#39;</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> tr</span><span style="color:#9ECBFF;"> &#39; &#39;</span><span style="color:#9ECBFF;"> &#39;\\n&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_5-check-for-reconciliation-loop" tabindex="-1">5. Check for Reconciliation Loop <a class="header-anchor" href="#_5-check-for-reconciliation-loop" aria-label="Permalink to &quot;5. Check for Reconciliation Loop&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Monitor reconciliation attempts</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app=tenant-operator</span><span style="color:#79B8FF;"> --follow</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> grep</span><span style="color:#9ECBFF;"> &quot;Reconciling Tenant.*&lt;tenant-name&gt;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check reconciliation frequency (should not be constant)</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app=tenant-operator</span><span style="color:#79B8FF;"> --tail=100</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> grep</span><span style="color:#9ECBFF;"> &quot;&lt;tenant-name&gt;&quot;</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> grep</span><span style="color:#79B8FF;"> -c</span><span style="color:#9ECBFF;"> &quot;Reconciling&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_6-check-recent-template-changes" tabindex="-1">6. Check Recent Template Changes <a class="header-anchor" href="#_6-check-recent-template-changes" aria-label="Permalink to &quot;6. Check Recent Template Changes&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Get template history</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenanttemplate</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">template-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check for recent updates</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> events</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> --sort-by=</span><span style="color:#9ECBFF;">&#39;.lastTimestamp&#39;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> grep</span><span style="color:#9ECBFF;"> TenantTemplate</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Compare with previous version if using GitOps</span></span>
<span class="line"><span style="color:#B392F0;">git</span><span style="color:#9ECBFF;"> log</span><span style="color:#79B8FF;"> -p</span><span style="color:#79B8FF;"> --</span><span style="color:#9ECBFF;"> path/to/template.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="resolution" tabindex="-1">Resolution <a class="header-anchor" href="#resolution" aria-label="Permalink to &quot;Resolution&quot;">​</a></h2><h3 id="for-persistent-naming-conflicts" tabindex="-1">For Persistent Naming Conflicts <a class="header-anchor" href="#for-persistent-naming-conflicts" aria-label="Permalink to &quot;For Persistent Naming Conflicts&quot;">​</a></h3><ol><li><p><strong>Identify the naming issue:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Check nameTemplate pattern</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenanttemplate</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">template-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -o</span><span style="color:#9ECBFF;"> jsonpath=&#39;{.spec.deployments[*].nameTemplate}&#39;</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> tr</span><span style="color:#9ECBFF;"> &#39; &#39;</span><span style="color:#9ECBFF;"> &#39;\\n&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check if tenant variables provide uniqueness</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">tenant-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -o</span><span style="color:#9ECBFF;"> jsonpath=&#39;{.metadata.annotations}&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li><li><p><strong>Fix naming template:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> edit</span><span style="color:#9ECBFF;"> tenanttemplate</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">template-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Ensure uniqueness:</span></span>
<span class="line"><span style="color:#6A737D;"># nameTemplate: &quot;{{ .uid }}-myapp&quot;  # Add tenant UID</span></span>
<span class="line"><span style="color:#6A737D;"># OR</span></span>
<span class="line"><span style="color:#6A737D;"># nameTemplate: &quot;{{ printf \\&quot;%s-%s\\&quot; .uid .templateRef | trunc63 }}&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li><li><p><strong>Clean up and retry:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Delete conflicting resource</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> delete</span><span style="color:#E1E4E8;"> $RESOURCE_KIND $RESOURCE_NAME </span><span style="color:#79B8FF;">-n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Trigger reconciliation</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> annotate</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">tenant-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#9ECBFF;">  tenant.operator.kubernetes-tenants.org/reconcile=&quot;$(</span><span style="color:#B392F0;">date</span><span style="color:#9ECBFF;"> +%s)&quot;</span><span style="color:#79B8FF;"> --overwrite</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ol><h3 id="for-conflictpolicy-issues" tabindex="-1">For ConflictPolicy Issues <a class="header-anchor" href="#for-conflictpolicy-issues" aria-label="Permalink to &quot;For ConflictPolicy Issues&quot;">​</a></h3><p>If conflicts are expected and takeover is safe:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> edit</span><span style="color:#9ECBFF;"> tenanttemplate</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">template-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Change policy for affected resources:</span></span>
<span class="line"><span style="color:#6A737D;"># spec:</span></span>
<span class="line"><span style="color:#6A737D;">#   deployments:</span></span>
<span class="line"><span style="color:#6A737D;">#     - id: app</span></span>
<span class="line"><span style="color:#6A737D;">#       conflictPolicy: Force  # Take ownership forcefully</span></span>
<span class="line"><span style="color:#6A737D;">#       # ... rest of spec</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>Warning:</strong> Only use <code>Force</code> if:</p><ul><li>You own the conflicting resources</li><li>Takeover won&#39;t disrupt other systems</li><li>You understand the implications</li></ul><h3 id="for-external-controller-conflicts" tabindex="-1">For External Controller Conflicts <a class="header-anchor" href="#for-external-controller-conflicts" aria-label="Permalink to &quot;For External Controller Conflicts&quot;">​</a></h3><ol><li><p><strong>Identify competing controller:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Check field managers</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#E1E4E8;"> $RESOURCE_KIND $RESOURCE_NAME </span><span style="color:#79B8FF;">-n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -o</span><span style="color:#9ECBFF;"> json</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> jq</span><span style="color:#9ECBFF;"> &#39;.metadata.managedFields[]&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p><strong>Options:</strong></p><ul><li><strong>Option A:</strong> Disable competing controller</li><li><strong>Option B:</strong> Use different namespaces</li><li><strong>Option C:</strong> Coordinate field management via SSA</li><li><strong>Option D:</strong> Use Force policy (with caution)</li></ul></li><li><p><strong>Implement chosen solution:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Example: Add label to exclude from other controller</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> label</span><span style="color:#E1E4E8;"> $RESOURCE_KIND $RESOURCE_NAME </span><span style="color:#79B8FF;">-n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  &lt;</span><span style="color:#9ECBFF;">competing-controller-labe</span><span style="color:#E1E4E8;">l</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">=</span><span style="color:#79B8FF;">false</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol><h3 id="for-reconciliation-loop" tabindex="-1">For Reconciliation Loop <a class="header-anchor" href="#for-reconciliation-loop" aria-label="Permalink to &quot;For Reconciliation Loop&quot;">​</a></h3><ol><li><p><strong>Temporarily pause reconciliation:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># This capability may not exist - check operator docs</span></span>
<span class="line"><span style="color:#6A737D;"># If available:</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> annotate</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">tenant-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#9ECBFF;">  tenant.operator.kubernetes-tenants.org/pause=</span><span style="color:#79B8FF;">true</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li><li><p><strong>Fix root cause</strong> (naming, conflict policy, etc.)</p></li><li><p><strong>Resume reconciliation:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> annotate</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">tenant-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#9ECBFF;">  tenant.operator.kubernetes-tenants.org/pause-</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol><h3 id="emergency-mitigation" tabindex="-1">Emergency Mitigation <a class="header-anchor" href="#emergency-mitigation" aria-label="Permalink to &quot;Emergency Mitigation&quot;">​</a></h3><p>If high conflict rate is causing operator performance issues:</p><ol><li><p><strong>Identify affected tenants:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Find tenants with high conflict rate</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app=tenant-operator</span><span style="color:#79B8FF;"> --tail=5000</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> grep</span><span style="color:#79B8FF;"> -i</span><span style="color:#9ECBFF;"> conflict</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> awk</span><span style="color:#9ECBFF;"> &#39;{print $(NF-1)}&#39;</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> sort</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> uniq</span><span style="color:#79B8FF;"> -c</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> sort</span><span style="color:#79B8FF;"> -rn</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> head</span><span style="color:#79B8FF;"> -10</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p><strong>Temporarily remove problem tenant:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Backup tenant</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">tenant-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span><span style="color:#F97583;"> &gt;</span><span style="color:#9ECBFF;"> tenant-backup.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Delete tenant</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> delete</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">tenant-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Fix template issue</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> edit</span><span style="color:#9ECBFF;"> tenanttemplate</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">template-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Recreate tenant (will happen automatically from registry sync)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ol><h2 id="prevention" tabindex="-1">Prevention <a class="header-anchor" href="#prevention" aria-label="Permalink to &quot;Prevention&quot;">​</a></h2><ol><li><p><strong>Design unique naming patterns:</strong></p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Always include tenant UID</span></span>
<span class="line"><span style="color:#85E89D;">nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-{{ .resourceType }}&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># For shared namespaces, add more context</span></span>
<span class="line"><span style="color:#85E89D;">nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .registryId }}-{{ .uid }}-{{ .resourceType }}&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Ensure K8s compliance</span></span>
<span class="line"><span style="color:#85E89D;">nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ printf </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">%s-%s</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;"> .uid .resourceType | trunc63 }}&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li><li><p><strong>Set appropriate conflict policies:</strong></p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Default for most resources (safe)</span></span>
<span class="line"><span style="color:#85E89D;">conflictPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Stuck</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Only for resources you control</span></span>
<span class="line"><span style="color:#85E89D;">conflictPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Force</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p><strong>Namespace isolation:</strong></p><ul><li>Use dedicated namespaces per registry</li><li>Use per-tenant namespaces where appropriate</li><li>Avoid mixing manual and operator-managed resources</li></ul></li><li><p><strong>Test template changes:</strong></p><ul><li>Deploy to test environment first</li><li>Verify name uniqueness</li><li>Check for conflicts with existing resources</li><li>Use canary deployments for template updates</li></ul></li><li><p><strong>Monitor conflict metrics:</strong></p><div class="language-promql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">promql</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span># Set alerts for sustained conflict rates</span></span>
<span class="line"><span>rate(tenant_conflicts_total[5m]) &gt; 0.05</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Monitor by resource kind</span></span>
<span class="line"><span>rate(tenant_conflicts_total[5m]) by (resource_kind)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol><h2 id="monitoring" tabindex="-1">Monitoring <a class="header-anchor" href="#monitoring" aria-label="Permalink to &quot;Monitoring&quot;">​</a></h2><div class="language-promql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">promql</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span># Conflict rate per tenant</span></span>
<span class="line"><span>rate(tenant_conflicts_total[5m]) by (tenant, namespace)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Conflicts by resource kind</span></span>
<span class="line"><span>sum(rate(tenant_conflicts_total[5m])) by (resource_kind)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Conflicts by policy</span></span>
<span class="line"><span>sum(rate(tenant_conflicts_total[5m])) by (conflict_policy)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Total conflicts in timeframe</span></span>
<span class="line"><span>increase(tenant_conflicts_total[1h])</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Tenants with conflicts</span></span>
<span class="line"><span>count(rate(tenant_conflicts_total[5m]) &gt; 0)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="analysis-queries" tabindex="-1">Analysis Queries <a class="header-anchor" href="#analysis-queries" aria-label="Permalink to &quot;Analysis Queries&quot;">​</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Find top conflicting tenants</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app=tenant-operator</span><span style="color:#79B8FF;"> --tail=10000</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> grep</span><span style="color:#79B8FF;"> -i</span><span style="color:#9ECBFF;"> conflict</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> awk</span><span style="color:#9ECBFF;"> &#39;{for(i=1;i&lt;=NF;i++) if($i~/tenant=/) print $i}&#39;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> sort</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> uniq</span><span style="color:#79B8FF;"> -c</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> sort</span><span style="color:#79B8FF;"> -rn</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> head</span><span style="color:#79B8FF;"> -10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Find top conflicting resource kinds</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app=tenant-operator</span><span style="color:#79B8FF;"> --tail=10000</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> grep</span><span style="color:#79B8FF;"> -i</span><span style="color:#9ECBFF;"> conflict</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> awk</span><span style="color:#9ECBFF;"> &#39;{for(i=1;i&lt;=NF;i++) if($i~/kind=/) print $i}&#39;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> sort</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> uniq</span><span style="color:#79B8FF;"> -c</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> sort</span><span style="color:#79B8FF;"> -rn</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check conflict time distribution</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app=tenant-operator</span><span style="color:#79B8FF;"> --since=1h</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> grep</span><span style="color:#79B8FF;"> -i</span><span style="color:#9ECBFF;"> conflict</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> awk</span><span style="color:#9ECBFF;"> &#39;{print $1&quot; &quot;$2}&#39;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> cut</span><span style="color:#79B8FF;"> -d:</span><span style="color:#79B8FF;"> -f1</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> uniq</span><span style="color:#79B8FF;"> -c</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="related-alerts" tabindex="-1">Related Alerts <a class="header-anchor" href="#related-alerts" aria-label="Permalink to &quot;Related Alerts&quot;">​</a></h2><ul><li><code>TenantResourcesConflicted</code> - Shows current conflicted state</li><li><code>TenantNewConflictsDetected</code> - Info alert for new conflicts</li><li><code>TenantDegraded</code> - May fire if conflicts cause degradation</li><li><code>TenantReconciliationErrors</code> - High error rate may correlate</li></ul><h2 id="best-practices" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices" aria-label="Permalink to &quot;Best Practices&quot;">​</a></h2><ol><li><p><strong>Naming strategy:</strong></p><ul><li>Always include unique tenant identifier</li><li>Use consistent patterns across templates</li><li>Test naming uniqueness before deployment</li><li>Document naming conventions</li></ul></li><li><p><strong>Conflict policy strategy:</strong></p><ul><li>Start with <code>Stuck</code> (safe default)</li><li>Only use <code>Force</code> when necessary and documented</li><li>Review and justify all <code>Force</code> usages</li><li>Test policy changes in non-production</li></ul></li><li><p><strong>Resource management:</strong></p><ul><li>Avoid manual resource creation in operator namespaces</li><li>Use labels to identify resource ownership</li><li>Implement proper cleanup on tenant deletion</li><li>Coordinate with other controllers</li></ul></li><li><p><strong>Monitoring and alerting:</strong></p><ul><li>Monitor conflict rates continuously</li><li>Set alerts for sustained high rates</li><li>Track conflicts by resource kind</li><li>Review conflict patterns regularly</li></ul></li></ol><h2 id="escalation" tabindex="-1">Escalation <a class="header-anchor" href="#escalation" aria-label="Permalink to &quot;Escalation&quot;">​</a></h2><p>If high conflict rate persists:</p><ol><li><p>Collect detailed diagnostics:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Tenant details</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">tenant-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span><span style="color:#F97583;"> &gt;</span><span style="color:#9ECBFF;"> tenant.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Template</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenanttemplate</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">template-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span><span style="color:#F97583;"> &gt;</span><span style="color:#9ECBFF;"> template.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Conflicting resources</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> all</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span><span style="color:#F97583;"> &gt;</span><span style="color:#9ECBFF;"> resources.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Conflict history from logs</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app=tenant-operator</span><span style="color:#79B8FF;"> --tail=5000</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> grep</span><span style="color:#79B8FF;"> -i</span><span style="color:#9ECBFF;"> &quot;conflict.*&lt;tenant-name&gt;&quot;</span><span style="color:#F97583;"> &gt;</span><span style="color:#9ECBFF;"> conflicts.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Events</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> events</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> --sort-by=</span><span style="color:#9ECBFF;">&#39;.lastTimestamp&#39;</span><span style="color:#F97583;"> &gt;</span><span style="color:#9ECBFF;"> events.txt</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li><li><p>Analyze patterns:</p><ul><li>Is it isolated to one tenant or systemic?</li><li>Is it specific to one resource kind?</li><li>Did it start after a recent change?</li></ul></li><li><p>If unable to resolve:</p><ul><li>Review with platform engineering team</li><li>Check for known issues in operator repository</li><li>Open GitHub issue with diagnostics and analysis</li></ul></li></ol>`,50)])])}const b=n(p,[["render",o]]);export{u as __pageData,b as default};
