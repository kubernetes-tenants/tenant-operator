import{_ as p,C as o,c as r,o as n,a3 as a,b as c,w as l,a as t,G as E,a9 as i}from"./chunks/framework.By6ErOX9.js";const h=JSON.parse('{"title":"Blue-Green Deployment Pattern","description":"","frontmatter":{},"headers":[],"relativePath":"use-case-blue-green.md","filePath":"use-case-blue-green.md","lastUpdated":1763011429000}'),y={name:"use-case-blue-green.md"};function b(u,s,m,d,F,D){const e=o("Mermaid");return n(),r("div",null,[s[1]||(s[1]=a('<h1 id="blue-green-deployment-pattern" tabindex="-1">Blue-Green Deployment Pattern <a class="header-anchor" href="#blue-green-deployment-pattern" aria-label="Permalink to &quot;Blue-Green Deployment Pattern&quot;">​</a></h1><div class="info custom-block"><p class="custom-block-title">Multi-Tenancy Example</p><p>This guide uses <strong>Multi-Tenancy</strong> (SaaS application with multiple customers) as an example, which is the most common use case for Lynq. The pattern shown here can be adapted for any database-driven infrastructure automation scenario.</p></div><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>Implement zero-downtime deployments by maintaining two complete environments (blue and green) and switching traffic between them.</p><p>This pattern is useful when:</p><ul><li>You need instant rollback capability</li><li>You want to test new versions in production before switching traffic</li><li>You need to validate deployments with real production load</li><li>Zero-downtime is critical for your SLA</li></ul><h2 id="architecture" tabindex="-1">Architecture <a class="header-anchor" href="#architecture" aria-label="Permalink to &quot;Architecture&quot;">​</a></h2>',7)),(n(),c(i,null,{default:l(()=>[E(e,{id:"mermaid-42",class:"mermaid my-class",graph:"graph%20TB%0A%20%20%20%20DB%5B(Database%3Cbr%2F%3Edeployment_color%3A%3Cbr%2F%3Eblue%2Fgreen)%5D%0A%0A%20%20%20%20TO%5BLynq%5D%0A%0A%20%20%20%20BlueTemplate%5BLynqForm%3Cbr%2F%3Eblue-env%5D%0A%20%20%20%20GreenTemplate%5BLynqForm%3Cbr%2F%3Egreen-env%5D%0A%0A%20%20%20%20BlueDeployment%5BDeployment%3Cbr%2F%3Eacme-blue%5D%0A%20%20%20%20GreenDeployment%5BDeployment%3Cbr%2F%3Eacme-green%5D%0A%0A%20%20%20%20Service%5BService%3Cbr%2F%3Eacme-app%3Cbr%2F%3Eselector%3A%20color%3Dactive%5D%0A%0A%20%20%20%20Ingress%5BIngress%3Cbr%2F%3Eacme.example.com%5D%0A%0A%20%20%20%20Users%5BEnd%20Users%5D%0A%0A%20%20%20%20DB%20--%3E%7Ccolor%3Dblue%7C%20TO%0A%20%20%20%20TO%20--%3E%20BlueTemplate%0A%20%20%20%20TO%20--%3E%20GreenTemplate%0A%0A%20%20%20%20BlueTemplate%20--%3E%7Cactive%7C%20BlueDeployment%0A%20%20%20%20GreenTemplate%20--%3E%7Cinactive%7C%20GreenDeployment%0A%0A%20%20%20%20BlueDeployment%20--%3E%7Clabel%3A%20color%3Dactive%7C%20Service%0A%20%20%20%20GreenDeployment%20-.-%3E%7Clabel%3A%20color%3Dinactive%7C%20Service%0A%0A%20%20%20%20Service%20--%3E%20Ingress%0A%20%20%20%20Ingress%20--%3E%20Users%0A%0A%20%20%20%20style%20BlueDeployment%20fill%3A%23e3f2fd%2Cstroke%3A%231976d2%2Cstroke-width%3A3px%0A%20%20%20%20style%20GreenDeployment%20fill%3A%23e8f5e9%2Cstroke%3A%23388e3c%2Cstroke-width%3A1px%2Cstroke-dasharray%3A%205%205%0A%20%20%20%20style%20Service%20fill%3A%23fff3e0%2Cstroke%3A%23f57c00%2Cstroke-width%3A2px%0A"})]),fallback:l(()=>[...s[0]||(s[0]=[t(" Loading... ",-1)])]),_:1})),s[2]||(s[2]=a(`<h2 id="database-schema" tabindex="-1">Database Schema <a class="header-anchor" href="#database-schema" aria-label="Permalink to &quot;Database Schema&quot;">​</a></h2><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#F97583;"> TABLE</span><span style="color:#B392F0;"> nodes</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">  node_id </span><span style="color:#F97583;">VARCHAR</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">63</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">PRIMARY KEY</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  domain </span><span style="color:#F97583;">VARCHAR</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">NOT NULL</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  is_active </span><span style="color:#F97583;">BOOLEAN</span><span style="color:#F97583;"> DEFAULT</span><span style="color:#E1E4E8;"> TRUE,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  -- Blue-Green deployment control</span></span>
<span class="line"><span style="color:#E1E4E8;">  active_color </span><span style="color:#F97583;">VARCHAR</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">DEFAULT</span><span style="color:#9ECBFF;"> &#39;blue&#39;</span><span style="color:#E1E4E8;">,   </span><span style="color:#6A737D;">-- &#39;blue&#39; or &#39;green&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  blue_version </span><span style="color:#F97583;">VARCHAR</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">DEFAULT</span><span style="color:#9ECBFF;"> &#39;v1.0.0&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  green_version </span><span style="color:#F97583;">VARCHAR</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">DEFAULT</span><span style="color:#9ECBFF;"> &#39;v1.0.0&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  -- Deployment status tracking</span></span>
<span class="line"><span style="color:#E1E4E8;">  deployment_status </span><span style="color:#F97583;">VARCHAR</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">DEFAULT</span><span style="color:#9ECBFF;"> &#39;stable&#39;</span><span style="color:#E1E4E8;">,  </span><span style="color:#6A737D;">-- stable, deploying, testing, rolling-back</span></span>
<span class="line"><span style="color:#E1E4E8;">  last_deployment_at </span><span style="color:#F97583;">TIMESTAMP</span></span>
<span class="line"><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- Deployment workflow:</span></span>
<span class="line"><span style="color:#6A737D;">-- 1. Update inactive color&#39;s version (e.g., green_version = &#39;v2.0.0&#39;)</span></span>
<span class="line"><span style="color:#6A737D;">-- 2. Set deployment_status = &#39;deploying&#39;</span></span>
<span class="line"><span style="color:#6A737D;">-- 3. Operator creates/updates green deployment</span></span>
<span class="line"><span style="color:#6A737D;">-- 4. Run smoke tests against green</span></span>
<span class="line"><span style="color:#6A737D;">-- 5. Switch active_color from &#39;blue&#39; to &#39;green&#39;</span></span>
<span class="line"><span style="color:#6A737D;">-- 6. Set deployment_status = &#39;stable&#39;</span></span>
<span class="line"><span style="color:#6A737D;">-- 7. Blue environment now becomes next deployment target</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="lynqhub" tabindex="-1">LynqHub <a class="header-anchor" href="#lynqhub" aria-label="Permalink to &quot;LynqHub&quot;">​</a></h2><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.lynq.sh/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">LynqHub</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">blue-green-nodes</span></span>
<span class="line"><span style="color:#85E89D;">  namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">lynq-system</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  source</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#85E89D;">    syncInterval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#85E89D;">    mysql</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql.database.svc.cluster.local</span></span>
<span class="line"><span style="color:#85E89D;">      port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3306</span></span>
<span class="line"><span style="color:#85E89D;">      database</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nodes_db</span></span>
<span class="line"><span style="color:#85E89D;">      username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node_reader</span></span>
<span class="line"><span style="color:#85E89D;">      passwordRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-credentials</span></span>
<span class="line"><span style="color:#85E89D;">        key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">password</span></span>
<span class="line"><span style="color:#85E89D;">      table</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nodes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">  valueMappings</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    uid</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node_id</span></span>
<span class="line"><span style="color:#85E89D;">    hostOrUrl</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">domain</span></span>
<span class="line"><span style="color:#85E89D;">    activate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">is_active</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">  extraValueMappings</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    activeColor</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">active_color</span></span>
<span class="line"><span style="color:#85E89D;">    blueVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">blue_version</span></span>
<span class="line"><span style="color:#85E89D;">    greenVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">green_version</span></span>
<span class="line"><span style="color:#85E89D;">    deploymentStatus</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">deployment_status</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="lynqform" tabindex="-1">LynqForm <a class="header-anchor" href="#lynqform" aria-label="Permalink to &quot;LynqForm&quot;">​</a></h2><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.lynq.sh/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">LynqForm</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">blue-green-app</span></span>
<span class="line"><span style="color:#85E89D;">  namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">lynq-system</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  hubId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">blue-green-nodes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">  deployments</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#6A737D;">    # Blue Deployment</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">blue-deployment</span></span>
<span class="line"><span style="color:#85E89D;">      nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-blue&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      labelsTemplate</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        color</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;blue&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        active</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ if eq .activeColor </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">blue</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;"> }}true{{ else }}false{{ end }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ if eq .activeColor </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">blue</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;"> }}3{{ else }}1{{ end }}&quot;</span><span style="color:#6A737D;">  # Scale down inactive</span></span>
<span class="line"><span style="color:#85E89D;">        selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">            color</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;blue&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">              app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">              color</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;blue&quot;</span></span>
<span class="line"><span style="color:#85E89D;">              version</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .blueVersion }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app</span></span>
<span class="line"><span style="color:#85E89D;">                image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;registry.example.com/app:{{ .blueVersion }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">                env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ENVIRONMENT_COLOR</span></span>
<span class="line"><span style="color:#85E89D;">                    value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;blue&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">                  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">NODE_ID</span></span>
<span class="line"><span style="color:#85E89D;">                    value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">                ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                  - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"><span style="color:#85E89D;">                resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                  requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                    cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">500m</span></span>
<span class="line"><span style="color:#85E89D;">                    memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1Gi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    # Green Deployment</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">green-deployment</span></span>
<span class="line"><span style="color:#85E89D;">      nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-green&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      labelsTemplate</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        color</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;green&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        active</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ if eq .activeColor </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">green</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;"> }}true{{ else }}false{{ end }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ if eq .activeColor </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">green</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;"> }}3{{ else }}1{{ end }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">            color</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;green&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">              app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">              color</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;green&quot;</span></span>
<span class="line"><span style="color:#85E89D;">              version</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .greenVersion }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app</span></span>
<span class="line"><span style="color:#85E89D;">                image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;registry.example.com/app:{{ .greenVersion }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">                env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ENVIRONMENT_COLOR</span></span>
<span class="line"><span style="color:#85E89D;">                    value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;green&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">                  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">NODE_ID</span></span>
<span class="line"><span style="color:#85E89D;">                    value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">                ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                  - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"><span style="color:#85E89D;">                resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                  requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                    cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">500m</span></span>
<span class="line"><span style="color:#85E89D;">                    memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1Gi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Service routing to active color</span></span>
<span class="line"><span style="color:#85E89D;">  services</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">main-service</span></span>
<span class="line"><span style="color:#85E89D;">      nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-app&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      dependIds</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;blue-deployment&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;green-deployment&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          color</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .activeColor }}&quot;</span><span style="color:#6A737D;">  # Dynamic selector based on active color</span></span>
<span class="line"><span style="color:#85E89D;">        ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#85E89D;">            targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    # Dedicated services for testing inactive environment</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">blue-test-service</span></span>
<span class="line"><span style="color:#85E89D;">      nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-blue-test&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          color</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;blue&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#85E89D;">            targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">green-test-service</span></span>
<span class="line"><span style="color:#85E89D;">      nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-green-test&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          color</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;green&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#85E89D;">            targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Main ingress (routes to active)</span></span>
<span class="line"><span style="color:#85E89D;">  ingresses</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">main-ingress</span></span>
<span class="line"><span style="color:#85E89D;">      nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-ingress&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      dependIds</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;main-service&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        ingressClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#85E89D;">        rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .host }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">            http</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">              paths</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                - </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#85E89D;">                  pathType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="color:#85E89D;">                  backend</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                    service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                      name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-app&quot;</span></span>
<span class="line"><span style="color:#85E89D;">                      port</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                        number</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    # Test ingresses for pre-production validation</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">blue-test-ingress</span></span>
<span class="line"><span style="color:#85E89D;">      nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-blue-test&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      dependIds</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;blue-test-service&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        ingressClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#85E89D;">        rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-blue.test.example.com&quot;</span></span>
<span class="line"><span style="color:#85E89D;">            http</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">              paths</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                - </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#85E89D;">                  pathType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="color:#85E89D;">                  backend</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                    service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                      name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-blue-test&quot;</span></span>
<span class="line"><span style="color:#85E89D;">                      port</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                        number</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">green-test-ingress</span></span>
<span class="line"><span style="color:#85E89D;">      nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-green-test&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      dependIds</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;green-test-service&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        ingressClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#85E89D;">        rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-green.test.example.com&quot;</span></span>
<span class="line"><span style="color:#85E89D;">            http</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">              paths</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                - </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#85E89D;">                  pathType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="color:#85E89D;">                  backend</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                    service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                      name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-green-test&quot;</span></span>
<span class="line"><span style="color:#85E89D;">                      port</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                        number</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br></div></div><h2 id="deployment-workflow" tabindex="-1">Deployment Workflow <a class="header-anchor" href="#deployment-workflow" aria-label="Permalink to &quot;Deployment Workflow&quot;">​</a></h2><h3 id="step-1-deploy-to-inactive-environment" tabindex="-1">Step 1: Deploy to Inactive Environment <a class="header-anchor" href="#step-1-deploy-to-inactive-environment" aria-label="Permalink to &quot;Step 1: Deploy to Inactive Environment&quot;">​</a></h3><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">-- Current state: blue is active with v1.0.0</span></span>
<span class="line"><span style="color:#6A737D;">-- Deploy v2.0.0 to green (inactive)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">UPDATE</span><span style="color:#E1E4E8;"> nodes</span></span>
<span class="line"><span style="color:#F97583;">SET</span><span style="color:#E1E4E8;"> green_version </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;v2.0.0&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    deployment_status </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;deploying&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    last_deployment_at </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> NOW</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> node_id </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;acme-corp&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Lynq automatically updates green deployment with new version.</p><h3 id="step-2-test-inactive-environment" tabindex="-1">Step 2: Test Inactive Environment <a class="header-anchor" href="#step-2-test-inactive-environment" aria-label="Permalink to &quot;Step 2: Test Inactive Environment&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Smoke test against green environment</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#9ECBFF;"> https://acme-corp-green.test.example.com/healthz</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#9ECBFF;"> https://acme-corp-green.test.example.com/api/test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Run integration tests</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> run</span><span style="color:#9ECBFF;"> test-runner</span><span style="color:#79B8FF;"> --rm</span><span style="color:#79B8FF;"> -it</span><span style="color:#79B8FF;"> --image=curlimages/curl</span><span style="color:#79B8FF;"> --</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#9ECBFF;">  curl</span><span style="color:#79B8FF;"> -f</span><span style="color:#9ECBFF;"> https://acme-corp-green.test.example.com/api/comprehensive-test</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="step-3-switch-traffic-blue-→-green" tabindex="-1">Step 3: Switch Traffic (Blue → Green) <a class="header-anchor" href="#step-3-switch-traffic-blue-→-green" aria-label="Permalink to &quot;Step 3: Switch Traffic (Blue → Green)&quot;">​</a></h3><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">-- Switch active environment</span></span>
<span class="line"><span style="color:#F97583;">UPDATE</span><span style="color:#E1E4E8;"> nodes</span></span>
<span class="line"><span style="color:#F97583;">SET</span><span style="color:#E1E4E8;"> active_color </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;green&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    deployment_status </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;stable&#39;</span></span>
<span class="line"><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> node_id </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;acme-corp&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Lynq updates Service selector from <code>color: blue</code> to <code>color: green</code>. Traffic instantly switches.</p><h3 id="step-4-rollback-if-needed" tabindex="-1">Step 4: Rollback (if needed) <a class="header-anchor" href="#step-4-rollback-if-needed" aria-label="Permalink to &quot;Step 4: Rollback (if needed)&quot;">​</a></h3><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">-- Instant rollback by switching back</span></span>
<span class="line"><span style="color:#F97583;">UPDATE</span><span style="color:#E1E4E8;"> nodes</span></span>
<span class="line"><span style="color:#F97583;">SET</span><span style="color:#E1E4E8;"> active_color </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;blue&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    deployment_status </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;rolled-back&#39;</span></span>
<span class="line"><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> node_id </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;acme-corp&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="step-5-cleanup-old-version" tabindex="-1">Step 5: Cleanup Old Version <a class="header-anchor" href="#step-5-cleanup-old-version" aria-label="Permalink to &quot;Step 5: Cleanup Old Version&quot;">​</a></h3><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">-- After confirming green is stable, update blue to match</span></span>
<span class="line"><span style="color:#F97583;">UPDATE</span><span style="color:#E1E4E8;"> nodes</span></span>
<span class="line"><span style="color:#F97583;">SET</span><span style="color:#E1E4E8;"> blue_version </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;v2.0.0&#39;</span></span>
<span class="line"><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> node_id </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;acme-corp&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="monitoring" tabindex="-1">Monitoring <a class="header-anchor" href="#monitoring" aria-label="Permalink to &quot;Monitoring&quot;">​</a></h2><div class="language-promql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">promql</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span># Track active deployment color per node</span></span>
<span class="line"><span>lynqnode_deployment_color{lynqnode=&quot;acme-corp&quot;} == 1  # 1=blue, 2=green</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Monitor deployment status</span></span>
<span class="line"><span>lynqnode_deployment_status{status=&quot;deploying&quot;}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Alert on prolonged deployment</span></span>
<span class="line"><span>ALERT DeploymentStuck</span></span>
<span class="line"><span>  FOR 30m</span></span>
<span class="line"><span>  WHERE lynqnode_deployment_status{status=&quot;deploying&quot;} == 1</span></span>
<span class="line"><span>  ANNOTATIONS {</span></span>
<span class="line"><span>    summary = &quot;Deployment stuck for node {{ $labels.lynqnode }}&quot;</span></span>
<span class="line"><span>  }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="benefits" tabindex="-1">Benefits <a class="header-anchor" href="#benefits" aria-label="Permalink to &quot;Benefits&quot;">​</a></h2><ol><li><strong>Zero Downtime</strong>: Instant traffic switch between environments</li><li><strong>Safe Testing</strong>: Validate new version before exposing to users</li><li><strong>Instant Rollback</strong>: Switch back to previous version in seconds</li><li><strong>Resource Efficiency</strong>: Inactive environment can run with minimal replicas</li><li><strong>Database-Driven</strong>: All orchestration via database updates</li></ol><h2 id="limitations" tabindex="-1">Limitations <a class="header-anchor" href="#limitations" aria-label="Permalink to &quot;Limitations&quot;">​</a></h2><ol><li><strong>Resource Cost</strong>: Requires running two environments (though inactive can be scaled down)</li><li><strong>Database Compatibility</strong>: Schema changes must be backward compatible during transition</li><li><strong>State Management</strong>: Stateful applications require careful session handling</li><li><strong>Cost</strong>: Double resource usage during active deployment periods</li></ol><h2 id="related-documentation" tabindex="-1">Related Documentation <a class="header-anchor" href="#related-documentation" aria-label="Permalink to &quot;Related Documentation&quot;">​</a></h2><ul><li><a href="/templates.html">Templates Guide</a> - Template syntax and conditionals</li><li><a href="/policies.html">Policies</a> - Resource lifecycle management</li><li><a href="/monitoring.html">Monitoring</a> - Metrics and alerting</li><li><a href="/advanced-use-cases.html">Advanced Use Cases</a> - Other deployment patterns</li></ul><h2 id="next-steps" tabindex="-1">Next Steps <a class="header-anchor" href="#next-steps" aria-label="Permalink to &quot;Next Steps&quot;">​</a></h2><ul><li>Implement automated smoke tests</li><li>Set up deployment pipeline</li><li>Configure monitoring and alerts</li><li>Test rollback procedures</li></ul>`,29))])}const B=p(y,[["render",b]]);export{h as __pageData,B as default};
