import{_ as c,C as d,c as u,o as s,a2 as l,b as r,j as e,w as t,a,G as i,a8 as p}from"./chunks/framework.BmhNuda9.js";const C=JSON.parse('{"title":"Argo CD Integration Guide","description":"","frontmatter":{},"headers":[],"relativePath":"integration-argocd.md","filePath":"integration-argocd.md","lastUpdated":1762323966000}'),E={name:"integration-argocd.md"};function g(m,n,y,A,b,h){const o=d("Mermaid");return s(),u("div",null,[n[3]||(n[3]=l('<h1 id="argo-cd-integration-guide" tabindex="-1">Argo CD Integration Guide <a class="header-anchor" href="#argo-cd-integration-guide" aria-label="Permalink to &quot;Argo CD Integration Guide&quot;">​</a></h1><p>Deliver GitOps-driven tenant environments by mapping each <strong>Tenant</strong> to an <strong>Argo CD Application</strong>.</p><nav class="table-of-contents"><ul><li><a href="#overview">Overview</a><ul><li><a href="#core-benefits">Core Benefits</a></li></ul></li><li><a href="#prerequisites">Prerequisites</a></li><li><a href="#baseline-template-1-tenant-➝-1-application">Baseline Template (1 Tenant ➝ 1 Application)</a><ul><li><a href="#flow">Flow</a></li></ul></li><li><a href="#advanced-sync-patterns">Advanced Sync Patterns</a></li><li><a href="#additional-use-cases">Additional Use Cases</a><ul><li><a href="#_1-appset-fan-out-per-tenant-plan">1. AppSet Fan-Out per Tenant Plan</a></li><li><a href="#_2-multi-cluster-tenants-with-cluster-secrets">2. Multi-Cluster Tenants with Cluster Secrets</a></li><li><a href="#_3-canary-and-blue-green-releases">3. Canary and Blue/Green Releases</a></li></ul></li><li><a href="#operational-tips">Operational Tips</a></li><li><a href="#what-to-read-next">What to Read Next</a></li></ul></nav><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>Tenant Operator can render Argo CD <code>Application</code> manifests for every active tenant row. Each Tenant becomes the canonical source of truth for a corresponding Argo CD Application, enabling GitOps workflows, progressive delivery, and automated cleanup.</p>',5)),(s(),r(p,null,{default:t(()=>[i(o,{id:"mermaid-15",class:"mermaid my-class",graph:"flowchart%20LR%0A%20%20%20%20Registry%5B%22TenantRegistry%3Cbr%2F%3EDB%20rows%22%5D%0A%20%20%20%20Template%5B%22TenantTemplate%3Cbr%2F%3EArgo%20CD%20manifest%22%5D%0A%20%20%20%20Tenant%5B%22Tenant%20CR%22%5D%0A%20%20%20%20ArgoApp%5B%22Argo%20CD%20Application%22%5D%0A%20%20%20%20ArgoCD%5B%22Argo%20CD%20Controller%22%5D%0A%20%20%20%20Targets%5B%22Target%20Cluster%20%2F%20Namespace%22%5D%0A%0A%20%20%20%20Registry%20--%3E%20Template%20--%3E%20Tenant%20--%3E%20ArgoApp%20--%3E%20ArgoCD%20--%3E%20Targets%0A%0A%20%20%20%20classDef%20control%20fill%3A%23e3f2fd%2Cstroke%3A%2364b5f6%2Cstroke-width%3A2px%3B%0A%20%20%20%20classDef%20argocd%20fill%3A%23fff3e0%2Cstroke%3A%23ffb74d%2Cstroke-width%3A2px%3B%0A%20%20%20%20class%20Registry%2CTemplate%2CTenant%20control%3B%0A%20%20%20%20class%20ArgoApp%2CArgoCD%20argocd%3B%0A"})]),fallback:t(()=>[...n[0]||(n[0]=[a(" Loading... ",-1)])]),_:1})),n[4]||(n[4]=l('<h3 id="core-benefits" tabindex="-1">Core Benefits <a class="header-anchor" href="#core-benefits" aria-label="Permalink to &quot;Core Benefits&quot;">​</a></h3><ul><li><strong>1:1 Mapping</strong> – Every Tenant owns exactly one Argo CD Application (<code>Tenant</code> ↔️ <code>Application</code>).</li><li><strong>Automatic Sync</strong> – Application source paths follow tenant metadata (UID, plan, region).</li><li><strong>Declarative Cleanup</strong> – When a Tenant is deleted (or deactivated), the Argo CD Application and downstream workloads are removed.</li><li><strong>GitOps Alignment</strong> – Teams keep delivery pipelines in Git, while Tenant Operator handles orchestration and lifecycle.</li></ul><h2 id="prerequisites" tabindex="-1">Prerequisites <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;Prerequisites&quot;">​</a></h2><ul><li>Argo CD installed (v2.8+ recommended) and accessible from the tenant namespace.</li><li>ServiceAccount and RBAC granting Tenant Operator permission to create Argo CD <code>Application</code> objects in the Argo CD namespace (often <code>argocd</code>).</li><li>Tenant Operator chart deployed with namespace permissions covering the Argo CD API group.</li><li>Git repository that hosts tenant application configuration.</li></ul><h2 id="baseline-template-1-tenant-➝-1-application" tabindex="-1">Baseline Template (1 Tenant ➝ 1 Application) <a class="header-anchor" href="#baseline-template-1-tenant-➝-1-application" aria-label="Permalink to &quot;Baseline Template (1 Tenant ➝ 1 Application)&quot;">​</a></h2><p>The following template renders an Argo CD Application per Tenant. Each <code>Application</code> points to a unique Git path derived from tenant metadata.</p>',6)),n[5]||(n[5]=e("div",null,[e("div",{class:"language-yaml line-numbers-mode"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"yaml"),e("pre",{class:"shiki github-dark vp-code",tabindex:"0","v-pre":""},[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"apiVersion"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#9ECBFF"}},"operator.kubernetes-tenants.org/v1")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"kind"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#9ECBFF"}},"TenantTemplate")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"metadata"),e("span",{style:{color:"#E1E4E8"}},":")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"  name"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#9ECBFF"}},"argocd-app-template")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"spec"),e("span",{style:{color:"#E1E4E8"}},":")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"  registryId"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#9ECBFF"}},"saas-registry")]),a(`
`),e("span",{class:"line"}),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"  manifests"),e("span",{style:{color:"#E1E4E8"}},":")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#E1E4E8"}},"    - "),e("span",{style:{color:"#85E89D"}},"id"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#9ECBFF"}},"argocd-app")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"      nameTemplate"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#9ECBFF"}},'"{{ printf '),e("span",{style:{color:"#79B8FF"}},'\\"'),e("span",{style:{color:"#9ECBFF"}},"%s-app"),e("span",{style:{color:"#79B8FF"}},'\\"'),e("span",{style:{color:"#9ECBFF"}},' (.uid | trunc63) }}"')]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"      spec"),e("span",{style:{color:"#E1E4E8"}},":")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"        apiVersion"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#9ECBFF"}},"argoproj.io/v1alpha1")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"        kind"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#9ECBFF"}},"Application")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"        metadata"),e("span",{style:{color:"#E1E4E8"}},":")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"          namespace"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#9ECBFF"}},"argocd")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"          labels"),e("span",{style:{color:"#E1E4E8"}},":")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"            tenant.kubernetes-tenants.org/uid"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#9ECBFF"}},'"{{ .uid }}"')]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"            tenant.kubernetes-tenants.org/region"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#9ECBFF"}},'"{{ .region | default '),e("span",{style:{color:"#79B8FF"}},'\\"'),e("span",{style:{color:"#9ECBFF"}},"global"),e("span",{style:{color:"#79B8FF"}},'\\"'),e("span",{style:{color:"#9ECBFF"}},' }}"')]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"        spec"),e("span",{style:{color:"#E1E4E8"}},":")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"          project"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#9ECBFF"}},"tenants")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"          source"),e("span",{style:{color:"#E1E4E8"}},":")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"            repoURL"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#9ECBFF"}},"https://github.com/your-org/tenant-configs.git")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"            targetRevision"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#9ECBFF"}},"main")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"            path"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#9ECBFF"}},'"tenants/{{ .uid }}"')]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"          destination"),e("span",{style:{color:"#E1E4E8"}},":")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"            server"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#9ECBFF"}},"https://kubernetes.default.svc")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"            namespace"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#9ECBFF"}},'"{{ .uid }}-workspace"')]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"          syncPolicy"),e("span",{style:{color:"#E1E4E8"}},":")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"            automated"),e("span",{style:{color:"#E1E4E8"}},":")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"              prune"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#79B8FF"}},"true")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"              selfHeal"),e("span",{style:{color:"#E1E4E8"}},": "),e("span",{style:{color:"#79B8FF"}},"true")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#85E89D"}},"            syncOptions"),e("span",{style:{color:"#E1E4E8"}},":")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#E1E4E8"}},"              - "),e("span",{style:{color:"#9ECBFF"}},"CreateNamespace=true")]),a(`
`),e("span",{class:"line"},[e("span",{style:{color:"#E1E4E8"}},"              - "),e("span",{style:{color:"#9ECBFF"}},"ApplyOutOfSyncOnly=true")])])]),e("div",{class:"line-numbers-wrapper","aria-hidden":"true"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br"),e("span",{class:"line-number"},"5"),e("br"),e("span",{class:"line-number"},"6"),e("br"),e("span",{class:"line-number"},"7"),e("br"),e("span",{class:"line-number"},"8"),e("br"),e("span",{class:"line-number"},"9"),e("br"),e("span",{class:"line-number"},"10"),e("br"),e("span",{class:"line-number"},"11"),e("br"),e("span",{class:"line-number"},"12"),e("br"),e("span",{class:"line-number"},"13"),e("br"),e("span",{class:"line-number"},"14"),e("br"),e("span",{class:"line-number"},"15"),e("br"),e("span",{class:"line-number"},"16"),e("br"),e("span",{class:"line-number"},"17"),e("br"),e("span",{class:"line-number"},"18"),e("br"),e("span",{class:"line-number"},"19"),e("br"),e("span",{class:"line-number"},"20"),e("br"),e("span",{class:"line-number"},"21"),e("br"),e("span",{class:"line-number"},"22"),e("br"),e("span",{class:"line-number"},"23"),e("br"),e("span",{class:"line-number"},"24"),e("br"),e("span",{class:"line-number"},"25"),e("br"),e("span",{class:"line-number"},"26"),e("br"),e("span",{class:"line-number"},"27"),e("br"),e("span",{class:"line-number"},"28"),e("br"),e("span",{class:"line-number"},"29"),e("br"),e("span",{class:"line-number"},"30"),e("br"),e("span",{class:"line-number"},"31"),e("br"),e("span",{class:"line-number"},"32"),e("br"),e("span",{class:"line-number"},"33"),e("br"),e("span",{class:"line-number"},"34"),e("br")])])],-1)),n[6]||(n[6]=e("h3",{id:"flow",tabindex:"-1"},[a("Flow "),e("a",{class:"header-anchor",href:"#flow","aria-label":'Permalink to "Flow"'},"​")],-1)),(s(),r(p,null,{default:t(()=>[i(o,{id:"mermaid-78",class:"mermaid my-class",graph:"sequenceDiagram%0A%20%20%20%20participant%20DB%20as%20MySQL%20(Tenant%20Data)%0A%20%20%20%20participant%20Registry%20as%20TenantRegistry%20Controller%0A%20%20%20%20participant%20Tenant%20as%20Tenant%20CR%0A%20%20%20%20participant%20Operator%20as%20Tenant%20Controller%0A%20%20%20%20participant%20Argo%20as%20Argo%20CD%20Controller%0A%0A%20%20%20%20Registry-%3E%3EDB%3A%20SELECT%20active%20tenants%0A%20%20%20%20DB--%3E%3ERegistry%3A%20Tenant%20rows%0A%20%20%20%20Registry-%3E%3ETenant%3A%20Create%2FUpdate%20Tenant%20CR%0A%20%20%20%20Operator-%3E%3ETenant%3A%20Render%20Argo%20CD%20manifest%0A%20%20%20%20Operator-%3E%3EArgo%3A%20Apply%20Application%20(SSA)%0A%20%20%20%20Argo-%3E%3EArgo%3A%20Sync%20Git%20repo%0A%20%20%20%20Argo-%3E%3ECluster%3A%20Deploy%20tenant%20workloads%0A"})]),fallback:t(()=>[...n[1]||(n[1]=[a(" Loading... ",-1)])]),_:1})),n[7]||(n[7]=l('<h2 id="advanced-sync-patterns" tabindex="-1">Advanced Sync Patterns <a class="header-anchor" href="#advanced-sync-patterns" aria-label="Permalink to &quot;Advanced Sync Patterns&quot;">​</a></h2><div><table tabindex="0"><thead><tr><th>Pattern</th><th>Description</th><th>Tenant Template Hints</th></tr></thead><tbody><tr><td><strong>Environment Branching</strong></td><td>Target different Git branches per region or plan (<code>targetRevision: &quot;{{ ternary \\&quot;main\\&quot; \\&quot;staging\\&quot; (eq .planId \\&quot;enterprise\\&quot;) }}&quot;</code>).</td><td>Use extra value mappings for <code>planId</code>, <code>region</code>.</td></tr><tr><td><strong>Dynamic Paths</strong></td><td>Compose repo paths from UID segments (<code>path: &quot;tenants/{{ .region }}/{{ .uid }}&quot;</code>).</td><td>Use Sprig <code>splitList</code>, <code>join</code>, <code>default</code>.</td></tr><tr><td><strong>App-of-Apps</strong></td><td>Point each tenant to an <code>Application</code> that references tenant-specific sub-apps.</td><td>Render Application with <code>path: tenants/{{ .uid }}/apps</code>.</td></tr><tr><td><strong>Multi-Cluster Delivery</strong></td><td>Route tenants to dedicated clusters using Argo CD credentials (<code>destination.server</code>).</td><td>Map datasource columns to <code>clusterServer</code>, <code>clusterName</code>.</td></tr><tr><td><strong>Progressive Rollouts</strong></td><td>Annotate Applications for Argo Rollouts or Progressive Sync plugins.</td><td>Add <code>metadata.annotations</code> via templates.</td></tr></tbody></table></div><h2 id="additional-use-cases" tabindex="-1">Additional Use Cases <a class="header-anchor" href="#additional-use-cases" aria-label="Permalink to &quot;Additional Use Cases&quot;">​</a></h2><h3 id="_1-appset-fan-out-per-tenant-plan" tabindex="-1">1. AppSet Fan-Out per Tenant Plan <a class="header-anchor" href="#_1-appset-fan-out-per-tenant-plan" aria-label="Permalink to &quot;1. AppSet Fan-Out per Tenant Plan&quot;">​</a></h3><ul><li>Combine Tenant Operator with Argo CD ApplicationSet.</li><li>Tenant Operator renders a control-plane Application that references an ApplicationSet generator.</li><li>Generator reads tenant metadata (via ConfigMap/Secret) to produce feature-specific Applications per plan tier.</li></ul><h3 id="_2-multi-cluster-tenants-with-cluster-secrets" tabindex="-1">2. Multi-Cluster Tenants with Cluster Secrets <a class="header-anchor" href="#_2-multi-cluster-tenants-with-cluster-secrets" aria-label="Permalink to &quot;2. Multi-Cluster Tenants with Cluster Secrets&quot;">​</a></h3><ul><li>Add <code>extraValueMappings</code> for cluster credentials.</li><li>Tenant template creates: <ol><li>An Argo CD <code>ClusterSecret</code> (with kubeconfig) in the Argo CD namespace.</li><li>An <code>Application</code> targeting that cluster secret.</li></ol></li><li>Enables dedicated clusters per enterprise tenant.</li></ul><h3 id="_3-canary-and-blue-green-releases" tabindex="-1">3. Canary and Blue/Green Releases <a class="header-anchor" href="#_3-canary-and-blue-green-releases" aria-label="Permalink to &quot;3. Canary and Blue/Green Releases&quot;">​</a></h3><ul><li>Render two Applications per tenant (<code>tenant-app-canary</code>, <code>tenant-app-stable</code>) with different <code>targetRevision</code>.</li><li>Use <code>creationPolicy: Once</code> on the stable Application and <code>WhenNeeded</code> on the canary for rapid rollback.</li><li>Combine with Argo Rollouts by templating <code>analysis</code> and promotion hooks.</li></ul>',9)),(s(),r(p,null,{default:t(()=>[i(o,{id:"mermaid-231",class:"mermaid my-class",graph:"flowchart%20TD%0A%20%20%20%20TenantA%5B%22Tenant%20(Enterprise)%22%5D%0A%20%20%20%20Canary%5B%22Application%3Cbr%2F%3EtargetRevision%3Dcanary%22%5D%0A%20%20%20%20Stable%5B%22Application%3Cbr%2F%3EtargetRevision%3Dstable%22%5D%0A%20%20%20%20Rollouts%5B%22Argo%20Rollouts%20%2F%20Analysis%22%5D%0A%20%20%20%20Namespace%5B%22Tenant%20Namespace%22%5D%0A%0A%20%20%20%20TenantA%20--%3E%20Canary%20--%3E%20Rollouts%20--%3E%20Namespace%0A%20%20%20%20TenantA%20--%3E%20Stable%20--%3E%20Namespace%0A"})]),fallback:t(()=>[...n[2]||(n[2]=[a(" Loading... ",-1)])]),_:1})),n[8]||(n[8]=l('<h2 id="operational-tips" tabindex="-1">Operational Tips <a class="header-anchor" href="#operational-tips" aria-label="Permalink to &quot;Operational Tips&quot;">​</a></h2><ul><li>Label Applications with tenant metadata for quick filtering (<code>tenant.kubernetes-tenants.org/uid</code>).</li><li>Grant the operator service account access to <code>argoproj.io</code> API group via ClusterRole.</li><li>Monitor Argo CD sync status alongside Tenant status; both must be healthy for end-to-end readiness.</li><li>Use the <code>Retain</code> deletion policy when you need to keep Applications for post-mortem analysis.</li></ul><h2 id="what-to-read-next" tabindex="-1">What to Read Next <a class="header-anchor" href="#what-to-read-next" aria-label="Permalink to &quot;What to Read Next&quot;">​</a></h2><ul><li><a href="./templates.html">Templates Guide</a> – Advanced templating and function usage.</li><li><a href="./policies.html">Policies Guide</a> – Control resource lifecycle (Retain vs. Delete).</li><li><a href="./monitoring.html">Monitoring Guide</a> – Capture Argo CD and Tenant Operator metrics together.</li></ul>',4))])}const D=c(E,[["render",g]]);export{C as __pageData,D as default};
