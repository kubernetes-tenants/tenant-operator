import{_ as e,C as o,c as r,o as n,a2 as a,b as t,w as l,a as c,G as i,a3 as E}from"./chunks/framework.9Uv4PgnO.js";const C=JSON.parse('{"title":"ExternalDNS Integration Guide","description":"","frontmatter":{},"headers":[],"relativePath":"integration-external-dns.md","filePath":"integration-external-dns.md","lastUpdated":1762323966000}'),y={name:"integration-external-dns.md"};function b(u,s,m,d,F,D){const p=o("Mermaid");return n(),r("div",null,[s[1]||(s[1]=a('<h1 id="externaldns-integration-guide" tabindex="-1">ExternalDNS Integration Guide <a class="header-anchor" href="#externaldns-integration-guide" aria-label="Permalink to &quot;ExternalDNS Integration Guide&quot;">​</a></h1><p>This guide shows how to integrate Tenant Operator with ExternalDNS for automatic DNS record management.</p><nav class="table-of-contents"><ul><li><a href="#overview">Overview</a><ul><li><a href="#use-cases">Use Cases</a></li></ul></li><li><a href="#prerequisites">Prerequisites</a></li><li><a href="#installation">Installation</a><ul><li><a href="#_1-install-externaldns">1. Install ExternalDNS</a></li><li><a href="#_2-verify-externaldns-installation">2. Verify ExternalDNS Installation</a></li></ul></li><li><a href="#integration-with-tenant-operator">Integration with Tenant Operator</a><ul><li><a href="#basic-example-ingress-with-externaldns">Basic Example: Ingress with ExternalDNS</a></li><li><a href="#advanced-example-loadbalancer-service-with-externaldns">Advanced Example: LoadBalancer Service with ExternalDNS</a></li><li><a href="#multi-domain-example">Multi-Domain Example</a></li></ul></li><li><a href="#how-it-works">How It Works</a><ul><li><a href="#workflow">Workflow</a></li><li><a href="#dns-record-lifecycle">DNS Record Lifecycle</a></li></ul></li><li><a href="#externaldns-annotations-reference">ExternalDNS Annotations Reference</a><ul><li><a href="#common-annotations">Common Annotations</a></li><li><a href="#provider-specific-annotations">Provider-Specific Annotations</a></li></ul></li><li><a href="#complete-example-saas-application">Complete Example: SaaS Application</a></li><li><a href="#troubleshooting">Troubleshooting</a><ul><li><a href="#dns-records-not-created">DNS Records Not Created</a></li><li><a href="#dns-records-not-deleted">DNS Records Not Deleted</a></li><li><a href="#dns-propagation-delays">DNS Propagation Delays</a></li><li><a href="#ingress-not-getting-ip">Ingress Not Getting IP</a></li></ul></li><li><a href="#best-practices">Best Practices</a><ul><li><a href="#_1-use-separate-hosted-zones">1. Use Separate Hosted Zones</a></li><li><a href="#_2-set-appropriate-ttls">2. Set Appropriate TTLs</a></li><li><a href="#_3-use-dns-policy">3. Use DNS Policy</a></li><li><a href="#_4-monitor-dns-changes">4. Monitor DNS Changes</a></li><li><a href="#_5-use-txt-record-registry">5. Use TXT Record Registry</a></li></ul></li><li><a href="#see-also">See Also</a></li></ul></nav><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p><strong>ExternalDNS</strong> synchronizes exposed Kubernetes Services and Ingresses with DNS providers like AWS Route53, Google Cloud DNS, Cloudflare, and more. When integrated with Tenant Operator, each tenant&#39;s DNS records are automatically created and deleted as tenants are provisioned.</p>',5)),(n(),t(E,null,{default:l(()=>[i(p,{id:"mermaid-15",class:"mermaid my-class",graph:"flowchart%20LR%0A%20%20%20%20Tenant%5B%22Tenant%20CR%3Cbr%2F%3E(Ingress%2FService%20templates)%22%5D%0A%20%20%20%20Resource%5B%22Kubernetes%20Ingress%2FService%22%5D%0A%20%20%20%20ExternalDNS%5B%22ExternalDNS%20Controller%22%5D%0A%20%20%20%20Provider%5B%22DNS%20Provider%3Cbr%2F%3E(Route53%2C%20Cloudflare%2C%20...)%22%5D%0A%20%20%20%20DNS%5B%22DNS%20Records%3Cbr%2F%3E(tenant.example.com)%22%5D%0A%0A%20%20%20%20Tenant%20--%3E%20Resource%20--%3E%20ExternalDNS%20--%3E%20Provider%20--%3E%20DNS%0A%0A%20%20%20%20classDef%20tenant%20fill%3A%23e3f2fd%2Cstroke%3A%2364b5f6%2Cstroke-width%3A2px%3B%0A%20%20%20%20class%20Tenant%20tenant%3B%0A%20%20%20%20classDef%20external%20fill%3A%23f3e5f5%2Cstroke%3A%23ba68c8%2Cstroke-width%3A2px%3B%0A%20%20%20%20class%20ExternalDNS%20external%3B%0A%20%20%20%20classDef%20provider%20fill%3A%23fff8e1%2Cstroke%3A%23ffca28%2Cstroke-width%3A2px%3B%0A%20%20%20%20class%20Provider%2CDNS%20provider%3B%0A"})]),fallback:l(()=>[...s[0]||(s[0]=[c(" Loading... ",-1)])]),_:1})),s[2]||(s[2]=a(`<h3 id="use-cases" tabindex="-1">Use Cases <a class="header-anchor" href="#use-cases" aria-label="Permalink to &quot;Use Cases&quot;">​</a></h3><ul><li><strong>Multi-tenant SaaS</strong>: Automatic subdomain creation per tenant (e.g., <code>tenant-a.example.com</code>, <code>tenant-b.example.com</code>)</li><li><strong>Dynamic environments</strong>: DNS records follow tenant lifecycle (created/deleted with tenant)</li><li><strong>Multiple domains</strong>: Different tenants on different domains or subdomains</li><li><strong>SSL/TLS automation</strong>: Combined with cert-manager for automatic certificate provisioning</li></ul><h2 id="prerequisites" tabindex="-1">Prerequisites <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;Prerequisites&quot;">​</a></h2><div class="info custom-block"><p class="custom-block-title">Requirements</p><ul><li>Kubernetes cluster v1.11+</li><li>Tenant Operator installed and reconciling</li><li>DNS provider account (AWS Route53, Cloudflare, etc.)</li><li>DNS zone created in your provider</li></ul></div><h2 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to &quot;Installation&quot;">​</a></h2><h3 id="_1-install-externaldns" tabindex="-1">1. Install ExternalDNS <a class="header-anchor" href="#_1-install-externaldns" aria-label="Permalink to &quot;1. Install ExternalDNS&quot;">​</a></h3><h4 id="aws-route53" tabindex="-1">AWS Route53 <a class="header-anchor" href="#aws-route53" aria-label="Permalink to &quot;AWS Route53&quot;">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Create IAM policy for ExternalDNS</span></span>
<span class="line"><span style="color:#B392F0;">cat</span><span style="color:#F97583;"> &lt;&lt;</span><span style="color:#9ECBFF;">EOF</span><span style="color:#F97583;"> &gt;</span><span style="color:#9ECBFF;"> external-dns-policy.json</span></span>
<span class="line"><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;Version&quot;: &quot;2012-10-17&quot;,</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;Statement&quot;: [</span></span>
<span class="line"><span style="color:#9ECBFF;">    {</span></span>
<span class="line"><span style="color:#9ECBFF;">      &quot;Effect&quot;: &quot;Allow&quot;,</span></span>
<span class="line"><span style="color:#9ECBFF;">      &quot;Action&quot;: [</span></span>
<span class="line"><span style="color:#9ECBFF;">        &quot;route53:ChangeResourceRecordSets&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">      ],</span></span>
<span class="line"><span style="color:#9ECBFF;">      &quot;Resource&quot;: [</span></span>
<span class="line"><span style="color:#9ECBFF;">        &quot;arn:aws:route53:::hostedzone/*&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">      ]</span></span>
<span class="line"><span style="color:#9ECBFF;">    },</span></span>
<span class="line"><span style="color:#9ECBFF;">    {</span></span>
<span class="line"><span style="color:#9ECBFF;">      &quot;Effect&quot;: &quot;Allow&quot;,</span></span>
<span class="line"><span style="color:#9ECBFF;">      &quot;Action&quot;: [</span></span>
<span class="line"><span style="color:#9ECBFF;">        &quot;route53:ListHostedZones&quot;,</span></span>
<span class="line"><span style="color:#9ECBFF;">        &quot;route53:ListResourceRecordSets&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">      ],</span></span>
<span class="line"><span style="color:#9ECBFF;">      &quot;Resource&quot;: [</span></span>
<span class="line"><span style="color:#9ECBFF;">        &quot;*&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">      ]</span></span>
<span class="line"><span style="color:#9ECBFF;">    }</span></span>
<span class="line"><span style="color:#9ECBFF;">  ]</span></span>
<span class="line"><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">aws</span><span style="color:#9ECBFF;"> iam</span><span style="color:#9ECBFF;"> create-policy</span><span style="color:#79B8FF;"> --policy-name</span><span style="color:#9ECBFF;"> ExternalDNSPolicy</span><span style="color:#79B8FF;"> --policy-document</span><span style="color:#9ECBFF;"> file://external-dns-policy.json</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Create service account with IRSA (IAM Roles for Service Accounts)</span></span>
<span class="line"><span style="color:#B392F0;">eksctl</span><span style="color:#9ECBFF;"> create</span><span style="color:#9ECBFF;"> iamserviceaccount</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --name</span><span style="color:#9ECBFF;"> external-dns</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --namespace</span><span style="color:#9ECBFF;"> kube-system</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --cluster</span><span style="color:#9ECBFF;"> my-cluster</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --attach-policy-arn</span><span style="color:#9ECBFF;"> arn:aws:iam::ACCOUNT_ID:policy/ExternalDNSPolicy</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --approve</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p><strong>Deploy ExternalDNS:</strong></p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># external-dns-route53.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ServiceAccount</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">external-dns</span></span>
<span class="line"><span style="color:#85E89D;">  namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kube-system</span></span>
<span class="line"><span style="color:#6A737D;">  # annotations:</span></span>
<span class="line"><span style="color:#6A737D;">  #   eks.amazonaws.com/role-arn: arn:aws:iam::ACCOUNT_ID:role/external-dns</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ClusterRole</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">external-dns</span></span>
<span class="line"><span style="color:#85E89D;">rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">- </span><span style="color:#85E89D;">apiGroups</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">  resources</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;services&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;endpoints&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;pods&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">  verbs</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;get&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;watch&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;list&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">- </span><span style="color:#85E89D;">apiGroups</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;extensions&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;networking.k8s.io&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">  resources</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;ingresses&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">  verbs</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;get&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;watch&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;list&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">- </span><span style="color:#85E89D;">apiGroups</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">  resources</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;nodes&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">  verbs</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;list&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ClusterRoleBinding</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">external-dns-viewer</span></span>
<span class="line"><span style="color:#85E89D;">roleRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  apiGroup</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#85E89D;">  kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ClusterRole</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">external-dns</span></span>
<span class="line"><span style="color:#85E89D;">subjects</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">- </span><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ServiceAccount</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">external-dns</span></span>
<span class="line"><span style="color:#85E89D;">  namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kube-system</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">external-dns</span></span>
<span class="line"><span style="color:#85E89D;">  namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kube-system</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  strategy</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Recreate</span></span>
<span class="line"><span style="color:#85E89D;">  selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">external-dns</span></span>
<span class="line"><span style="color:#85E89D;">  template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">external-dns</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      serviceAccountName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">external-dns</span></span>
<span class="line"><span style="color:#85E89D;">      containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">external-dns</span></span>
<span class="line"><span style="color:#85E89D;">        image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">registry.k8s.io/external-dns/external-dns:v0.14.0</span></span>
<span class="line"><span style="color:#85E89D;">        args</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--source=service</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--source=ingress</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--domain-filter=example.com</span><span style="color:#6A737D;">  # Limit to specific domain</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--provider=aws</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--policy=upsert-only</span><span style="color:#6A737D;">  # Prevent ExternalDNS from deleting existing records</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--aws-zone-type=public</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--registry=txt</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--txt-owner-id=my-cluster-id</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--log-level=info</span></span>
<span class="line"><span style="color:#85E89D;">        resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          limits</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">50Mi</span></span>
<span class="line"><span style="color:#85E89D;">          requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">50Mi</span></span>
<span class="line"><span style="color:#85E89D;">            cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">10m</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> apply</span><span style="color:#79B8FF;"> -f</span><span style="color:#9ECBFF;"> external-dns-route53.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="cloudflare" tabindex="-1">Cloudflare <a class="header-anchor" href="#cloudflare" aria-label="Permalink to &quot;Cloudflare&quot;">​</a></h4><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># external-dns-cloudflare.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Secret</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">cloudflare-api-token</span></span>
<span class="line"><span style="color:#85E89D;">  namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kube-system</span></span>
<span class="line"><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Opaque</span></span>
<span class="line"><span style="color:#85E89D;">stringData</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  apiToken</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;YOUR_CLOUDFLARE_API_TOKEN&quot;</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">external-dns</span></span>
<span class="line"><span style="color:#85E89D;">  namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kube-system</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  strategy</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Recreate</span></span>
<span class="line"><span style="color:#85E89D;">  selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">external-dns</span></span>
<span class="line"><span style="color:#85E89D;">  template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">external-dns</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      serviceAccountName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">external-dns</span></span>
<span class="line"><span style="color:#85E89D;">      containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">external-dns</span></span>
<span class="line"><span style="color:#85E89D;">        image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">registry.k8s.io/external-dns/external-dns:v0.14.0</span></span>
<span class="line"><span style="color:#85E89D;">        args</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--source=service</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--source=ingress</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--domain-filter=example.com</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--provider=cloudflare</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--cloudflare-proxied</span><span style="color:#6A737D;">  # Enable Cloudflare proxy</span></span>
<span class="line"><span style="color:#85E89D;">        env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">CF_API_TOKEN</span></span>
<span class="line"><span style="color:#85E89D;">          valueFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            secretKeyRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">              name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">cloudflare-api-token</span></span>
<span class="line"><span style="color:#85E89D;">              key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apiToken</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="_2-verify-externaldns-installation" tabindex="-1">2. Verify ExternalDNS Installation <a class="header-anchor" href="#_2-verify-externaldns-installation" aria-label="Permalink to &quot;2. Verify ExternalDNS Installation&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Check ExternalDNS pod</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> pods</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> kube-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app=external-dns</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check logs</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> kube-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app=external-dns</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="integration-with-tenant-operator" tabindex="-1">Integration with Tenant Operator <a class="header-anchor" href="#integration-with-tenant-operator" aria-label="Permalink to &quot;Integration with Tenant Operator&quot;">​</a></h2><h3 id="basic-example-ingress-with-externaldns" tabindex="-1">Basic Example: Ingress with ExternalDNS <a class="header-anchor" href="#basic-example-ingress-with-externaldns" aria-label="Permalink to &quot;Basic Example: Ingress with ExternalDNS&quot;">​</a></h3><p><strong>TenantTemplate with ExternalDNS annotations:</strong></p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.kubernetes-tenants.org/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TenantTemplate</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">web-app-with-dns</span></span>
<span class="line"><span style="color:#85E89D;">  namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  registryId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-registry</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Ingress with ExternalDNS annotation</span></span>
<span class="line"><span style="color:#85E89D;">  ingresses</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">web-ingress</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-ingress&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="color:#85E89D;">      metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#6A737D;">          # ExternalDNS will create DNS record automatically</span></span>
<span class="line"><span style="color:#85E89D;">          external-dns.alpha.kubernetes.io/hostname</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .host }}&quot;</span></span>
<span class="line"><span style="color:#6A737D;">          # Optional: Set TTL</span></span>
<span class="line"><span style="color:#85E89D;">          external-dns.alpha.kubernetes.io/ttl</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;300&quot;</span></span>
<span class="line"><span style="color:#6A737D;">          # Optional: Cloudflare proxy</span></span>
<span class="line"><span style="color:#6A737D;">          # external-dns.alpha.kubernetes.io/cloudflare-proxied: &quot;true&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        ingressClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#85E89D;">        rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .host }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          http</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            paths</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#85E89D;">              pathType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="color:#85E89D;">              backend</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-service&quot;</span></span>
<span class="line"><span style="color:#85E89D;">                  port</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                    number</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#85E89D;">        tls</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">hosts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#9ECBFF;">&quot;{{ .host }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          secretName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-tls&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Service</span></span>
<span class="line"><span style="color:#85E89D;">  services</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">web-service</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-service&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#85E89D;">          targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Deployment</span></span>
<span class="line"><span style="color:#85E89D;">  deployments</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">web-deploy</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-deploy&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    dependIds</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;web-service&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#85E89D;">        selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">              app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app</span></span>
<span class="line"><span style="color:#85E89D;">              image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx:stable</span></span>
<span class="line"><span style="color:#85E89D;">              ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"><span style="color:#85E89D;">              env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TENANT_ID</span></span>
<span class="line"><span style="color:#85E89D;">                value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">              - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TENANT_HOST</span></span>
<span class="line"><span style="color:#85E89D;">                value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .host }}&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br></div></div><h3 id="advanced-example-loadbalancer-service-with-externaldns" tabindex="-1">Advanced Example: LoadBalancer Service with ExternalDNS <a class="header-anchor" href="#advanced-example-loadbalancer-service-with-externaldns" aria-label="Permalink to &quot;Advanced Example: LoadBalancer Service with ExternalDNS&quot;">​</a></h3><p>For direct LoadBalancer services (without Ingress):</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.kubernetes-tenants.org/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TenantTemplate</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">api-service-with-dns</span></span>
<span class="line"><span style="color:#85E89D;">  namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  registryId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-registry</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">  services</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">api-service</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-api-service&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#85E89D;">      metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#6A737D;">          # ExternalDNS will use the LoadBalancer IP/hostname</span></span>
<span class="line"><span style="color:#85E89D;">          external-dns.alpha.kubernetes.io/hostname</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;api-{{ .uid }}.example.com&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          external-dns.alpha.kubernetes.io/ttl</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;60&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">LoadBalancer</span></span>
<span class="line"><span style="color:#85E89D;">        selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-api&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">443</span></span>
<span class="line"><span style="color:#85E89D;">          targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8443</span></span>
<span class="line"><span style="color:#85E89D;">          protocol</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TCP</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="multi-domain-example" tabindex="-1">Multi-Domain Example <a class="header-anchor" href="#multi-domain-example" aria-label="Permalink to &quot;Multi-Domain Example&quot;">​</a></h3><p>Different tenants on different domains:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.kubernetes-tenants.org/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TenantRegistry</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">multi-domain-registry</span></span>
<span class="line"><span style="color:#85E89D;">  namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  source</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#85E89D;">    syncInterval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#85E89D;">    mysql</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql.default.svc.cluster.local</span></span>
<span class="line"><span style="color:#85E89D;">      port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3306</span></span>
<span class="line"><span style="color:#85E89D;">      database</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tenants</span></span>
<span class="line"><span style="color:#85E89D;">      table</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tenant_configs</span></span>
<span class="line"><span style="color:#85E89D;">      usernameRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-credentials</span></span>
<span class="line"><span style="color:#85E89D;">        key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">username</span></span>
<span class="line"><span style="color:#85E89D;">      passwordRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-credentials</span></span>
<span class="line"><span style="color:#85E89D;">        key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">password</span></span>
<span class="line"><span style="color:#85E89D;">  valueMappings</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    uid</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tenant_id</span></span>
<span class="line"><span style="color:#85E89D;">    hostOrUrl</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tenant_domain</span><span style="color:#6A737D;">  # Full domain per tenant</span></span>
<span class="line"><span style="color:#85E89D;">    activate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">is_active</span></span>
<span class="line"><span style="color:#85E89D;">  extraValueMappings</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    subdomain</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tenant_subdomain</span></span>
<span class="line"><span style="color:#85E89D;">    rootDomain</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">root_domain</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.kubernetes-tenants.org/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TenantTemplate</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">multi-domain-template</span></span>
<span class="line"><span style="color:#85E89D;">  namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  registryId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">multi-domain-registry</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">  ingresses</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tenant-ingress</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-ingress&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="color:#85E89D;">      metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#6A737D;">          # Use custom domain from database</span></span>
<span class="line"><span style="color:#85E89D;">          external-dns.alpha.kubernetes.io/hostname</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .subdomain }}.{{ .rootDomain }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          cert-manager.io/cluster-issuer</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;letsencrypt-prod&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        ingressClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#85E89D;">        rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .subdomain }}.{{ .rootDomain }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          http</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            paths</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#85E89D;">              pathType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="color:#85E89D;">              backend</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-service&quot;</span></span>
<span class="line"><span style="color:#85E89D;">                  port</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                    number</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#85E89D;">        tls</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">hosts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#9ECBFF;">&quot;{{ .subdomain }}.{{ .rootDomain }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          secretName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-tls&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><p><strong>Database schema example:</strong></p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#F97583;"> TABLE</span><span style="color:#B392F0;"> tenant_configs</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">  tenant_id </span><span style="color:#F97583;">VARCHAR</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">PRIMARY KEY</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  tenant_subdomain </span><span style="color:#F97583;">VARCHAR</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">  root_domain </span><span style="color:#F97583;">VARCHAR</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">  tenant_domain </span><span style="color:#F97583;">VARCHAR</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">GENERATED</span><span style="color:#F97583;"> ALWAYS</span><span style="color:#F97583;"> AS</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">CONCAT</span><span style="color:#E1E4E8;">(tenant_subdomain, </span><span style="color:#9ECBFF;">&#39;.&#39;</span><span style="color:#E1E4E8;">, root_domain)) STORED,</span></span>
<span class="line"><span style="color:#E1E4E8;">  is_active </span><span style="color:#F97583;">VARCHAR</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">INSERT INTO</span><span style="color:#E1E4E8;"> tenant_configs (tenant_id, tenant_subdomain, root_domain, is_active) </span><span style="color:#F97583;">VALUES</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;tenant-alpha&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;alpha&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;saas.example.com&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;1&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;tenant-beta&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;beta&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;saas.example.com&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;1&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;tenant-gamma&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;gamma&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;enterprise.example.io&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;1&#39;</span><span style="color:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="how-it-works" tabindex="-1">How It Works <a class="header-anchor" href="#how-it-works" aria-label="Permalink to &quot;How It Works&quot;">​</a></h2><h3 id="workflow" tabindex="-1">Workflow <a class="header-anchor" href="#workflow" aria-label="Permalink to &quot;Workflow&quot;">​</a></h3><ol><li><strong>Tenant Created</strong>: TenantRegistry controller creates Tenant CR from database row</li><li><strong>Resources Applied</strong>: Tenant controller creates Ingress/Service with ExternalDNS annotations</li><li><strong>DNS Record Created</strong>: ExternalDNS detects new Ingress/Service and creates DNS record in provider</li><li><strong>Traffic Routed</strong>: DNS resolves to LoadBalancer/Ingress IP</li><li><strong>Tenant Deleted</strong>: When tenant is deactivated, Ingress/Service is deleted</li><li><strong>DNS Record Deleted</strong>: ExternalDNS removes DNS record automatically</li></ol><h3 id="dns-record-lifecycle" tabindex="-1">DNS Record Lifecycle <a class="header-anchor" href="#dns-record-lifecycle" aria-label="Permalink to &quot;DNS Record Lifecycle&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>Database: activate=1</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>Tenant CR Created</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>Ingress Applied (with annotation)</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>ExternalDNS detects Ingress</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>DNS Record Created (A/CNAME)</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>Traffic flows to tenant</span></span>
<span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Database: activate=0</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>Tenant CR Deleted (via finalizer)</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>Ingress Deleted</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>ExternalDNS detects deletion</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>DNS Record Removed</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="externaldns-annotations-reference" tabindex="-1">ExternalDNS Annotations Reference <a class="header-anchor" href="#externaldns-annotations-reference" aria-label="Permalink to &quot;ExternalDNS Annotations Reference&quot;">​</a></h2><h3 id="common-annotations" tabindex="-1">Common Annotations <a class="header-anchor" href="#common-annotations" aria-label="Permalink to &quot;Common Annotations&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Annotation</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td><code>external-dns.alpha.kubernetes.io/hostname</code></td><td>DNS hostname to create</td><td><code>tenant-a.example.com</code></td></tr><tr><td><code>external-dns.alpha.kubernetes.io/ttl</code></td><td>DNS record TTL</td><td><code>&quot;300&quot;</code> (seconds)</td></tr><tr><td><code>external-dns.alpha.kubernetes.io/target</code></td><td>Override target IP/hostname</td><td><code>&quot;custom-lb.example.com&quot;</code></td></tr><tr><td><code>external-dns.alpha.kubernetes.io/alias</code></td><td>AWS Route53 alias record</td><td><code>&quot;true&quot;</code></td></tr></tbody></table><h3 id="provider-specific-annotations" tabindex="-1">Provider-Specific Annotations <a class="header-anchor" href="#provider-specific-annotations" aria-label="Permalink to &quot;Provider-Specific Annotations&quot;">​</a></h3><h4 id="aws-route53-1" tabindex="-1">AWS Route53 <a class="header-anchor" href="#aws-route53-1" aria-label="Permalink to &quot;AWS Route53&quot;">​</a></h4><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    external-dns.alpha.kubernetes.io/hostname</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;tenant.example.com&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    external-dns.alpha.kubernetes.io/alias</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;true&quot;</span><span style="color:#6A737D;">  # Use Route53 Alias</span></span>
<span class="line"><span style="color:#85E89D;">    external-dns.alpha.kubernetes.io/set-identifier</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;tenant-a&quot;</span><span style="color:#6A737D;">  # For weighted routing</span></span>
<span class="line"><span style="color:#85E89D;">    external-dns.alpha.kubernetes.io/aws-weight</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;100&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="cloudflare-1" tabindex="-1">Cloudflare <a class="header-anchor" href="#cloudflare-1" aria-label="Permalink to &quot;Cloudflare&quot;">​</a></h4><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    external-dns.alpha.kubernetes.io/hostname</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;tenant.example.com&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    external-dns.alpha.kubernetes.io/cloudflare-proxied</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;true&quot;</span><span style="color:#6A737D;">  # Enable CF proxy</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="google-cloud-dns" tabindex="-1">Google Cloud DNS <a class="header-anchor" href="#google-cloud-dns" aria-label="Permalink to &quot;Google Cloud DNS&quot;">​</a></h4><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    external-dns.alpha.kubernetes.io/hostname</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;tenant.example.com&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    external-dns.alpha.kubernetes.io/ttl</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;300&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="complete-example-saas-application" tabindex="-1">Complete Example: SaaS Application <a class="header-anchor" href="#complete-example-saas-application" aria-label="Permalink to &quot;Complete Example: SaaS Application&quot;">​</a></h2><p>Full example combining Tenant Operator, ExternalDNS, cert-manager, and NGINX Ingress:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.kubernetes-tenants.org/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TenantTemplate</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">saas-platform</span></span>
<span class="line"><span style="color:#85E89D;">  namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  registryId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">saas-registry</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # ConfigMap with tenant config</span></span>
<span class="line"><span style="color:#85E89D;">  configMaps</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tenant-config</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-config&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="color:#85E89D;">      data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        tenant_id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        tenant_host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .host }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        api_endpoint</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;https://{{ .host }}/api&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Application deployment</span></span>
<span class="line"><span style="color:#85E89D;">  deployments</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app-deploy</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-app&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    dependIds</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;tenant-config&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#85E89D;">        selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">            tier</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">frontend</span></span>
<span class="line"><span style="color:#85E89D;">        template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">              app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">              tier</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">frontend</span></span>
<span class="line"><span style="color:#85E89D;">          spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app</span></span>
<span class="line"><span style="color:#85E89D;">              image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mycompany/saas-app:v1.2.3</span></span>
<span class="line"><span style="color:#85E89D;">              ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"><span style="color:#85E89D;">              env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TENANT_ID</span></span>
<span class="line"><span style="color:#85E89D;">                value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">              - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TENANT_HOST</span></span>
<span class="line"><span style="color:#85E89D;">                value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .host }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">              envFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              - </span><span style="color:#85E89D;">configMapRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-config&quot;</span></span>
<span class="line"><span style="color:#85E89D;">              livenessProbe</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                httpGet</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                  path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/healthz</span></span>
<span class="line"><span style="color:#85E89D;">                  port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"><span style="color:#85E89D;">                initialDelaySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">30</span></span>
<span class="line"><span style="color:#85E89D;">                periodSeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#85E89D;">              readinessProbe</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                httpGet</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                  path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/ready</span></span>
<span class="line"><span style="color:#85E89D;">                  port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"><span style="color:#85E89D;">                initialDelaySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">5</span></span>
<span class="line"><span style="color:#85E89D;">                periodSeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">5</span></span>
<span class="line"><span style="color:#85E89D;">              resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                  cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">100m</span></span>
<span class="line"><span style="color:#85E89D;">                  memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">128Mi</span></span>
<span class="line"><span style="color:#85E89D;">                limits</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                  cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">500m</span></span>
<span class="line"><span style="color:#85E89D;">                  memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">512Mi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Service</span></span>
<span class="line"><span style="color:#85E89D;">  services</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app-service</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-service&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ClusterIP</span></span>
<span class="line"><span style="color:#85E89D;">        selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          tier</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">frontend</span></span>
<span class="line"><span style="color:#85E89D;">        ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#85E89D;">          targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"><span style="color:#85E89D;">          protocol</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TCP</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Ingress with ExternalDNS + cert-manager</span></span>
<span class="line"><span style="color:#85E89D;">  ingresses</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app-ingress</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-ingress&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    dependIds</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;app-service&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">    waitForReady</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span><span style="color:#6A737D;">  # Don&#39;t wait for Ingress (DNS propagation takes time)</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="color:#85E89D;">      metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#6A737D;">          # NGINX Ingress</span></span>
<span class="line"><span style="color:#85E89D;">          nginx.ingress.kubernetes.io/ssl-redirect</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          nginx.ingress.kubernetes.io/force-ssl-redirect</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;true&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">          # ExternalDNS</span></span>
<span class="line"><span style="color:#85E89D;">          external-dns.alpha.kubernetes.io/hostname</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .host }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          external-dns.alpha.kubernetes.io/ttl</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;300&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">          # cert-manager for automatic TLS</span></span>
<span class="line"><span style="color:#85E89D;">          cert-manager.io/cluster-issuer</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;letsencrypt-prod&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          cert-manager.io/acme-challenge-type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;http01&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        ingressClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#85E89D;">        rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .host }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          http</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            paths</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#85E89D;">              pathType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="color:#85E89D;">              backend</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-service&quot;</span></span>
<span class="line"><span style="color:#85E89D;">                  port</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                    number</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#85E89D;">        tls</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">hosts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#9ECBFF;">&quot;{{ .host }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          secretName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-tls&quot;</span><span style="color:#6A737D;">  # cert-manager will populate this</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br></div></div><p><strong>Deploy:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Apply template</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> apply</span><span style="color:#79B8FF;"> -f</span><span style="color:#9ECBFF;"> saas-platform-template.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Wait for tenants to be created</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> default</span><span style="color:#79B8FF;"> -w</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check DNS records (example with Route53)</span></span>
<span class="line"><span style="color:#B392F0;">aws</span><span style="color:#9ECBFF;"> route53</span><span style="color:#9ECBFF;"> list-resource-record-sets</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --hosted-zone-id</span><span style="color:#9ECBFF;"> Z1234567890ABC</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --query</span><span style="color:#9ECBFF;"> &quot;ResourceRecordSets[?contains(Name, &#39;tenant&#39;)]&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Test DNS resolution</span></span>
<span class="line"><span style="color:#B392F0;">nslookup</span><span style="color:#9ECBFF;"> tenant-alpha.saas.example.com</span></span>
<span class="line"><span style="color:#B392F0;">nslookup</span><span style="color:#9ECBFF;"> tenant-beta.saas.example.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Test HTTPS</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#9ECBFF;"> https://tenant-alpha.saas.example.com</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#9ECBFF;"> https://tenant-beta.saas.example.com</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><h3 id="dns-records-not-created" tabindex="-1">DNS Records Not Created <a class="header-anchor" href="#dns-records-not-created" aria-label="Permalink to &quot;DNS Records Not Created&quot;">​</a></h3><p><strong>Problem:</strong> ExternalDNS not creating DNS records.</p><p><strong>Solution:</strong></p><ol><li><p><strong>Check ExternalDNS logs:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> kube-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app=external-dns</span><span style="color:#79B8FF;"> --tail=100</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>Verify annotation exists:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> ingress</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-alpha</span><span style="color:#9ECBFF;"> tenant-alpha-ingress</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> grep</span><span style="color:#9ECBFF;"> external-dns</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>Check ExternalDNS permissions:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># AWS: Verify IAM role</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> describe</span><span style="color:#9ECBFF;"> sa</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> kube-system</span><span style="color:#9ECBFF;"> external-dns</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check if role has Route53 permissions</span></span>
<span class="line"><span style="color:#B392F0;">aws</span><span style="color:#9ECBFF;"> iam</span><span style="color:#9ECBFF;"> get-role-policy</span><span style="color:#79B8FF;"> --role-name</span><span style="color:#9ECBFF;"> external-dns-role</span><span style="color:#79B8FF;"> --policy-name</span><span style="color:#9ECBFF;"> external-dns-policy</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p><strong>Verify domain filter:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> deployment</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> kube-system</span><span style="color:#9ECBFF;"> external-dns</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> grep</span><span style="color:#9ECBFF;"> domain-filter</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ol><h3 id="dns-records-not-deleted" tabindex="-1">DNS Records Not Deleted <a class="header-anchor" href="#dns-records-not-deleted" aria-label="Permalink to &quot;DNS Records Not Deleted&quot;">​</a></h3><p><strong>Problem:</strong> DNS records remain after tenant deletion.</p><p><strong>Solution:</strong></p><ol><li><p><strong>Check ExternalDNS policy:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> deployment</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> kube-system</span><span style="color:#9ECBFF;"> external-dns</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> grep</span><span style="color:#9ECBFF;"> policy</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Should be <code>--policy=sync</code> or <code>--policy=upsert-only</code></p></li><li><p><strong>Check TXT records:</strong> ExternalDNS uses TXT records for ownership. Verify:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">aws</span><span style="color:#9ECBFF;"> route53</span><span style="color:#9ECBFF;"> list-resource-record-sets</span><span style="color:#79B8FF;"> --hosted-zone-id</span><span style="color:#9ECBFF;"> Z123</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> grep</span><span style="color:#9ECBFF;"> TXT</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>Manually delete if needed:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">aws</span><span style="color:#9ECBFF;"> route53</span><span style="color:#9ECBFF;"> change-resource-record-sets</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --hosted-zone-id</span><span style="color:#9ECBFF;"> Z1234567890ABC</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --change-batch</span><span style="color:#9ECBFF;"> file://delete-record.json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol><h3 id="dns-propagation-delays" tabindex="-1">DNS Propagation Delays <a class="header-anchor" href="#dns-propagation-delays" aria-label="Permalink to &quot;DNS Propagation Delays&quot;">​</a></h3><p><strong>Problem:</strong> DNS records created but not resolving.</p><p><strong>Solution:</strong></p><ol><li><p><strong>Check DNS propagation:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Query authoritative nameserver directly</span></span>
<span class="line"><span style="color:#B392F0;">dig</span><span style="color:#9ECBFF;"> @ns-1234.awsdns-12.org</span><span style="color:#9ECBFF;"> tenant-alpha.example.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check from multiple locations</span></span>
<span class="line"><span style="color:#B392F0;">dig</span><span style="color:#9ECBFF;"> +trace</span><span style="color:#9ECBFF;"> tenant-alpha.example.com</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p><strong>Reduce TTL</strong> for faster updates:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  external-dns.alpha.kubernetes.io/ttl</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;60&quot;</span><span style="color:#6A737D;">  # 1 minute</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p><strong>Wait for propagation</strong> (typically 1-5 minutes for low TTL)</p></li></ol><h3 id="ingress-not-getting-ip" tabindex="-1">Ingress Not Getting IP <a class="header-anchor" href="#ingress-not-getting-ip" aria-label="Permalink to &quot;Ingress Not Getting IP&quot;">​</a></h3><p><strong>Problem:</strong> Ingress created but has no IP/hostname.</p><p><strong>Solution:</strong></p><ol><li><p><strong>Check Ingress controller:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> pods</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> ingress-nginx</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> svc</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> ingress-nginx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p><strong>Check Ingress status:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> describe</span><span style="color:#9ECBFF;"> ingress</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-alpha</span><span style="color:#9ECBFF;"> tenant-alpha-ingress</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>Verify IngressClass:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> ingressclass</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ol><h2 id="best-practices" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices" aria-label="Permalink to &quot;Best Practices&quot;">​</a></h2><h3 id="_1-use-separate-hosted-zones" tabindex="-1">1. Use Separate Hosted Zones <a class="header-anchor" href="#_1-use-separate-hosted-zones" aria-label="Permalink to &quot;1. Use Separate Hosted Zones&quot;">​</a></h3><p>For multi-tenant SaaS, create separate hosted zones per environment:</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>- production.example.com (Zone ID: Z111)</span></span>
<span class="line"><span>  - tenant-a.production.example.com</span></span>
<span class="line"><span>  - tenant-b.production.example.com</span></span>
<span class="line"><span></span></span>
<span class="line"><span>- staging.example.com (Zone ID: Z222)</span></span>
<span class="line"><span>  - tenant-a.staging.example.com</span></span>
<span class="line"><span>  - tenant-b.staging.example.com</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_2-set-appropriate-ttls" tabindex="-1">2. Set Appropriate TTLs <a class="header-anchor" href="#_2-set-appropriate-ttls" aria-label="Permalink to &quot;2. Set Appropriate TTLs&quot;">​</a></h3><ul><li><strong>Development</strong>: TTL 60s (fast iteration)</li><li><strong>Staging</strong>: TTL 300s (5 minutes)</li><li><strong>Production</strong>: TTL 3600s (1 hour)</li></ul><h3 id="_3-use-dns-policy" tabindex="-1">3. Use DNS Policy <a class="header-anchor" href="#_3-use-dns-policy" aria-label="Permalink to &quot;3. Use DNS Policy&quot;">​</a></h3><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Recommended: Sync mode for full control</span></span>
<span class="line"><span style="color:#85E89D;">args</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">- </span><span style="color:#9ECBFF;">--policy=sync</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Alternative: Upsert-only (safer, but won&#39;t delete)</span></span>
<span class="line"><span style="color:#85E89D;">args</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">- </span><span style="color:#9ECBFF;">--policy=upsert-only</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_4-monitor-dns-changes" tabindex="-1">4. Monitor DNS Changes <a class="header-anchor" href="#_4-monitor-dns-changes" aria-label="Permalink to &quot;4. Monitor DNS Changes&quot;">​</a></h3><p>Set up CloudWatch alarms or monitoring:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># AWS CloudWatch alarm for Route53 changes</span></span>
<span class="line"><span style="color:#B392F0;">aws</span><span style="color:#9ECBFF;"> cloudwatch</span><span style="color:#9ECBFF;"> put-metric-alarm</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --alarm-name</span><span style="color:#9ECBFF;"> route53-high-change-rate</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --metric-name</span><span style="color:#9ECBFF;"> ChangeCount</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --namespace</span><span style="color:#9ECBFF;"> AWS/Route53</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --statistic</span><span style="color:#9ECBFF;"> Sum</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --period</span><span style="color:#79B8FF;"> 300</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --evaluation-periods</span><span style="color:#79B8FF;"> 1</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --threshold</span><span style="color:#79B8FF;"> 100</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --comparison-operator</span><span style="color:#9ECBFF;"> GreaterThanThreshold</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_5-use-txt-record-registry" tabindex="-1">5. Use TXT Record Registry <a class="header-anchor" href="#_5-use-txt-record-registry" aria-label="Permalink to &quot;5. Use TXT Record Registry&quot;">​</a></h3><p>Always enable TXT registry for ownership tracking:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">args</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">- </span><span style="color:#9ECBFF;">--registry=txt</span></span>
<span class="line"><span style="color:#E1E4E8;">- </span><span style="color:#9ECBFF;">--txt-owner-id=my-cluster-id</span></span>
<span class="line"><span style="color:#E1E4E8;">- </span><span style="color:#9ECBFF;">--txt-prefix=external-dns-</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="see-also" tabindex="-1">See Also <a class="header-anchor" href="#see-also" aria-label="Permalink to &quot;See Also&quot;">​</a></h2><ul><li><a href="https://github.com/kubernetes-sigs/external-dns" target="_blank" rel="noreferrer">ExternalDNS Documentation</a></li><li><a href="https://cert-manager.io/docs/" target="_blank" rel="noreferrer">cert-manager Integration</a></li><li><a href="./templates.html">Tenant Operator Templates Guide</a></li><li><a href="./">Multi-Tenant Architecture</a></li></ul>`,80))])}const B=e(y,[["render",b]]);export{C as __pageData,B as default};
