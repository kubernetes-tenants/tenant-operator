import{_ as c,C as d,c as u,o as l,j as s,b as r,a3 as p,a,w as n,G as t,a9 as i}from"./chunks/framework.By6ErOX9.js";const f=JSON.parse('{"title":"Architecture","description":"","frontmatter":{},"headers":[],"relativePath":"architecture.md","filePath":"architecture.md","lastUpdated":1763101723000}'),y={name:"architecture.md"};function E(m,e,b,h,A,C){const o=d("Mermaid");return l(),u("div",null,[e[2]||(e[2]=s("h1",{id:"architecture",tabindex:"-1"},[a("Architecture "),s("a",{class:"header-anchor",href:"#architecture","aria-label":'Permalink to "Architecture"'},"​")],-1)),e[3]||(e[3]=s("p",null,"This document provides a detailed overview of the Lynq's architecture, including system components, reconciliation flow, and key design decisions.",-1)),e[4]||(e[4]=s("h2",{id:"system-overview",tabindex:"-1"},[a("System Overview "),s("a",{class:"header-anchor",href:"#system-overview","aria-label":'Permalink to "System Overview"'},"​")],-1)),(l(),r(i,null,{default:n(()=>[t(o,{id:"mermaid-9",class:"mermaid my-class",graph:"flowchart%20TB%0A%20%20%20%20subgraph%20External%5B%22External%20Data%20Source%22%5D%0A%20%20%20%20%20%20%20%20DB%5B(MySQL%20%2F%20PostgreSQL*)%5D%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20Cluster%5B%22Kubernetes%20Cluster%22%5D%0A%20%20%20%20%20%20%20%20direction%20TB%0A%0A%20%20%20%20%20%20%20%20subgraph%20Controllers%5B%22Operator%20Controllers%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20RC%5BLynqHub%20Controller%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20TC%5BLynqForm%20Controller%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20TNC%5BLynqNode%20Controller%5D%0A%20%20%20%20%20%20%20%20end%0A%0A%20%20%20%20%20%20%20%20subgraph%20CRDs%5B%22Custom%20Resources%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20TR%5BLynqHub%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20TT%5BLynqForm%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20T%5BLynqNode%20CRs%5D%0A%20%20%20%20%20%20%20%20end%0A%0A%20%20%20%20%20%20%20%20subgraph%20Engine%5B%22Apply%20Engine%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20SSA%5B%22SSA%20Apply%20Engine%3Cbr%2F%3E(fieldManager%3A%20lynq)%22%5D%0A%20%20%20%20%20%20%20%20end%0A%0A%20%20%20%20%20%20%20%20subgraph%20Resources%5B%22Kubernetes%20Resources%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20DEP%5BDeployments%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20SVC%5BServices%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20ING%5BIngresses%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20etc%5BConfigMaps%2C%20Secrets%2C%20...%5D%0A%20%20%20%20%20%20%20%20end%0A%0A%20%20%20%20%20%20%20%20API%5B(etcd%20%2F%20K8s%20API%20Server)%5D%0A%20%20%20%20end%0A%0A%20%20%20%20DB%20--%3E%7C%22syncInterval%3Cbr%2F%3E(e.g.%2C%201m)%22%7C%20RC%0A%20%20%20%20RC%20--%3E%7C%22Creates%2FUpdates%2FDeletes%3Cbr%2F%3ELynqNode%20CRs%22%7C%20API%0A%20%20%20%20API%20--%3E%7C%22Stores%22%7C%20TR%0A%20%20%20%20API%20--%3E%7C%22Stores%22%7C%20TT%0A%20%20%20%20API%20--%3E%7C%22Stores%22%7C%20T%0A%0A%20%20%20%20TC%20--%3E%7C%22Validates%3Cbr%2F%3Etemplate-registry%20linkage%22%7C%20API%0A%20%20%20%20TNC%20--%3E%7C%22Reconciles%3Cbr%2F%3Eeach%20LynqNode%22%7C%20SSA%0A%20%20%20%20SSA%20--%3E%7C%22Server-Side%20Apply%22%7C%20API%0A%0A%20%20%20%20API%20--%3E%7C%22Creates%22%7C%20DEP%0A%20%20%20%20API%20--%3E%7C%22Creates%22%7C%20SVC%0A%20%20%20%20API%20--%3E%7C%22Creates%22%7C%20ING%0A%20%20%20%20API%20--%3E%7C%22Creates%22%7C%20etc%0A%0A%20%20%20%20style%20RC%20fill%3A%23e3f2fd%2Cstroke%3A%2364b5f6%2Cstroke-width%3A2px%0A%20%20%20%20style%20TC%20fill%3A%23e8f5e9%2Cstroke%3A%2381c784%2Cstroke-width%3A2px%0A%20%20%20%20style%20TNC%20fill%3A%23fff3e0%2Cstroke%3A%23ffb74d%2Cstroke-width%3A2px%0A%20%20%20%20style%20SSA%20fill%3A%23fce4ec%2Cstroke%3A%23f06292%2Cstroke-width%3A2px%0A%20%20%20%20style%20DB%20fill%3A%23f3e5f5%2Cstroke%3A%23ba68c8%2Cstroke-width%3A2px%0A"})]),fallback:n(()=>[...e[0]||(e[0]=[a(" Loading... ",-1)])]),_:1})),e[5]||(e[5]=p('<div class="info custom-block"><p class="custom-block-title">Database Support</p><ul><li><strong>MySQL</strong>: Fully supported (v1.0+)</li><li><strong>PostgreSQL</strong>: Planned for v1.2</li></ul></div><h2 id="architecture-at-a-glance" tabindex="-1">Architecture at a Glance <a class="header-anchor" href="#architecture-at-a-glance" aria-label="Permalink to &quot;Architecture at a Glance&quot;">​</a></h2><p>Quick reference for the three main components:</p><table tabindex="0"><thead><tr><th>Component</th><th>Purpose</th><th>Example</th></tr></thead><tbody><tr><td><strong>LynqHub</strong></td><td>Connects to database, syncs node rows</td><td>MySQL every 30s → Creates LynqNode CRs</td></tr><tr><td><strong>LynqForm</strong></td><td>Defines resource blueprint</td><td>Deployment + Service per node</td></tr><tr><td><strong>LynqNode</strong></td><td>Instance of a single node</td><td><code>acme-corp-web-app</code> → 5 K8s resources</td></tr></tbody></table><p><strong>Workflow</strong>: Database row becomes active → LynqHub controller syncs and multiplies rows by all referencing LynqForms → A LynqNode CR is created per <code>{row × template}</code> combination → LynqNode controller renders the LynqForm snapshot for that node and applies it via the SSA engine → Kubernetes resources are created/updated and kept in sync.</p><hr><h2 id="reconciliation-flow" tabindex="-1">Reconciliation Flow <a class="header-anchor" href="#reconciliation-flow" aria-label="Permalink to &quot;Reconciliation Flow&quot;">​</a></h2>',7)),(l(),r(i,null,{default:n(()=>[t(o,{id:"mermaid-87",class:"mermaid my-class",graph:"sequenceDiagram%0A%20%20%20%20participant%20DB%20as%20MySQL%20Database%0A%20%20%20%20participant%20RC%20as%20LynqHub%20Controller%0A%20%20%20%20participant%20API%20as%20K8s%20API%20Server%0A%20%20%20%20participant%20TC%20as%20LynqForm%20Controller%0A%20%20%20%20participant%20TNC%20as%20LynqNode%20Controller%0A%20%20%20%20participant%20SSA%20as%20SSA%20Engine%0A%0A%20%20%20%20Note%20over%20DB%2CSSA%3A%20Hub%20Sync%20Cycle%20(e.g.%2C%20every%201%20minute)%0A%0A%20%20%20%20RC-%3E%3EDB%3A%20SELECT%20*%20FROM%20nodes%20WHERE%20activate%3DTRUE%0A%20%20%20%20DB--%3E%3ERC%3A%20Active%20node%20rows%0A%0A%20%20%20%20RC-%3E%3EAPI%3A%20Create%2FUpdate%20LynqNode%20CRs%20(desired%20set)%0A%20%20%20%20RC-%3E%3EAPI%3A%20Delete%20LynqNodes%20not%20in%20desired%20set%0A%0A%20%20%20%20TC-%3E%3EAPI%3A%20Validate%20Template-Registry%20linkage%0A%20%20%20%20TC-%3E%3EAPI%3A%20Ensure%20consistency%0A%0A%20%20%20%20loop%20For%20Each%20LynqNode%0A%20%20%20%20%20%20%20%20TNC-%3E%3EAPI%3A%20Get%20LynqNode%20spec%0A%20%20%20%20%20%20%20%20TNC-%3E%3ETNC%3A%20Build%20dependency%20graph%20(dependIds)%0A%20%20%20%20%20%20%20%20TNC-%3E%3ETNC%3A%20Topological%20sort%20resources%0A%0A%20%20%20%20%20%20%20%20loop%20For%20Each%20Resource%20(in%20order)%0A%20%20%20%20%20%20%20%20%20%20%20%20TNC-%3E%3ETNC%3A%20Render%20templates%20(name%2C%20namespace%2C%20spec)%0A%20%20%20%20%20%20%20%20%20%20%20%20TNC-%3E%3ESSA%3A%20Apply%20resource%20with%20conflict%20policy%0A%20%20%20%20%20%20%20%20%20%20%20%20SSA-%3E%3EAPI%3A%20Server-Side%20Apply%20(force%20or%20not)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20alt%20waitForReady%20%3D%20true%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20TNC-%3E%3EAPI%3A%20Wait%20for%20resource%20Ready%20condition%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20API--%3E%3ETNC%3A%20Ready%20(or%20timeout)%0A%20%20%20%20%20%20%20%20%20%20%20%20end%0A%20%20%20%20%20%20%20%20end%0A%0A%20%20%20%20%20%20%20%20TNC-%3E%3EAPI%3A%20Update%20LynqNode%20status%20(ready%2Ffailed%20counts)%0A%20%20%20%20end%0A%0A%20%20%20%20RC-%3E%3EAPI%3A%20Update%20Hub%20status%20(desired%2Fready%2Ffailed)%0A"})]),fallback:n(()=>[...e[1]||(e[1]=[a(" Loading... ",-1)])]),_:1})),e[6]||(e[6]=p(`<h2 id="three-controller-design" tabindex="-1">Three-Controller Design <a class="header-anchor" href="#three-controller-design" aria-label="Permalink to &quot;Three-Controller Design&quot;">​</a></h2><p>The operator uses a three-controller architecture to separate concerns and optimize reconciliation:</p><h3 id="_1-lynqhub-controller" tabindex="-1">1. LynqHub Controller <a class="header-anchor" href="#_1-lynqhub-controller" aria-label="Permalink to &quot;1. LynqHub Controller&quot;">​</a></h3><p><strong>Purpose</strong>: Syncs database (e.g., 1m interval) → Creates/Updates/Deletes LynqNode CRs</p><p><strong>Responsibilities</strong>:</p><ul><li>Periodically queries external datasource at <code>spec.source.syncInterval</code></li><li>Filters active rows where <code>activate</code> field is truthy</li><li>Calculates desired LynqNode set: <code>referencingTemplates × activeRows</code></li><li>Creates missing LynqNode CRs (naming: <code>{uid}-{template-name}</code>)</li><li>Updates existing LynqNode CRs with fresh data</li><li>Deletes LynqNode CRs for inactive/removed rows (garbage collection)</li><li>Updates Hub status with counts</li></ul><p><strong>Key Status Fields</strong>:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">status</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  referencingTemplates</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span><span style="color:#6A737D;"> # Number of templates using this hub</span></span>
<span class="line"><span style="color:#85E89D;">  desired</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">6</span><span style="color:#6A737D;"> # referencingTemplates × activeRows</span></span>
<span class="line"><span style="color:#85E89D;">  ready</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">5</span><span style="color:#6A737D;"> # Ready LynqNodes across all templates</span></span>
<span class="line"><span style="color:#85E89D;">  failed</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#6A737D;"> # Failed LynqNodes across all templates</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-lynqform-controller" tabindex="-1">2. LynqForm Controller <a class="header-anchor" href="#_2-lynqform-controller" aria-label="Permalink to &quot;2. LynqForm Controller&quot;">​</a></h3><p><strong>Purpose</strong>: Validates template-registry linkage and invariants</p><p><strong>Responsibilities</strong>:</p><ul><li>Validates that <code>spec.hubId</code> references an existing LynqHub</li><li>Ensures template syntax is valid (Go text/template)</li><li>Validates resource IDs are unique within template</li><li>Detects dependency cycles in <code>dependIds</code></li><li>Updates template status</li></ul><h3 id="_3-lynqnode-controller" tabindex="-1">3. LynqNode Controller <a class="header-anchor" href="#_3-lynqnode-controller" aria-label="Permalink to &quot;3. LynqNode Controller&quot;">​</a></h3><p><strong>Purpose</strong>: Renders templates → Resolves dependencies → Applies resources via SSA</p><p><strong>Responsibilities</strong>:</p><ul><li>Builds template variables from LynqNode spec</li><li>Resolves resource dependencies (DAG + topological sort)</li><li>Renders all templates (names, namespaces, specs)</li><li>Applies resources using Server-Side Apply</li><li>Waits for resource readiness (if <code>waitForReady=true</code>)</li><li>Updates LynqNode status with resource counts and conditions</li><li>Handles conflicts according to ConflictPolicy</li><li>Manages finalizers for proper cleanup</li></ul><h2 id="crd-architecture" tabindex="-1">CRD Architecture <a class="header-anchor" href="#crd-architecture" aria-label="Permalink to &quot;CRD Architecture&quot;">​</a></h2><h3 id="lynqhub" tabindex="-1">LynqHub <a class="header-anchor" href="#lynqhub" aria-label="Permalink to &quot;LynqHub&quot;">​</a></h3><p>Defines external datasource configuration and sync behavior:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.lynq.sh/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">LynqHub</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-saas-hub</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  source</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#85E89D;">    mysql</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql.default.svc.cluster.local</span></span>
<span class="line"><span style="color:#85E89D;">      port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3306</span></span>
<span class="line"><span style="color:#85E89D;">      database</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nodes</span></span>
<span class="line"><span style="color:#85E89D;">      table</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node_data</span></span>
<span class="line"><span style="color:#85E89D;">      username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node_reader</span></span>
<span class="line"><span style="color:#85E89D;">      passwordRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-secret</span></span>
<span class="line"><span style="color:#85E89D;">        key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">password</span></span>
<span class="line"><span style="color:#85E89D;">    syncInterval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">30s</span></span>
<span class="line"><span style="color:#85E89D;">  valueMappings</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    uid</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node_id</span><span style="color:#6A737D;"> # Required</span></span>
<span class="line"><span style="color:#85E89D;">    hostOrUrl</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">domain</span><span style="color:#6A737D;"> # Required</span></span>
<span class="line"><span style="color:#85E89D;">    activate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">is_active</span><span style="color:#6A737D;"> # Required</span></span>
<span class="line"><span style="color:#85E89D;">  extraValueMappings</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    planId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">subscription_plan</span></span>
<span class="line"><span style="color:#85E89D;">    deployImage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">container_image</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><strong>Multi-Form Support</strong>: One hub can be referenced by multiple LynqForms, creating separate LynqNode CRs for each form-row combination.</p><h3 id="lynqform" tabindex="-1">LynqForm <a class="header-anchor" href="#lynqform" aria-label="Permalink to &quot;LynqForm&quot;">​</a></h3><p>Blueprint for resources to create per node:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.lynq.sh/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">LynqForm</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">web-app</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  hubId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-saas-hub</span></span>
<span class="line"><span style="color:#85E89D;">  deployments</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app-deployment</span></span>
<span class="line"><span style="color:#85E89D;">      nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-app&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">        kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">        spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#6A737D;">          # ... deployment spec</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>Supported Resource Types</strong>:</p><ul><li><code>serviceAccounts</code></li><li><code>deployments</code>, <code>statefulSets</code>, <code>daemonSets</code></li><li><code>services</code></li><li><code>configMaps</code>, <code>secrets</code></li><li><code>persistentVolumeClaims</code></li><li><code>jobs</code>, <code>cronJobs</code></li><li><code>ingresses</code></li><li><code>namespaces</code></li><li><code>manifests</code> (raw resources)</li></ul><h3 id="lynqnode" tabindex="-1">LynqNode <a class="header-anchor" href="#lynqnode" aria-label="Permalink to &quot;LynqNode&quot;">​</a></h3><p>Instance representing a single node:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.lynq.sh/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">LynqNode</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">acme-web-app</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  uid</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">acme</span></span>
<span class="line"><span style="color:#85E89D;">  templateRef</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">web-app</span></span>
<span class="line"><span style="color:#85E89D;">  hubId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-saas-hub</span></span>
<span class="line"><span style="color:#6A737D;">  # ... resolved resource arrays</span></span>
<span class="line"><span style="color:#85E89D;">status</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  desiredResources</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#85E89D;">  readyResources</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#85E89D;">  failedResources</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#85E89D;">  appliedResources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">&quot;Deployment/default/acme-app@app-deployment&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">&quot;Service/default/acme-svc@app-service&quot;</span></span>
<span class="line"><span style="color:#85E89D;">  conditions</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Ready</span></span>
<span class="line"><span style="color:#85E89D;">      status</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;True&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      lastTransitionTime</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;2024-01-15T10:30:00Z&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="key-design-patterns" tabindex="-1">Key Design Patterns <a class="header-anchor" href="#key-design-patterns" aria-label="Permalink to &quot;Key Design Patterns&quot;">​</a></h2><h3 id="server-side-apply-ssa" tabindex="-1">Server-Side Apply (SSA) <a class="header-anchor" href="#server-side-apply-ssa" aria-label="Permalink to &quot;Server-Side Apply (SSA)&quot;">​</a></h3><p>All resources are applied using Kubernetes Server-Side Apply with <code>fieldManager: lynq</code>. This provides:</p><ul><li><strong>Conflict-free updates</strong>: Multiple controllers can manage different fields</li><li><strong>Declarative management</strong>: Operator owns only fields it sets</li><li><strong>Drift detection</strong>: Automatic detection of manual changes</li><li><strong>Force mode</strong>: Optional force ownership with <code>ConflictPolicy: Force</code></li></ul><h3 id="resource-tracking" tabindex="-1">Resource Tracking <a class="header-anchor" href="#resource-tracking" aria-label="Permalink to &quot;Resource Tracking&quot;">​</a></h3><p>Two mechanisms based on namespace and deletion policy:</p><ol><li><p><strong>OwnerReference-based</strong> (automatic GC):</p><ul><li>Same-namespace resources with <code>DeletionPolicy=Delete</code></li><li>Kubernetes garbage collector handles cleanup</li></ul></li><li><p><strong>Label-based</strong> (manual lifecycle):</p><ul><li>Cross-namespace resources</li><li>Namespace resources</li><li>Resources with <code>DeletionPolicy=Retain</code></li><li>Labels: <code>lynq.sh/node</code>, <code>lynq.sh/node-namespace</code></li></ul></li></ol><h3 id="dependency-management" tabindex="-1">Dependency Management <a class="header-anchor" href="#dependency-management" aria-label="Permalink to &quot;Dependency Management&quot;">​</a></h3><p>Resources are applied in order based on <code>dependIds</code>:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">deployments</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app-deployment</span></span>
<span class="line"><span style="color:#6A737D;">    # ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">services</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app-service</span></span>
<span class="line"><span style="color:#85E89D;">    dependIds</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;app-deployment&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">    waitForReady</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#6A737D;">    # ...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>The operator:</p><ol><li>Builds a Directed Acyclic Graph (DAG)</li><li>Detects cycles (fails fast if found)</li><li>Performs topological sort</li><li>Applies resources in dependency order</li></ol><h3 id="drift-detection-auto-correction" tabindex="-1">Drift Detection &amp; Auto-Correction <a class="header-anchor" href="#drift-detection-auto-correction" aria-label="Permalink to &quot;Drift Detection &amp; Auto-Correction&quot;">​</a></h3><p>The operator continuously monitors managed resources through:</p><ul><li><strong>Event-driven watches</strong>: Immediate reconciliation on resource changes</li><li><strong>Watch predicates</strong>: Only trigger on meaningful changes (Generation/Annotation)</li><li><strong>Fast requeue</strong>: 30-second periodic requeue for status reflection</li><li><strong>Auto-correction</strong>: Reverts manual changes to maintain desired state</li></ul><h3 id="garbage-collection" tabindex="-1">Garbage Collection <a class="header-anchor" href="#garbage-collection" aria-label="Permalink to &quot;Garbage Collection&quot;">​</a></h3><p>Automatic cleanup when:</p><ul><li>Database row is deleted</li><li>Row&#39;s <code>activate</code> field becomes false</li><li>Template no longer references the hub</li><li>LynqNode CR is deleted (with finalizer-based cleanup)</li></ul><p>Resources respect <code>DeletionPolicy</code>:</p><ul><li><code>Delete</code>: Removed from cluster</li><li><code>Retain</code>: Orphaned with labels for manual cleanup</li></ul><h3 id="orphan-resource-management" tabindex="-1">Orphan Resource Management <a class="header-anchor" href="#orphan-resource-management" aria-label="Permalink to &quot;Orphan Resource Management&quot;">​</a></h3><p>When resources are removed from templates:</p><ul><li>Detected via comparison of <code>status.appliedResources</code></li><li>Resource key format: <code>kind/namespace/name@id</code></li><li>DeletionPolicy preserved in annotation: <code>lynq.sh/deletion-policy</code></li><li>Orphaned resources marked with: <ul><li>Label: <code>lynq.sh/orphaned: &quot;true&quot;</code></li><li>Annotations: <code>orphaned-at</code>, <code>orphaned-reason</code></li></ul></li><li>Re-adoption: Orphan markers removed when resource re-added to template</li></ul><h2 id="performance-considerations" tabindex="-1">Performance Considerations <a class="header-anchor" href="#performance-considerations" aria-label="Permalink to &quot;Performance Considerations&quot;">​</a></h2><h3 id="controller-concurrency" tabindex="-1">Controller Concurrency <a class="header-anchor" href="#controller-concurrency" aria-label="Permalink to &quot;Controller Concurrency&quot;">​</a></h3><p>Configurable worker pools for each controller:</p><ul><li><code>--hub-concurrency=N</code> (default: 3)</li><li><code>--form-concurrency=N</code> (default: 5)</li><li><code>--node-concurrency=N</code> (default: 10)</li></ul><h3 id="reconciliation-optimization" tabindex="-1">Reconciliation Optimization <a class="header-anchor" href="#reconciliation-optimization" aria-label="Permalink to &quot;Reconciliation Optimization&quot;">​</a></h3><ul><li><strong>Fast status reflection</strong>: 30-second requeue interval</li><li><strong>Smart watch predicates</strong>: Filter status-only updates</li><li><strong>Event-driven architecture</strong>: Immediate reaction to changes</li><li><strong>Resource caching</strong>: Frequently accessed resources cached</li></ul><h3 id="scalability" tabindex="-1">Scalability <a class="header-anchor" href="#scalability" aria-label="Permalink to &quot;Scalability&quot;">​</a></h3><p>The operator is designed to scale horizontally:</p><ul><li>Leader election for single-writer pattern</li><li>Optional sharding by namespace or node ID</li><li>Resource-type worker pools for parallel processing</li><li>SSA batching for bulk applies</li></ul><h2 id="see-also" tabindex="-1">See Also <a class="header-anchor" href="#see-also" aria-label="Permalink to &quot;See Also&quot;">​</a></h2><ul><li><a href="/api.html">API Reference</a> - Complete CRD specification</li><li><a href="/policies.html">Policies</a> - Lifecycle management policies</li><li><a href="/dependencies.html">Dependencies</a> - Dependency graph system</li><li><a href="/monitoring.html">Monitoring</a> - Observability and metrics</li></ul>`,63))])}const D=c(y,[["render",E]]);export{f as __pageData,D as default};
