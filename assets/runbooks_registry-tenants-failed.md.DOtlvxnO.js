import{_ as a,c as n,o as l,a2 as e}from"./chunks/framework.9Uv4PgnO.js";const u=JSON.parse('{"title":"Runbook: Registry Tenants Failed","description":"","frontmatter":{},"headers":[],"relativePath":"runbooks/registry-tenants-failed.md","filePath":"runbooks/registry-tenants-failed.md","lastUpdated":1762417427000}'),p={name:"runbooks/registry-tenants-failed.md"};function o(t,s,r,c,i,F){return l(),n("div",null,[...s[0]||(s[0]=[e(`<h1 id="runbook-registry-tenants-failed" tabindex="-1">Runbook: Registry Tenants Failed <a class="header-anchor" href="#runbook-registry-tenants-failed" aria-label="Permalink to &quot;Runbook: Registry Tenants Failed&quot;">​</a></h1><h2 id="alert-details" tabindex="-1">Alert Details <a class="header-anchor" href="#alert-details" aria-label="Permalink to &quot;Alert Details&quot;">​</a></h2><p><strong>Alert Name:</strong> <code>RegistryTenantsFailure</code><strong>Severity:</strong> Warning <strong>Threshold:</strong> registry_failed &gt; 0 AND registry_failed &lt;= 5 for 10+ minutes</p><h2 id="description" tabindex="-1">Description <a class="header-anchor" href="#description" aria-label="Permalink to &quot;Description&quot;">​</a></h2><p>This alert fires when a TenantRegistry has a small number of failed tenants (1-5). This indicates isolated tenant failures rather than a systemic issue, typically caused by tenant-specific configuration problems or resource issues.</p><h2 id="symptoms" tabindex="-1">Symptoms <a class="header-anchor" href="#symptoms" aria-label="Permalink to &quot;Symptoms&quot;">​</a></h2><ul><li>Registry status shows some failed tenants</li><li>Most tenants are healthy, but 1-5 are failing</li><li>Failed tenants may have unique characteristics</li><li>Registry overall is functional</li></ul><h2 id="possible-causes" tabindex="-1">Possible Causes <a class="header-anchor" href="#possible-causes" aria-label="Permalink to &quot;Possible Causes&quot;">​</a></h2><ol><li><p><strong>Tenant-Specific Data Issues</strong></p><ul><li>Invalid data in specific tenant rows</li><li>Missing required fields for certain tenants</li><li>Malformed URLs or identifiers</li><li>NULL or empty required values</li></ul></li><li><p><strong>Template Variable Issues</strong></p><ul><li>Specific tenant data doesn&#39;t match template expectations</li><li>Optional variables missing for some tenants</li><li>Type mismatches in tenant data</li></ul></li><li><p><strong>Resource Conflicts</strong></p><ul><li>Specific tenant names conflict with existing resources</li><li>Isolated naming collisions</li><li>Pre-existing resources blocking creation</li></ul></li><li><p><strong>Resource Quota Issues</strong></p><ul><li>Namespace quota reached affecting new tenants</li><li>Specific tenant resource requests exceed limits</li><li>Storage quota exhausted</li></ul></li><li><p><strong>Tenant-Specific Configuration</strong></p><ul><li>Invalid configurations in extraValueMappings</li><li>Incorrect domain names or URLs</li><li>Certificate or secret reference issues</li></ul></li></ol><h2 id="diagnosis" tabindex="-1">Diagnosis <a class="header-anchor" href="#diagnosis" aria-label="Permalink to &quot;Diagnosis&quot;">​</a></h2><h3 id="_1-identify-failed-tenants" tabindex="-1">1. Identify Failed Tenants <a class="header-anchor" href="#_1-identify-failed-tenants" aria-label="Permalink to &quot;1. Identify Failed Tenants&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Get registry status</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenantregistry</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">registry-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -o</span><span style="color:#9ECBFF;"> jsonpath=&#39;Failed: {.status.failed}/{.status.desired}{&quot;\\n&quot;}&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># List all tenants from registry</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenants</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> kubernetes-tenants.org/registry=</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">registry-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Filter failed tenants</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenants</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -l</span><span style="color:#9ECBFF;"> kubernetes-tenants.org/registry=</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">registry-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -o</span><span style="color:#9ECBFF;"> json</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> jq</span><span style="color:#79B8FF;"> -r</span><span style="color:#9ECBFF;"> &#39;.items[] | select(.status.conditions[]? | select(.type==&quot;Ready&quot; and .status==&quot;False&quot;)) | .metadata.name&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_2-analyze-failed-tenant-pattern" tabindex="-1">2. Analyze Failed Tenant Pattern <a class="header-anchor" href="#_2-analyze-failed-tenant-pattern" aria-label="Permalink to &quot;2. Analyze Failed Tenant Pattern&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Get failure reasons</span></span>
<span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> tenant </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> $(</span><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenants</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -l</span><span style="color:#9ECBFF;"> kubernetes-tenants.org/registry=</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">registry-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -o</span><span style="color:#9ECBFF;"> json</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> jq</span><span style="color:#79B8FF;"> -r</span><span style="color:#9ECBFF;"> &#39;.items[] | select(.status.conditions[]? | select(.type==&quot;Ready&quot; and .status==&quot;False&quot;)) | .metadata.name&#39;</span><span style="color:#E1E4E8;">); </span><span style="color:#F97583;">do</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">  echo</span><span style="color:#9ECBFF;"> &quot;=== </span><span style="color:#E1E4E8;">$tenant</span><span style="color:#9ECBFF;"> ===&quot;</span></span>
<span class="line"><span style="color:#B392F0;">  kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#E1E4E8;"> $tenant </span><span style="color:#79B8FF;">-n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">    -o</span><span style="color:#9ECBFF;"> jsonpath=&#39;{.status.conditions[?(@.type==&quot;Degraded&quot;)].reason}{&quot;: &quot;}{.status.conditions[?(@.type==&quot;Degraded&quot;)].message}{&quot;\\n&quot;}&#39;</span></span>
<span class="line"><span style="color:#F97583;">done</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-compare-failed-vs-successful-tenants" tabindex="-1">3. Compare Failed vs Successful Tenants <a class="header-anchor" href="#_3-compare-failed-vs-successful-tenants" aria-label="Permalink to &quot;3. Compare Failed vs Successful Tenants&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Get a successful tenant for comparison</span></span>
<span class="line"><span style="color:#E1E4E8;">SUCCESS_TENANT</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">$(</span><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenants</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -l</span><span style="color:#9ECBFF;"> kubernetes-tenants.org/registry=</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">registry-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -o</span><span style="color:#9ECBFF;"> json</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> jq</span><span style="color:#79B8FF;"> -r</span><span style="color:#9ECBFF;"> &#39;.items[] | select(.status.conditions[]? | select(.type==&quot;Ready&quot; and .status==&quot;True&quot;)) | .metadata.name&#39;</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> head</span><span style="color:#79B8FF;"> -1</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">FAILED_TENANT</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">$(</span><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenants</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -l</span><span style="color:#9ECBFF;"> kubernetes-tenants.org/registry=</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">registry-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -o</span><span style="color:#9ECBFF;"> json</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> jq</span><span style="color:#79B8FF;"> -r</span><span style="color:#9ECBFF;"> &#39;.items[] | select(.status.conditions[]? | select(.type==&quot;Ready&quot; and .status==&quot;False&quot;)) | .metadata.name&#39;</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> head</span><span style="color:#79B8FF;"> -1</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Compare annotations (data from datasource)</span></span>
<span class="line"><span style="color:#79B8FF;">echo</span><span style="color:#9ECBFF;"> &quot;=== Successful Tenant Data ===&quot;</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#E1E4E8;"> $SUCCESS_TENANT </span><span style="color:#79B8FF;">-n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> jsonpath=&#39;{.metadata.annotations}&#39;</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> jq</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">echo</span><span style="color:#79B8FF;"> -e</span><span style="color:#9ECBFF;"> &quot;\\n=== Failed Tenant Data ===&quot;</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#E1E4E8;"> $FAILED_TENANT </span><span style="color:#79B8FF;">-n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> jsonpath=&#39;{.metadata.annotations}&#39;</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> jq</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_4-check-failed-tenant-events" tabindex="-1">4. Check Failed Tenant Events <a class="header-anchor" href="#_4-check-failed-tenant-events" aria-label="Permalink to &quot;4. Check Failed Tenant Events&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> tenant </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> $(</span><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenants</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -l</span><span style="color:#9ECBFF;"> kubernetes-tenants.org/registry=</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">registry-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -o</span><span style="color:#9ECBFF;"> json</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> jq</span><span style="color:#79B8FF;"> -r</span><span style="color:#9ECBFF;"> &#39;.items[] | select(.status.conditions[]? | select(.type==&quot;Ready&quot; and .status==&quot;False&quot;)) | .metadata.name&#39;</span><span style="color:#E1E4E8;">); </span><span style="color:#F97583;">do</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">  echo</span><span style="color:#9ECBFF;"> &quot;=== Events for </span><span style="color:#E1E4E8;">$tenant</span><span style="color:#9ECBFF;"> ===&quot;</span></span>
<span class="line"><span style="color:#B392F0;">  kubectl</span><span style="color:#9ECBFF;"> describe</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#E1E4E8;"> $tenant </span><span style="color:#79B8FF;">-n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> grep</span><span style="color:#79B8FF;"> -A</span><span style="color:#79B8FF;"> 20</span><span style="color:#9ECBFF;"> &quot;Events:&quot;</span></span>
<span class="line"><span style="color:#F97583;">done</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_5-check-datasource-for-failed-tenants" tabindex="-1">5. Check Datasource for Failed Tenants <a class="header-anchor" href="#_5-check-datasource-for-failed-tenants" aria-label="Permalink to &quot;5. Check Datasource for Failed Tenants&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Get tenant UIDs from failed tenants</span></span>
<span class="line"><span style="color:#E1E4E8;">FAILED_UIDS</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">$(</span><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenants</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -l</span><span style="color:#9ECBFF;"> kubernetes-tenants.org/registry=</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">registry-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -o</span><span style="color:#9ECBFF;"> json</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> jq</span><span style="color:#79B8FF;"> -r</span><span style="color:#9ECBFF;"> &#39;.items[] | select(.status.conditions[]? | select(.type==&quot;Ready&quot; and .status==&quot;False&quot;)) | .metadata.annotations.&quot;tenant.operator.kubernetes-tenants.org/uid&quot;&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">echo</span><span style="color:#9ECBFF;"> &quot;Failed tenant UIDs: </span><span style="color:#E1E4E8;">$FAILED_UIDS</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Query datasource directly to check data</span></span>
<span class="line"><span style="color:#6A737D;"># For MySQL:</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> run</span><span style="color:#9ECBFF;"> mysql-client</span><span style="color:#79B8FF;"> --rm</span><span style="color:#79B8FF;"> -it</span><span style="color:#79B8FF;"> --restart=Never</span><span style="color:#79B8FF;"> --image=mysql:8</span><span style="color:#79B8FF;"> --</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#9ECBFF;">  mysql</span><span style="color:#79B8FF;"> -h</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">hos</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -u</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">use</span><span style="color:#E1E4E8;">r</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -p</span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">password</span><span style="color:#F97583;">&gt;</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">databas</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -e</span><span style="color:#9ECBFF;"> &quot;SELECT * FROM &lt;table&gt; WHERE uid IN (</span><span style="color:#E1E4E8;">$FAILED_UIDS</span><span style="color:#9ECBFF;">)&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_6-check-operator-logs" tabindex="-1">6. Check Operator Logs <a class="header-anchor" href="#_6-check-operator-logs" aria-label="Permalink to &quot;6. Check Operator Logs&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Get logs for failed tenant reconciliation</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app=tenant-operator</span><span style="color:#79B8FF;"> --tail=500</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#F97583;">  |</span><span style="color:#B392F0;"> grep</span><span style="color:#79B8FF;"> -E</span><span style="color:#9ECBFF;"> &quot;$(</span><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get tenants </span><span style="color:#79B8FF;">-n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespace</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">      -l</span><span style="color:#9ECBFF;"> kubernetes-tenants.org/registry=</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">registry-name</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">      -o</span><span style="color:#9ECBFF;"> json </span><span style="color:#F97583;">|</span><span style="color:#B392F0;"> jq</span><span style="color:#79B8FF;"> -r</span><span style="color:#9ECBFF;"> &#39;.items[] | select(.status.conditions[]? | select(.type==&quot;Ready&quot; and .status==&quot;False&quot;)) | .metadata.name&#39; </span><span style="color:#F97583;">|</span><span style="color:#B392F0;"> tr</span><span style="color:#9ECBFF;"> &#39;\\n&#39; &#39;|&#39; </span><span style="color:#F97583;">|</span><span style="color:#B392F0;"> sed</span><span style="color:#9ECBFF;"> &#39;s/|$//&#39;)&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="resolution" tabindex="-1">Resolution <a class="header-anchor" href="#resolution" aria-label="Permalink to &quot;Resolution&quot;">​</a></h2><h3 id="for-data-quality-issues" tabindex="-1">For Data Quality Issues <a class="header-anchor" href="#for-data-quality-issues" aria-label="Permalink to &quot;For Data Quality Issues&quot;">​</a></h3><ol><li><p><strong>Validate tenant data:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Check for NULL or empty required fields</span></span>
<span class="line"><span style="color:#6A737D;"># Query datasource directly</span></span>
<span class="line"><span style="color:#B392F0;">mysql</span><span style="color:#79B8FF;"> -h</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">hos</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -u</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">use</span><span style="color:#E1E4E8;">r</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -p</span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">password</span><span style="color:#F97583;">&gt;</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">databas</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -e</span><span style="color:#9ECBFF;"> &quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">SELECT uid, hostOrUrl, activate</span></span>
<span class="line"><span style="color:#9ECBFF;">FROM &lt;table&gt;</span></span>
<span class="line"><span style="color:#9ECBFF;">WHERE uid IS NULL</span></span>
<span class="line"><span style="color:#9ECBFF;">   OR hostOrUrl IS NULL</span></span>
<span class="line"><span style="color:#9ECBFF;">   OR activate IS NULL</span></span>
<span class="line"><span style="color:#9ECBFF;">   OR hostOrUrl = &#39;&#39;</span></span>
<span class="line"><span style="color:#9ECBFF;">   OR TRIM(hostOrUrl) = &#39;&#39;</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li><li><p><strong>Fix data in datasource:</strong></p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">-- Fix specific tenant data</span></span>
<span class="line"><span style="color:#F97583;">UPDATE</span><span style="color:#F97583;"> &lt;table&gt;</span></span>
<span class="line"><span style="color:#F97583;">SET</span><span style="color:#E1E4E8;"> hostOrUrl </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;https://tenant.example.com&#39;</span></span>
<span class="line"><span style="color:#F97583;">WHERE</span><span style="color:#F97583;"> uid</span><span style="color:#F97583;"> =</span><span style="color:#9ECBFF;"> &#39;&lt;failed-tenant-uid&gt;&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- Or deactivate invalid tenants temporarily</span></span>
<span class="line"><span style="color:#F97583;">UPDATE</span><span style="color:#F97583;"> &lt;table&gt;</span></span>
<span class="line"><span style="color:#F97583;">SET</span><span style="color:#E1E4E8;"> activate </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 0</span></span>
<span class="line"><span style="color:#F97583;">WHERE</span><span style="color:#F97583;"> uid</span><span style="color:#F97583;"> =</span><span style="color:#9ECBFF;"> &#39;&lt;failed-tenant-uid&gt;&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li><li><p><strong>Wait for next sync or trigger manually:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Registry controller will sync on next interval</span></span>
<span class="line"><span style="color:#6A737D;"># Or delete and recreate tenant to force immediate sync</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> delete</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">failed-tenant-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#6A737D;"># It will be recreated on next registry sync</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ol><h3 id="for-template-variable-issues" tabindex="-1">For Template Variable Issues <a class="header-anchor" href="#for-template-variable-issues" aria-label="Permalink to &quot;For Template Variable Issues&quot;">​</a></h3><ol><li><p><strong>Check what variables failed tenant needs:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">failed-tenant-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -o</span><span style="color:#9ECBFF;"> yaml</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> grep</span><span style="color:#79B8FF;"> -A</span><span style="color:#79B8FF;"> 50</span><span style="color:#9ECBFF;"> &quot;spec:&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p><strong>Add default values to template:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> edit</span><span style="color:#9ECBFF;"> tenanttemplate</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">template-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Use default filters for optional fields:</span></span>
<span class="line"><span style="color:#6A737D;"># image: &quot;{{ .deployImage | default \\&quot;nginx:stable\\&quot; }}&quot;</span></span>
<span class="line"><span style="color:#6A737D;"># replicas: {{ .replicas | default 1 }}</span></span>
<span class="line"><span style="color:#6A737D;"># value: &quot;{{ .optionalField | default \\&quot;default-value\\&quot; }}&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li><li><p><strong>Or add missing extraValueMappings:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> edit</span><span style="color:#9ECBFF;"> tenantregistry</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">registry-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Add missing column mappings:</span></span>
<span class="line"><span style="color:#6A737D;"># spec:</span></span>
<span class="line"><span style="color:#6A737D;">#   source:</span></span>
<span class="line"><span style="color:#6A737D;">#     extraValueMappings:</span></span>
<span class="line"><span style="color:#6A737D;">#       deployImage: deploy_image_column</span></span>
<span class="line"><span style="color:#6A737D;">#       replicas: replica_count_column</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ol><h3 id="for-resource-conflicts" tabindex="-1">For Resource Conflicts <a class="header-anchor" href="#for-resource-conflicts" aria-label="Permalink to &quot;For Resource Conflicts&quot;">​</a></h3><ol><li><p><strong>Identify conflicting resources:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> describe</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">failed-tenant-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> grep</span><span style="color:#79B8FF;"> -i</span><span style="color:#9ECBFF;"> conflict</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>Remove conflicting resources:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Backup first</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">resource-kin</span><span style="color:#E1E4E8;">d</span><span style="color:#F97583;">&gt;</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">resource-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span><span style="color:#F97583;"> &gt;</span><span style="color:#9ECBFF;"> backup.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Delete conflicting resource</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> delete</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">resource-kin</span><span style="color:#E1E4E8;">d</span><span style="color:#F97583;">&gt;</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">resource-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p><strong>Or adjust naming pattern:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> edit</span><span style="color:#9ECBFF;"> tenanttemplate</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">template-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#6A737D;"># Ensure nameTemplate includes tenant UID for uniqueness</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol><h3 id="for-quota-issues" tabindex="-1">For Quota Issues <a class="header-anchor" href="#for-quota-issues" aria-label="Permalink to &quot;For Quota Issues&quot;">​</a></h3><ol><li><p><strong>Check namespace quotas:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> describe</span><span style="color:#9ECBFF;"> resourcequota</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> describe</span><span style="color:#9ECBFF;"> limitrange</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p><strong>Increase quota if appropriate:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> edit</span><span style="color:#9ECBFF;"> resourcequota</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">quota-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#6A737D;"># Increase limits</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p><strong>Or reduce tenant resource requests:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> edit</span><span style="color:#9ECBFF;"> tenanttemplate</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">template-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#6A737D;"># Reduce CPU/memory requests</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol><h3 id="force-single-tenant-reconciliation" tabindex="-1">Force Single Tenant Reconciliation <a class="header-anchor" href="#force-single-tenant-reconciliation" aria-label="Permalink to &quot;Force Single Tenant Reconciliation&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Delete and recreate specific failed tenant</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> delete</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">failed-tenant-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># It will be recreated on next registry sync (every syncInterval)</span></span>
<span class="line"><span style="color:#6A737D;"># Or annotate registry to force immediate sync</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> annotate</span><span style="color:#9ECBFF;"> tenantregistry</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">registry-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#9ECBFF;">  tenant.operator.kubernetes-tenants.org/sync=&quot;$(</span><span style="color:#B392F0;">date</span><span style="color:#9ECBFF;"> +%s)&quot;</span><span style="color:#79B8FF;"> --overwrite</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="batch-fix-for-multiple-failed-tenants" tabindex="-1">Batch Fix for Multiple Failed Tenants <a class="header-anchor" href="#batch-fix-for-multiple-failed-tenants" aria-label="Permalink to &quot;Batch Fix for Multiple Failed Tenants&quot;">​</a></h2><p>If all failed tenants have same root cause:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Fix root cause (template, registry, quotas, etc.)</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> edit</span><span style="color:#9ECBFF;"> tenanttemplate</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">template-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Force reconciliation of all failed tenants</span></span>
<span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> tenant </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> $(</span><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenants</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -l</span><span style="color:#9ECBFF;"> kubernetes-tenants.org/registry=</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">registry-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -o</span><span style="color:#9ECBFF;"> json</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> jq</span><span style="color:#79B8FF;"> -r</span><span style="color:#9ECBFF;"> &#39;.items[] | select(.status.conditions[]? | select(.type==&quot;Ready&quot; and .status==&quot;False&quot;)) | .metadata.name&#39;</span><span style="color:#E1E4E8;">); </span><span style="color:#F97583;">do</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">  echo</span><span style="color:#9ECBFF;"> &quot;Reconciling </span><span style="color:#E1E4E8;">$tenant</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#B392F0;">  kubectl</span><span style="color:#9ECBFF;"> annotate</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#E1E4E8;"> $tenant </span><span style="color:#79B8FF;">-n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#9ECBFF;">    tenant.operator.kubernetes-tenants.org/reconcile=&quot;$(</span><span style="color:#B392F0;">date</span><span style="color:#9ECBFF;"> +%s)&quot;</span><span style="color:#79B8FF;"> --overwrite</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">  sleep</span><span style="color:#79B8FF;"> 2</span><span style="color:#6A737D;">  # Avoid overwhelming operator</span></span>
<span class="line"><span style="color:#F97583;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Monitor recovery</span></span>
<span class="line"><span style="color:#B392F0;">watch</span><span style="color:#9ECBFF;"> &#39;kubectl get tenants -n &lt;namespace&gt; -l kubernetes-tenants.org/registry=&lt;registry-name&gt; --no-headers | awk &quot;{print \\$2}&quot; | sort | uniq -c&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="prevention" tabindex="-1">Prevention <a class="header-anchor" href="#prevention" aria-label="Permalink to &quot;Prevention&quot;">​</a></h2><ol><li><p><strong>Data validation at source:</strong></p><ul><li>Implement database constraints</li><li>Validate data before insertion</li><li>Use NOT NULL constraints on required columns</li><li>Validate URL formats</li></ul><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">ALTER</span><span style="color:#F97583;"> TABLE</span><span style="color:#E1E4E8;"> tenants</span></span>
<span class="line"><span style="color:#F97583;">ADD</span><span style="color:#F97583;"> CONSTRAINT</span><span style="color:#E1E4E8;"> check_uid </span><span style="color:#F97583;">CHECK</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">uid</span><span style="color:#F97583;"> IS NOT NULL</span><span style="color:#F97583;"> AND</span><span style="color:#F97583;"> uid</span><span style="color:#F97583;"> !=</span><span style="color:#9ECBFF;"> &#39;&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">ALTER</span><span style="color:#F97583;"> TABLE</span><span style="color:#E1E4E8;"> tenants</span></span>
<span class="line"><span style="color:#F97583;">ADD</span><span style="color:#F97583;"> CONSTRAINT</span><span style="color:#E1E4E8;"> check_url </span><span style="color:#F97583;">CHECK</span><span style="color:#E1E4E8;"> (hostOrUrl </span><span style="color:#F97583;">LIKE</span><span style="color:#9ECBFF;"> &#39;http%://%&#39;</span><span style="color:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p><strong>Template robustness:</strong></p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Always use default values for optional fields</span></span>
<span class="line"><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .deployImage | default </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">nginx:stable</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;"> }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: {{ </span><span style="color:#9ECBFF;">.replicas | default 1</span><span style="color:#E1E4E8;"> }}</span></span>
<span class="line"><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .optionalValue | default </span><span style="color:#79B8FF;">\\&quot;\\&quot;</span><span style="color:#9ECBFF;"> }}&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Validate and sanitize inputs</span></span>
<span class="line"><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid | trunc63 | lower }}&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li><li><p><strong>Comprehensive testing:</strong></p><ul><li>Test templates with edge cases</li><li>Include tenants with minimal data</li><li>Test with NULL or empty values</li><li>Validate all code paths</li></ul></li><li><p><strong>Monitoring and alerting:</strong></p><ul><li>Alert on any failed tenants</li><li>Track failure patterns</li><li>Monitor datasource data quality</li></ul></li><li><p><strong>Gradual rollout:</strong></p><ul><li>Start with subset of tenants</li><li>Validate before enabling all</li><li>Use canary deployments</li></ul></li></ol><h2 id="monitoring" tabindex="-1">Monitoring <a class="header-anchor" href="#monitoring" aria-label="Permalink to &quot;Monitoring&quot;">​</a></h2><div class="language-promql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">promql</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span># Failed tenant count</span></span>
<span class="line"><span>registry_failed{registry=&quot;&lt;registry-name&gt;&quot;}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Failed tenant percentage</span></span>
<span class="line"><span>(registry_failed / registry_desired) * 100</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Tenants becoming failed</span></span>
<span class="line"><span>increase(registry_failed{registry=&quot;&lt;registry-name&gt;&quot;}[10m]) &gt; 0</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Specific tenant status</span></span>
<span class="line"><span>tenant_condition_status{tenant=&quot;&lt;tenant-name&gt;&quot;, type=&quot;Ready&quot;}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="differentiation-from-other-alerts" tabindex="-1">Differentiation from Other Alerts <a class="header-anchor" href="#differentiation-from-other-alerts" aria-label="Permalink to &quot;Differentiation from Other Alerts&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Alert</th><th>Condition</th><th>Severity</th><th>Meaning</th></tr></thead><tbody><tr><td>RegistryTenantsFailure</td><td>1-5 failed</td><td>Warning</td><td>Isolated failures - tenant-specific</td></tr><tr><td>RegistryManyTenantsFailure</td><td>&gt;5 or &gt;50%</td><td>Critical</td><td>Systemic issue - registry-wide</td></tr></tbody></table><h2 id="related-alerts" tabindex="-1">Related Alerts <a class="header-anchor" href="#related-alerts" aria-label="Permalink to &quot;Related Alerts&quot;">​</a></h2><ul><li><code>RegistryManyTenantsFailure</code> - Escalates to if more tenants fail</li><li><code>TenantResourcesFailed</code> - Individual tenant resource failures</li><li><code>TenantDegraded</code> - Failed tenants will be degraded</li><li><code>TenantNotReady</code> - Failed tenants won&#39;t be ready</li></ul><h2 id="investigation-checklist" tabindex="-1">Investigation Checklist <a class="header-anchor" href="#investigation-checklist" aria-label="Permalink to &quot;Investigation Checklist&quot;">​</a></h2><ul><li>[ ] Identify which specific tenants are failing</li><li>[ ] Check failure reasons from tenant conditions</li><li>[ ] Compare failed tenant data with successful ones</li><li>[ ] Validate tenant data in datasource</li><li>[ ] Check for common patterns in failed tenants</li><li>[ ] Review recent template or registry changes</li><li>[ ] Check namespace quotas and limits</li><li>[ ] Verify no resource naming conflicts</li><li>[ ] Check operator logs for specific errors</li><li>[ ] Test fix with one tenant before batch apply</li></ul><h2 id="escalation" tabindex="-1">Escalation <a class="header-anchor" href="#escalation" aria-label="Permalink to &quot;Escalation&quot;">​</a></h2><p>If failures persist or pattern is unclear:</p><ol><li><p>Collect diagnostics:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Registry details</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenantregistry</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">registry-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span><span style="color:#F97583;"> &gt;</span><span style="color:#9ECBFF;"> registry.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># All tenants status</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenants</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> kubernetes-tenants.org/registry=</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">registry-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span><span style="color:#F97583;"> &gt;</span><span style="color:#9ECBFF;"> tenants.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Failed tenants details</span></span>
<span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> tenant </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> $(</span><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenants</span><span style="color:#79B8FF;"> -n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -l</span><span style="color:#9ECBFF;"> kubernetes-tenants.org/registry=</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">registry-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  -o</span><span style="color:#9ECBFF;"> json</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> jq</span><span style="color:#79B8FF;"> -r</span><span style="color:#9ECBFF;"> &#39;.items[] | select(.status.conditions[]? | select(.type==&quot;Ready&quot; and .status==&quot;False&quot;)) | .metadata.name&#39;</span><span style="color:#E1E4E8;">); </span><span style="color:#F97583;">do</span></span>
<span class="line"><span style="color:#B392F0;">  kubectl</span><span style="color:#9ECBFF;"> describe</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#E1E4E8;"> $tenant </span><span style="color:#79B8FF;">-n</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#F97583;"> &gt;</span><span style="color:#E1E4E8;"> $tenant</span><span style="color:#9ECBFF;">-describe.txt</span></span>
<span class="line"><span style="color:#F97583;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Operator logs filtered for failed tenants</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app=tenant-operator</span><span style="color:#79B8FF;"> --tail=1000</span><span style="color:#F97583;"> &gt;</span><span style="color:#9ECBFF;"> operator.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Datasource query results for failed tenants</span></span>
<span class="line"><span style="color:#6A737D;"># Export data for failed tenant UIDs</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li><li><p>Analyze for patterns:</p><ul><li>Are failures correlated with specific data patterns?</li><li>Did failures start after a specific change?</li><li>Is there a common error message?</li></ul></li><li><p>If unable to resolve:</p><ul><li>Escalate to platform team</li><li>Review datasource data quality</li><li>Check for operator bugs</li><li>Open GitHub issue with diagnostics</li></ul></li></ol>`,49)])])}const d=a(p,[["render",o]]);export{u as __pageData,d as default};
