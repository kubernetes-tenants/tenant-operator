import{_ as p,C as o,c as r,o as a,a2 as n,b as t,w as e,a as c,G as i,a3 as u}from"./chunks/framework.9Uv4PgnO.js";const D=JSON.parse('{"title":"Configuration Guide","description":"","frontmatter":{},"headers":[],"relativePath":"configuration.md","filePath":"configuration.md","lastUpdated":1762395525000}'),d={name:"configuration.md"};function E(y,s,b,m,h,f){const l=o("Mermaid");return a(),r("div",null,[s[1]||(s[1]=n(`<h1 id="configuration-guide" tabindex="-1">Configuration Guide <a class="header-anchor" href="#configuration-guide" aria-label="Permalink to &quot;Configuration Guide&quot;">​</a></h1><p>Configure Tenant Operator consistently across environments.</p><nav class="table-of-contents"><ul><li><a href="#operator-runtime">Operator Runtime</a><ul><li><a href="#controller-flags">Controller Flags</a></li><li><a href="#resource-requests">Resource Requests</a></li></ul></li><li><a href="#registry-configuration">Registry Configuration</a><ul><li><a href="#mysql-data-source">MySQL Data Source</a></li></ul></li><li><a href="#template-configuration">Template Configuration</a><ul><li><a href="#default-policies">Default Policies</a></li></ul></li><li><a href="#security-configuration">Security Configuration</a><ul><li><a href="#rbac">RBAC</a></li><li><a href="#network-policies">Network Policies</a></li></ul></li><li><a href="#see-also">See Also</a></li></ul></nav><h2 id="operator-runtime" tabindex="-1">Operator Runtime <a class="header-anchor" href="#operator-runtime" aria-label="Permalink to &quot;Operator Runtime&quot;">​</a></h2><h3 id="controller-flags" tabindex="-1">Controller Flags <a class="header-anchor" href="#controller-flags" aria-label="Permalink to &quot;Controller Flags&quot;">​</a></h3><p>Flags are defined in <code>config/manager/manager.yaml</code> and applied to the controller manager deployment.</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">manager</span></span>
<span class="line"><span style="color:#85E89D;">          args</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#6A737D;">            # Leader Election</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#9ECBFF;">--leader-elect=true</span><span style="color:#6A737D;">                 # Enable leader election (default: false)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">            # Metrics &amp; Health</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#9ECBFF;">--metrics-bind-address=:8443</span><span style="color:#6A737D;">        # Metrics endpoint (default: 0 = disabled)</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#9ECBFF;">--health-probe-bind-address=:8081</span><span style="color:#6A737D;">   # Health probe endpoint (default: :8081)</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#9ECBFF;">--metrics-secure=true</span><span style="color:#6A737D;">               # Use HTTPS for metrics (default: true)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">            # HTTP/2</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#9ECBFF;">--enable-http2=false</span><span style="color:#6A737D;">                # Enable HTTP/2 (default: false, disabled for security)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">            # TLS Certificates (cert-manager REQUIRED for webhook TLS)</span></span>
<span class="line"><span style="color:#6A737D;">            # cert-manager automatically provisions certificates to these paths</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#9ECBFF;">--webhook-cert-path=/tmp/k8s-webhook-server/serving-certs</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#9ECBFF;">--metrics-cert-path=/tmp/k8s-metrics-server/serving-certs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">            # Logging (provided by controller-runtime zap)</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#9ECBFF;">--zap-devel=false</span><span style="color:#6A737D;">                   # Development mode (default: true)</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#9ECBFF;">--zap-encoder=json</span><span style="color:#6A737D;">                  # Encoder: json, console</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#9ECBFF;">--zap-log-level=info</span><span style="color:#6A737D;">                # Level: debug, info, error, panic</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#9ECBFF;">--zap-stacktrace-level=error</span><span style="color:#6A737D;">        # Stacktrace level: info, error, panic</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#9ECBFF;">--zap-time-encoding=epoch</span><span style="color:#6A737D;">           # Time format: epoch, iso8601, rfc3339, etc.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">Recommended practice</p><p>Enable leader election in all multi-node clusters and keep metrics on the secure port so that Prometheus can scrape with TLS.</p></div><h3 id="resource-requests" tabindex="-1">Resource Requests <a class="header-anchor" href="#resource-requests" aria-label="Permalink to &quot;Resource Requests&quot;">​</a></h3><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  limits</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1000m</span></span>
<span class="line"><span style="color:#85E89D;">    memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1Gi</span></span>
<span class="line"><span style="color:#85E89D;">  requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">200m</span></span>
<span class="line"><span style="color:#85E89D;">    memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">256Mi</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="info custom-block"><p class="custom-block-title">Sizing guidance</p><p>Requests ensure the controller can start on smaller nodes, while the higher limits accommodate bursts from reconciliation loops and template rendering.</p></div><h2 id="registry-configuration" tabindex="-1">Registry Configuration <a class="header-anchor" href="#registry-configuration" aria-label="Permalink to &quot;Registry Configuration&quot;">​</a></h2><h3 id="mysql-data-source" tabindex="-1">MySQL Data Source <a class="header-anchor" href="#mysql-data-source" aria-label="Permalink to &quot;MySQL Data Source&quot;">​</a></h3><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.kubernetes-tenants.org/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TenantRegistry</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-registry</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  source</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#85E89D;">    mysql</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql.default.svc.cluster.local</span></span>
<span class="line"><span style="color:#85E89D;">      port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3306</span></span>
<span class="line"><span style="color:#85E89D;">      username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tenant_reader</span></span>
<span class="line"><span style="color:#85E89D;">      passwordRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-credentials</span></span>
<span class="line"><span style="color:#85E89D;">        key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">password</span></span>
<span class="line"><span style="color:#85E89D;">      database</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tenants</span></span>
<span class="line"><span style="color:#85E89D;">      table</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tenant_configs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    # Sync interval - how often to check database for changes</span></span>
<span class="line"><span style="color:#85E89D;">    syncInterval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Required value mappings (map database columns to tenant variables)</span></span>
<span class="line"><span style="color:#85E89D;">  valueMappings</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    uid</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tenant_id</span><span style="color:#6A737D;">           # Unique tenant identifier</span></span>
<span class="line"><span style="color:#85E89D;">    hostOrUrl</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tenant_url</span><span style="color:#6A737D;">    # Tenant URL/hostname</span></span>
<span class="line"><span style="color:#85E89D;">    activate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">is_active</span><span style="color:#6A737D;">      # Activation flag (boolean)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Optional extra mappings (custom variables for templates)</span></span>
<span class="line"><span style="color:#85E89D;">  extraValueMappings</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    planId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">subscription_plan</span></span>
<span class="line"><span style="color:#85E89D;">    region</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">deployment_region</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><div class="warning custom-block"><p class="custom-block-title">Production reminder</p><p>Grant the registry user read-only credentials and limit network access between the operator namespace and the database.</p></div><h2 id="template-configuration" tabindex="-1">Template Configuration <a class="header-anchor" href="#template-configuration" aria-label="Permalink to &quot;Template Configuration&quot;">​</a></h2>`,16)),(a(),t(u,null,{default:e(()=>[i(l,{id:"mermaid-48",class:"mermaid my-class",graph:"flowchart%20TB%0A%20%20%20%20Template%5B%22TenantTemplate%3Cbr%2F%3ESpec%22%5D%0A%20%20%20%20Policies%5B%22Policies%3Cbr%2F%3E(Creation%2FDeletion%2FConflict%2FPatch)%22%5D%0A%20%20%20%20Renderer%5B%22Template%20Renderer%22%5D%0A%20%20%20%20Tenant%5B%22Tenant%20CR%22%5D%0A%20%20%20%20Resources%5B%22Applied%20Resources%22%5D%0A%0A%20%20%20%20Template%20--%3E%20Policies%20--%3E%20Renderer%20--%3E%20Tenant%20--%3E%20Resources%0A%0A%20%20%20%20classDef%20block%20fill%3A%23fff8e1%2Cstroke%3A%23ffca28%2Cstroke-width%3A2px%3B%0A%20%20%20%20class%20Template%2CPolicies%2CRenderer%2CTenant%2CResources%20block%3B%0A"})]),fallback:e(()=>[...s[0]||(s[0]=[c(" Loading... ",-1)])]),_:1})),s[2]||(s[2]=n(`<h3 id="default-policies" tabindex="-1">Default Policies <a class="header-anchor" href="#default-policies" aria-label="Permalink to &quot;Default Policies&quot;">​</a></h3><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.kubernetes-tenants.org/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TenantTemplate</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-template</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  registryId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-registry</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">  deployments</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app</span></span>
<span class="line"><span style="color:#6A737D;">      # Policies (all optional, shown with defaults)</span></span>
<span class="line"><span style="color:#85E89D;">      creationPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">WhenNeeded</span><span style="color:#6A737D;">    # Once | WhenNeeded</span></span>
<span class="line"><span style="color:#85E89D;">      deletionPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Delete</span><span style="color:#6A737D;">        # Delete | Retain</span></span>
<span class="line"><span style="color:#85E89D;">      conflictPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Stuck</span><span style="color:#6A737D;">         # Stuck | Force</span></span>
<span class="line"><span style="color:#85E89D;">      patchStrategy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apply</span><span style="color:#6A737D;">          # apply | merge | replace</span></span>
<span class="line"><span style="color:#85E89D;">      waitForReady</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#6A737D;">            # Wait for resource ready</span></span>
<span class="line"><span style="color:#85E89D;">      timeoutSeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">300</span><span style="color:#6A737D;">           # Readiness timeout (max 3600)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">      # Templates</span></span>
<span class="line"><span style="color:#85E89D;">      nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-app&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      labelsTemplate</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#6A737D;">        # Resource spec...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><details class="details custom-block"><summary>Policy cheat sheet</summary><table tabindex="0"><thead><tr><th>Policy</th><th>Effect</th><th>Default</th></tr></thead><tbody><tr><td><code>creationPolicy</code></td><td>When <code>Once</code>, the controller never recreates deleted resources. <code>WhenNeeded</code> reconciles on every sync.</td><td><code>WhenNeeded</code></td></tr><tr><td><code>deletionPolicy</code></td><td><code>Retain</code> keeps objects (no ownerReference, label-based tracking); <code>Delete</code> cleans them up (with ownerReference).</td><td><code>Delete</code></td></tr><tr><td><code>conflictPolicy</code></td><td><code>Force</code> overwrites conflicting fields; <code>Stuck</code> marks the resource as failed for manual intervention.</td><td><code>Stuck</code></td></tr><tr><td><code>patchStrategy</code></td><td>Determines how the resource spec is applied. Use <code>merge</code> for strategic merge resources.</td><td><code>apply</code></td></tr></tbody></table></details><h2 id="security-configuration" tabindex="-1">Security Configuration <a class="header-anchor" href="#security-configuration" aria-label="Permalink to &quot;Security Configuration&quot;">​</a></h2><h3 id="rbac" tabindex="-1">RBAC <a class="header-anchor" href="#rbac" aria-label="Permalink to &quot;RBAC&quot;">​</a></h3><p>Default RBAC is automatically created during installation and includes:</p><ul><li>Full access to TenantRegistry, TenantTemplate, Tenant CRDs</li><li>Management of workload resources (Deployments, Services, etc.)</li><li>Read-only access to Secrets (for database credentials)</li><li>Events and lease management for leader election</li></ul><p>RBAC manifests are located in <code>config/rbac/</code> and are applied automatically via <code>make deploy</code>.</p><h3 id="network-policies" tabindex="-1">Network Policies <a class="header-anchor" href="#network-policies" aria-label="Permalink to &quot;Network Policies&quot;">​</a></h3><p>Network policies are not included by default. If your cluster requires network policies, create them based on your security requirements:</p><ul><li>Allow ingress from Kubernetes API server for <strong>webhooks</strong> (webhooks require cert-manager)</li><li>Allow ingress from cert-manager for certificate provisioning</li><li>Allow egress to database for registry sync</li><li>Allow egress to Kubernetes API for resource management</li></ul><p>See <code>config/network-policy/</code> for example configurations.</p><div class="info custom-block"><p class="custom-block-title">cert-manager Required</p><p>Webhooks require cert-manager v1.13.0+ to be installed for TLS certificate management. See the <a href="./installation.html">Installation Guide</a> for setup instructions.</p></div><h2 id="see-also" tabindex="-1">See Also <a class="header-anchor" href="#see-also" aria-label="Permalink to &quot;See Also&quot;">​</a></h2><ul><li><a href="./installation.html">Installation Guide</a></li><li><a href="./security.html">Security Guide</a></li><li><a href="./performance.html">Performance Guide</a></li></ul>`,15))])}const F=p(d,[["render",E]]);export{D as __pageData,F as default};
