import{_ as c,C as i,c as E,o as a,a2 as e,b as p,w as n,a as o,G as r,a5 as t}from"./chunks/framework.BNM54Z5_.js";const D=JSON.parse('{"title":"ExternalDNS Integration Guide","description":"","frontmatter":{},"headers":[],"relativePath":"integration-external-dns.md","filePath":"integration-external-dns.md","lastUpdated":1762822981000}'),d={name:"integration-external-dns.md"};function b(u,s,y,m,h,F){const l=i("Mermaid");return a(),E("div",null,[s[2]||(s[2]=e('<h1 id="externaldns-integration-guide" tabindex="-1">ExternalDNS Integration Guide <a class="header-anchor" href="#externaldns-integration-guide" aria-label="Permalink to &quot;ExternalDNS Integration Guide&quot;">​</a></h1><p>This guide shows how to integrate Tenant Operator with ExternalDNS for automatic DNS record management.</p><nav class="table-of-contents"><ul><li><a href="#overview">Overview</a><ul><li><a href="#use-cases">Use Cases</a></li></ul></li><li><a href="#prerequisites">Prerequisites</a></li><li><a href="#installation">Installation</a><ul><li><a href="#_1-install-externaldns">1. Install ExternalDNS</a></li><li><a href="#_2-verify-installation">2. Verify Installation</a></li></ul></li><li><a href="#integration-with-tenant-operator">Integration with Tenant Operator</a><ul><li><a href="#basic-example-ingress-with-automatic-dns">Basic Example: Ingress with Automatic DNS</a></li><li><a href="#loadbalancer-service-example">LoadBalancer Service Example</a></li></ul></li><li><a href="#how-it-works">How It Works</a><ul><li><a href="#workflow">Workflow</a></li><li><a href="#dns-record-lifecycle">DNS Record Lifecycle</a></li></ul></li><li><a href="#common-annotations">Common Annotations</a><ul><li><a href="#required">Required</a></li><li><a href="#optional">Optional</a></li><li><a href="#provider-specific">Provider-Specific</a></li></ul></li><li><a href="#multi-domain-example">Multi-Domain Example</a></li><li><a href="#troubleshooting">Troubleshooting</a><ul><li><a href="#dns-records-not-created">DNS Records Not Created</a></li><li><a href="#dns-records-not-deleted">DNS Records Not Deleted</a></li><li><a href="#dns-propagation-delays">DNS Propagation Delays</a></li></ul></li><li><a href="#best-practices">Best Practices</a><ul><li><a href="#_1-use-separate-hosted-zones">1. Use Separate Hosted Zones</a></li><li><a href="#_2-set-appropriate-ttls">2. Set Appropriate TTLs</a></li><li><a href="#_3-use-policy-upsert-only-for-safety">3. Use Policy: upsert-only for Safety</a></li><li><a href="#_4-monitor-externaldns-logs">4. Monitor ExternalDNS Logs</a></li><li><a href="#_5-combine-with-cert-manager">5. Combine with cert-manager</a></li></ul></li><li><a href="#see-also">See Also</a></li></ul></nav><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p><strong>ExternalDNS</strong> synchronizes exposed Kubernetes Services and Ingresses with DNS providers like AWS Route53, Google Cloud DNS, Cloudflare, and more. When integrated with Tenant Operator, each tenant&#39;s DNS records are automatically created and deleted as tenants are provisioned.</p>',5)),(a(),p(t,null,{default:n(()=>[r(l,{id:"mermaid-15",class:"mermaid my-class",graph:"flowchart%20LR%0A%20%20%20%20Tenant%5B%22Tenant%20CR%3Cbr%2F%3E(Ingress%2FService%20templates)%22%5D%0A%20%20%20%20Resource%5B%22Kubernetes%20Ingress%2FService%22%5D%0A%20%20%20%20ExternalDNS%5B%22ExternalDNS%20Controller%22%5D%0A%20%20%20%20Provider%5B%22DNS%20Provider%3Cbr%2F%3E(Route53%2C%20Cloudflare%2C%20...)%22%5D%0A%20%20%20%20DNS%5B%22DNS%20Records%3Cbr%2F%3E(tenant.example.com)%22%5D%0A%0A%20%20%20%20Tenant%20--%3E%20Resource%20--%3E%20ExternalDNS%20--%3E%20Provider%20--%3E%20DNS%0A%0A%20%20%20%20classDef%20tenant%20fill%3A%23e3f2fd%2Cstroke%3A%2364b5f6%2Cstroke-width%3A2px%3B%0A%20%20%20%20class%20Tenant%20tenant%3B%0A%20%20%20%20classDef%20external%20fill%3A%23f3e5f5%2Cstroke%3A%23ba68c8%2Cstroke-width%3A2px%3B%0A%20%20%20%20class%20ExternalDNS%20external%3B%0A%20%20%20%20classDef%20provider%20fill%3A%23fff8e1%2Cstroke%3A%23ffca28%2Cstroke-width%3A2px%3B%0A%20%20%20%20class%20Provider%2CDNS%20provider%3B%0A"})]),fallback:n(()=>[...s[0]||(s[0]=[o(" Loading... ",-1)])]),_:1})),s[3]||(s[3]=e(`<h3 id="use-cases" tabindex="-1">Use Cases <a class="header-anchor" href="#use-cases" aria-label="Permalink to &quot;Use Cases&quot;">​</a></h3><ul><li><strong>Multi-tenant SaaS</strong>: Automatic subdomain creation per tenant (e.g., <code>tenant-a.example.com</code>, <code>tenant-b.example.com</code>)</li><li><strong>Dynamic environments</strong>: DNS records follow tenant lifecycle (created/deleted with tenant)</li><li><strong>Multiple domains</strong>: Different tenants on different domains or subdomains</li><li><strong>SSL/TLS automation</strong>: Combined with cert-manager for automatic certificate provisioning</li></ul><h2 id="prerequisites" tabindex="-1">Prerequisites <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;Prerequisites&quot;">​</a></h2><div class="info custom-block"><p class="custom-block-title">Requirements</p><ul><li>Kubernetes cluster v1.11+</li><li>Tenant Operator installed and reconciling</li><li>DNS provider account (AWS Route53, Cloudflare, etc.)</li><li>DNS zone created in your provider</li></ul></div><h2 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to &quot;Installation&quot;">​</a></h2><h3 id="_1-install-externaldns" tabindex="-1">1. Install ExternalDNS <a class="header-anchor" href="#_1-install-externaldns" aria-label="Permalink to &quot;1. Install ExternalDNS&quot;">​</a></h3><h4 id="using-helm-recommended" tabindex="-1">Using Helm (Recommended) <a class="header-anchor" href="#using-helm-recommended" aria-label="Permalink to &quot;Using Helm (Recommended)&quot;">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Add bitnami repo</span></span>
<span class="line"><span style="color:#B392F0;">helm</span><span style="color:#9ECBFF;"> repo</span><span style="color:#9ECBFF;"> add</span><span style="color:#9ECBFF;"> bitnami</span><span style="color:#9ECBFF;"> https://charts.bitnami.com/bitnami</span></span>
<span class="line"><span style="color:#B392F0;">helm</span><span style="color:#9ECBFF;"> repo</span><span style="color:#9ECBFF;"> update</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Install ExternalDNS for AWS Route53</span></span>
<span class="line"><span style="color:#B392F0;">helm</span><span style="color:#9ECBFF;"> install</span><span style="color:#9ECBFF;"> external-dns</span><span style="color:#9ECBFF;"> bitnami/external-dns</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --namespace</span><span style="color:#9ECBFF;"> kube-system</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --set</span><span style="color:#9ECBFF;"> provider=aws</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --set</span><span style="color:#9ECBFF;"> aws.zoneType=public</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --set</span><span style="color:#9ECBFF;"> domainFilters[0]=example.com</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --set</span><span style="color:#9ECBFF;"> policy=upsert-only</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --set</span><span style="color:#9ECBFF;"> txtOwnerId=my-cluster-id</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Or for Cloudflare</span></span>
<span class="line"><span style="color:#B392F0;">helm</span><span style="color:#9ECBFF;"> install</span><span style="color:#9ECBFF;"> external-dns</span><span style="color:#9ECBFF;"> bitnami/external-dns</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --namespace</span><span style="color:#9ECBFF;"> kube-system</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --set</span><span style="color:#9ECBFF;"> provider=cloudflare</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --set</span><span style="color:#9ECBFF;"> cloudflare.apiToken=</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">your-api-toke</span><span style="color:#E1E4E8;">n</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --set</span><span style="color:#9ECBFF;"> domainFilters[0]=example.com</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="using-manifests" tabindex="-1">Using Manifests <a class="header-anchor" href="#using-manifests" aria-label="Permalink to &quot;Using Manifests&quot;">​</a></h4><p>For detailed YAML manifests and provider-specific configurations, see:</p><ul><li><a href="https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/aws.md" target="_blank" rel="noreferrer">ExternalDNS AWS Setup</a></li><li><a href="https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/cloudflare.md" target="_blank" rel="noreferrer">ExternalDNS Cloudflare Setup</a></li><li><a href="https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/gcp.md" target="_blank" rel="noreferrer">ExternalDNS GCP Setup</a></li></ul><h3 id="_2-verify-installation" tabindex="-1">2. Verify Installation <a class="header-anchor" href="#_2-verify-installation" aria-label="Permalink to &quot;2. Verify Installation&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Check ExternalDNS pod</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> pods</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> kube-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app.kubernetes.io/name=external-dns</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check logs</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> kube-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app.kubernetes.io/name=external-dns</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="integration-with-tenant-operator" tabindex="-1">Integration with Tenant Operator <a class="header-anchor" href="#integration-with-tenant-operator" aria-label="Permalink to &quot;Integration with Tenant Operator&quot;">​</a></h2><h3 id="basic-example-ingress-with-automatic-dns" tabindex="-1">Basic Example: Ingress with Automatic DNS <a class="header-anchor" href="#basic-example-ingress-with-automatic-dns" aria-label="Permalink to &quot;Basic Example: Ingress with Automatic DNS&quot;">​</a></h3><p><strong>TenantTemplate with ExternalDNS annotations:</strong></p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.kubernetes-tenants.org/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TenantTemplate</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">web-app-with-dns</span></span>
<span class="line"><span style="color:#85E89D;">  namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  registryId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-registry</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Deployment</span></span>
<span class="line"><span style="color:#85E89D;">  deployments</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-app&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#85E89D;">        selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">              app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app</span></span>
<span class="line"><span style="color:#85E89D;">              image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx:alpine</span></span>
<span class="line"><span style="color:#85E89D;">              ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Service</span></span>
<span class="line"><span style="color:#85E89D;">  services</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app-service</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-svc&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#85E89D;">          targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  # Ingress with ExternalDNS annotation</span></span>
<span class="line"><span style="color:#85E89D;">  ingresses</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">web-ingress</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-ingress&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    annotationsTemplate</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      external-dns.alpha.kubernetes.io/hostname</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .host }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      external-dns.alpha.kubernetes.io/ttl</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;300&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        ingressClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#85E89D;">        rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .host }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          http</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            paths</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#85E89D;">              pathType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="color:#85E89D;">              backend</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-svc&quot;</span></span>
<span class="line"><span style="color:#85E89D;">                  port</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                    number</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><p><strong>What happens:</strong></p><ol><li>Tenant Operator creates Ingress for each tenant (e.g., <code>acme-corp-ingress</code>)</li><li>ExternalDNS detects Ingress with <code>external-dns.alpha.kubernetes.io/hostname</code> annotation</li><li>ExternalDNS creates DNS A/AAAA record pointing to Ingress LoadBalancer IP</li><li>When tenant is deleted, DNS record is automatically removed</li></ol><p><strong>Result:</strong> Each tenant gets automatic DNS:</p><ul><li><code>acme-corp.example.com</code> → 1.2.3.4</li><li><code>beta-inc.example.com</code> → 1.2.3.4</li></ul><h3 id="loadbalancer-service-example" tabindex="-1">LoadBalancer Service Example <a class="header-anchor" href="#loadbalancer-service-example" aria-label="Permalink to &quot;LoadBalancer Service Example&quot;">​</a></h3><p>For LoadBalancer Services (instead of Ingress):</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">services</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">- </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">lb-service</span></span>
<span class="line"><span style="color:#85E89D;">  nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-lb&quot;</span></span>
<span class="line"><span style="color:#85E89D;">  annotationsTemplate</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    external-dns.alpha.kubernetes.io/hostname</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .host }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    external-dns.alpha.kubernetes.io/ttl</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;300&quot;</span></span>
<span class="line"><span style="color:#85E89D;">  spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">    kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#85E89D;">    type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">LoadBalancer</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#85E89D;">        targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="how-it-works" tabindex="-1">How It Works <a class="header-anchor" href="#how-it-works" aria-label="Permalink to &quot;How It Works&quot;">​</a></h2><h3 id="workflow" tabindex="-1">Workflow <a class="header-anchor" href="#workflow" aria-label="Permalink to &quot;Workflow&quot;">​</a></h3><ol><li><strong>Tenant Created</strong>: TenantRegistry creates Tenant CR from database</li><li><strong>Resources Applied</strong>: Tenant controller creates Ingress/Service with ExternalDNS annotations</li><li><strong>IP Assignment</strong>: Kubernetes assigns LoadBalancer IP or Ingress IP</li><li><strong>DNS Sync</strong>: ExternalDNS detects annotated resource and creates DNS record</li><li><strong>Propagation</strong>: DNS record propagates through provider (seconds to minutes)</li><li><strong>Tenant Deleted</strong>: Tenant resources deleted → ExternalDNS removes DNS record</li></ol><h3 id="dns-record-lifecycle" tabindex="-1">DNS Record Lifecycle <a class="header-anchor" href="#dns-record-lifecycle" aria-label="Permalink to &quot;DNS Record Lifecycle&quot;">​</a></h3>`,28)),(a(),p(t,null,{default:n(()=>[r(l,{id:"mermaid-203",class:"mermaid my-class",graph:"sequenceDiagram%0A%20%20%20%20participant%20TO%20as%20Tenant%20Operator%0A%20%20%20%20participant%20K8s%20as%20Kubernetes%20API%0A%20%20%20%20participant%20ED%20as%20ExternalDNS%0A%20%20%20%20participant%20DNS%20as%20DNS%20Provider%0A%0A%20%20%20%20TO-%3E%3EK8s%3A%20Create%20Ingress%20with%20annotations%0A%20%20%20%20K8s-%3E%3EK8s%3A%20Assign%20LoadBalancer%20IP%0A%20%20%20%20ED-%3E%3EK8s%3A%20Watch%20Ingresses%0A%20%20%20%20ED-%3E%3EED%3A%20Detect%20external-dns%20annotation%0A%20%20%20%20ED-%3E%3EDNS%3A%20Create%20DNS%20A%20record%0A%20%20%20%20DNS--%3E%3EED%3A%20Record%20created%0A%0A%20%20%20%20Note%20over%20TO%2CDNS%3A%20Tenant%20Active%0A%0A%20%20%20%20TO-%3E%3EK8s%3A%20Delete%20Ingress%0A%20%20%20%20ED-%3E%3EK8s%3A%20Detect%20deletion%0A%20%20%20%20ED-%3E%3EDNS%3A%20Delete%20DNS%20record%0A%20%20%20%20DNS--%3E%3EED%3A%20Record%20deleted%0A"})]),fallback:n(()=>[...s[1]||(s[1]=[o(" Loading... ",-1)])]),_:1})),s[4]||(s[4]=e(`<h2 id="common-annotations" tabindex="-1">Common Annotations <a class="header-anchor" href="#common-annotations" aria-label="Permalink to &quot;Common Annotations&quot;">​</a></h2><h3 id="required" tabindex="-1">Required <a class="header-anchor" href="#required" aria-label="Permalink to &quot;Required&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Annotation</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td><code>external-dns.alpha.kubernetes.io/hostname</code></td><td>DNS hostname to create</td><td><code>tenant.example.com</code></td></tr></tbody></table><h3 id="optional" tabindex="-1">Optional <a class="header-anchor" href="#optional" aria-label="Permalink to &quot;Optional&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Annotation</th><th>Description</th><th>Default</th><th>Example</th></tr></thead><tbody><tr><td><code>external-dns.alpha.kubernetes.io/ttl</code></td><td>DNS TTL in seconds</td><td><code>300</code></td><td><code>600</code></td></tr><tr><td><code>external-dns.alpha.kubernetes.io/target</code></td><td>Override target IP/CNAME</td><td>Auto-detected</td><td><code>1.2.3.4</code></td></tr><tr><td><code>external-dns.alpha.kubernetes.io/alias</code></td><td>Use DNS alias (AWS Route53)</td><td><code>false</code></td><td><code>true</code></td></tr></tbody></table><h3 id="provider-specific" tabindex="-1">Provider-Specific <a class="header-anchor" href="#provider-specific" aria-label="Permalink to &quot;Provider-Specific&quot;">​</a></h3><p><strong>AWS Route53:</strong></p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  external-dns.alpha.kubernetes.io/aws-weight</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;100&quot;</span></span>
<span class="line"><span style="color:#85E89D;">  external-dns.alpha.kubernetes.io/set-identifier</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;primary&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>Cloudflare:</strong></p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  external-dns.alpha.kubernetes.io/cloudflare-proxied</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;true&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="multi-domain-example" tabindex="-1">Multi-Domain Example <a class="header-anchor" href="#multi-domain-example" aria-label="Permalink to &quot;Multi-Domain Example&quot;">​</a></h2><p>Support different domains per tenant using template variables:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">operator.kubernetes-tenants.org/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TenantTemplate</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">multi-domain-template</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  registryId</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-registry</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">  ingresses</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tenant-ingress</span></span>
<span class="line"><span style="color:#85E89D;">    nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-ingress&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    annotationsTemplate</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#6A737D;">      # Use .host which is auto-extracted from .hostOrUrl</span></span>
<span class="line"><span style="color:#85E89D;">      external-dns.alpha.kubernetes.io/hostname</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .host }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">      kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="color:#85E89D;">      spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        ingressClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#85E89D;">        rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .host }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">          http</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            paths</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#85E89D;">              pathType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="color:#85E89D;">              backend</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-svc&quot;</span></span>
<span class="line"><span style="color:#85E89D;">                  port</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                    number</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p><strong>Database rows:</strong></p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">tenant_id    tenant_url                     is_active</span></span>
<span class="line"><span style="color:#6A737D;">---------    --------------------------     ---------</span></span>
<span class="line"><span style="color:#E1E4E8;">acme</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">corp    https:</span><span style="color:#F97583;">//</span><span style="color:#79B8FF;">acme</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">example</span><span style="color:#E1E4E8;">.com       </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">beta</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">inc     https:</span><span style="color:#F97583;">//</span><span style="color:#79B8FF;">beta</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">example</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">io</span><span style="color:#79B8FF;">        1</span></span>
<span class="line"><span style="color:#E1E4E8;">gamma</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">co     https:</span><span style="color:#F97583;">//</span><span style="color:#79B8FF;">custom</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">domain</span><span style="color:#E1E4E8;">.net      </span><span style="color:#79B8FF;">1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>Result:</strong></p><ul><li><code>acme.example.com</code> → acme-corp tenant</li><li><code>beta.example.io</code> → beta-inc tenant</li><li><code>custom.domain.net</code> → gamma-co tenant</li></ul><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><h3 id="dns-records-not-created" tabindex="-1">DNS Records Not Created <a class="header-anchor" href="#dns-records-not-created" aria-label="Permalink to &quot;DNS Records Not Created&quot;">​</a></h3><p><strong>Problem:</strong> DNS records don&#39;t appear in provider.</p><p><strong>Solution:</strong></p><ol><li><p><strong>Check ExternalDNS logs:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> kube-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app.kubernetes.io/name=external-dns</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>Verify Ingress has IP:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> ingress</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">tenant-ingres</span><span style="color:#E1E4E8;">s</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> jsonpath=&#39;{.status.loadBalancer.ingress[0].ip}&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>Check annotation syntax:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> ingress</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">tenant-ingres</span><span style="color:#E1E4E8;">s</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> grep</span><span style="color:#9ECBFF;"> external-dns</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>Verify domain filter:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> deployment</span><span style="color:#9ECBFF;"> external-dns</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> kube-system</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> grep</span><span style="color:#9ECBFF;"> domain-filter</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ol><h3 id="dns-records-not-deleted" tabindex="-1">DNS Records Not Deleted <a class="header-anchor" href="#dns-records-not-deleted" aria-label="Permalink to &quot;DNS Records Not Deleted&quot;">​</a></h3><p><strong>Problem:</strong> DNS records remain after tenant deletion.</p><p><strong>Solution:</strong></p><ol><li><p><strong>Check ExternalDNS policy:</strong></p><ul><li><code>policy=upsert-only</code> prevents deletion (change to <code>policy=sync</code>)</li><li><code>policy=sync</code> allows ExternalDNS to delete records</li></ul></li><li><p><strong>Check TXT records:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">dig</span><span style="color:#9ECBFF;"> TXT</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">tenant-domai</span><span style="color:#E1E4E8;">n</span><span style="color:#F97583;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>TXT records track ownership - if owner doesn&#39;t match, record won&#39;t be deleted.</p></li></ol><h3 id="dns-propagation-delays" tabindex="-1">DNS Propagation Delays <a class="header-anchor" href="#dns-propagation-delays" aria-label="Permalink to &quot;DNS Propagation Delays&quot;">​</a></h3><p><strong>Problem:</strong> DNS changes take too long to propagate.</p><p><strong>Solution:</strong></p><ol><li><p><strong>Reduce TTL:</strong></p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  external-dns.alpha.kubernetes.io/ttl</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;60&quot;</span><span style="color:#6A737D;">  # 1 minute</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p><strong>Check DNS propagation:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">dig</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">tenant-domai</span><span style="color:#E1E4E8;">n</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;"> @8.8.8.8</span></span>
<span class="line"><span style="color:#B392F0;">dig</span><span style="color:#F97583;"> &lt;</span><span style="color:#9ECBFF;">tenant-domai</span><span style="color:#E1E4E8;">n</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;"> @1.1.1.1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p><strong>Use DNS checker:</strong></p><ul><li><a href="https://dnschecker.org" target="_blank" rel="noreferrer">https://dnschecker.org</a></li><li><a href="https://www.whatsmydns.net" target="_blank" rel="noreferrer">https://www.whatsmydns.net</a></li></ul></li></ol><h2 id="best-practices" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices" aria-label="Permalink to &quot;Best Practices&quot;">​</a></h2><h3 id="_1-use-separate-hosted-zones" tabindex="-1">1. Use Separate Hosted Zones <a class="header-anchor" href="#_1-use-separate-hosted-zones" aria-label="Permalink to &quot;1. Use Separate Hosted Zones&quot;">​</a></h3><p>Use dedicated DNS zones for tenant subdomains:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Production tenants</span></span>
<span class="line"><span style="color:#E1E4E8;">--domain-filter</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">example.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Staging tenants</span></span>
<span class="line"><span style="color:#E1E4E8;">--domain-filter</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">staging.example.com</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-set-appropriate-ttls" tabindex="-1">2. Set Appropriate TTLs <a class="header-anchor" href="#_2-set-appropriate-ttls" aria-label="Permalink to &quot;2. Set Appropriate TTLs&quot;">​</a></h3><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  external-dns.alpha.kubernetes.io/ttl</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;300&quot;</span><span style="color:#6A737D;">  # 5 minutes (good for production)</span></span>
<span class="line"><span style="color:#6A737D;">  # external-dns.alpha.kubernetes.io/ttl: &quot;60&quot;  # 1 minute (good for testing)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-use-policy-upsert-only-for-safety" tabindex="-1">3. Use Policy: upsert-only for Safety <a class="header-anchor" href="#_3-use-policy-upsert-only-for-safety" aria-label="Permalink to &quot;3. Use Policy: upsert-only for Safety&quot;">​</a></h3><p>Prevent ExternalDNS from deleting existing records:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">helm</span><span style="color:#9ECBFF;"> install</span><span style="color:#9ECBFF;"> external-dns</span><span style="color:#9ECBFF;"> bitnami/external-dns</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#79B8FF;">  --set</span><span style="color:#9ECBFF;"> policy=upsert-only</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_4-monitor-externaldns-logs" tabindex="-1">4. Monitor ExternalDNS Logs <a class="header-anchor" href="#_4-monitor-externaldns-logs" aria-label="Permalink to &quot;4. Monitor ExternalDNS Logs&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> kube-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> app.kubernetes.io/name=external-dns</span><span style="color:#79B8FF;"> -f</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_5-combine-with-cert-manager" tabindex="-1">5. Combine with cert-manager <a class="header-anchor" href="#_5-combine-with-cert-manager" aria-label="Permalink to &quot;5. Combine with cert-manager&quot;">​</a></h3><p>Auto-provision SSL certificates with DNS challenge:</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">ingresses</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">- </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">secure-ingress</span></span>
<span class="line"><span style="color:#85E89D;">  nameTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-ingress&quot;</span></span>
<span class="line"><span style="color:#85E89D;">  annotationsTemplate</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    external-dns.alpha.kubernetes.io/hostname</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .host }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    cert-manager.io/cluster-issuer</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;letsencrypt-prod&quot;</span></span>
<span class="line"><span style="color:#85E89D;">  spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">    kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      tls</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">hosts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">&quot;{{ .host }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        secretName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-tls&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .host }}&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        http</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          paths</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#85E89D;">            pathType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="color:#85E89D;">            backend</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">              service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;{{ .uid }}-svc&quot;</span></span>
<span class="line"><span style="color:#85E89D;">                port</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">                  number</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="see-also" tabindex="-1">See Also <a class="header-anchor" href="#see-also" aria-label="Permalink to &quot;See Also&quot;">​</a></h2><ul><li><a href="https://github.com/kubernetes-sigs/external-dns" target="_blank" rel="noreferrer">ExternalDNS Documentation</a></li><li><a href="https://github.com/kubernetes-sigs/external-dns#status-of-providers" target="_blank" rel="noreferrer">ExternalDNS Provider List</a></li><li><a href="./templates.html">Tenant Operator Templates Guide</a></li><li><a href="https://cert-manager.io/docs/" target="_blank" rel="noreferrer">cert-manager Integration</a></li><li><a href="./integration-terraform-operator.html">Integration with Terraform Operator</a></li></ul>`,46))])}const B=c(d,[["render",b]]);export{D as __pageData,B as default};
