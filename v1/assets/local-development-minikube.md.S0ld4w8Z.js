import{_ as n,c as a,o as e,a2 as l}from"./chunks/framework.9Uv4PgnO.js";const d=JSON.parse('{"title":"Local Development with Minikube","description":"","frontmatter":{},"headers":[],"relativePath":"local-development-minikube.md","filePath":"local-development-minikube.md","lastUpdated":1761887194000}'),p={name:"local-development-minikube.md"};function o(r,s,t,i,c,u){return e(),a("div",null,[...s[0]||(s[0]=[l(`<h1 id="local-development-with-minikube" tabindex="-1">Local Development with Minikube <a class="header-anchor" href="#local-development-with-minikube" aria-label="Permalink to &quot;Local Development with Minikube&quot;">​</a></h1><p>Development workflow guide for contributing to and modifying Tenant Operator.</p><nav class="table-of-contents"><ul><li><a href="#overview">Overview</a></li><li><a href="#prerequisites">Prerequisites</a></li><li><a href="#development-workflow">Development Workflow</a><ul><li><a href="#typical-development-cycle">Typical Development Cycle</a></li></ul></li><li><a href="#code-changes-rebuilding">Code Changes &amp; Rebuilding</a><ul><li><a href="#quick-rebuild-and-deploy">Quick Rebuild and Deploy</a></li><li><a href="#custom-image-tag">Custom Image Tag</a></li><li><a href="#manual-build-if-needed">Manual Build (if needed)</a></li></ul></li><li><a href="#running-operator-locally-outside-cluster">Running Operator Locally (Outside Cluster)</a></li><li><a href="#debugging">Debugging</a><ul><li><a href="#debug-with-delve">Debug with Delve</a></li><li><a href="#debug-operator-logs">Debug Operator Logs</a></li><li><a href="#debug-test-resources">Debug Test Resources</a></li></ul></li><li><a href="#testing">Testing</a><ul><li><a href="#unit-tests">Unit Tests</a></li><li><a href="#integration-tests">Integration Tests</a></li><li><a href="#e2e-testing">E2E Testing</a></li></ul></li><li><a href="#tips-for-fast-iteration">Tips for Fast Iteration</a><ul><li><a href="#_1-skip-image-build-for-controller-changes">1. Skip Image Build for Controller Changes</a></li><li><a href="#_2-keep-logs-open">2. Keep Logs Open</a></li><li><a href="#_3-use-watch-commands">3. Use Watch Commands</a></li><li><a href="#_4-quick-mysql-queries">4. Quick MySQL Queries</a></li><li><a href="#_5-fast-context-switching">5. Fast Context Switching</a></li></ul></li><li><a href="#common-development-scenarios">Common Development Scenarios</a><ul><li><a href="#scenario-1-testing-template-changes">Scenario 1: Testing Template Changes</a></li><li><a href="#scenario-2-testing-database-sync">Scenario 2: Testing Database Sync</a></li><li><a href="#scenario-3-testing-crd-changes">Scenario 3: Testing CRD Changes</a></li><li><a href="#scenario-4-testing-webhook-validation">Scenario 4: Testing Webhook Validation</a></li></ul></li><li><a href="#cleanup">Cleanup</a><ul><li><a href="#partial-cleanup-keep-cluster">Partial Cleanup (Keep Cluster)</a></li><li><a href="#full-cleanup">Full Cleanup</a></li><li><a href="#fresh-start">Fresh Start</a></li></ul></li><li><a href="#troubleshooting">Troubleshooting</a><ul><li><a href="#operator-won-t-start">Operator Won&#39;t Start</a></li><li><a href="#tests-failing">Tests Failing</a></li><li><a href="#image-not-updating">Image Not Updating</a></li></ul></li><li><a href="#advanced-workflows">Advanced Workflows</a><ul><li><a href="#multiple-minikube-profiles">Multiple Minikube Profiles</a></li><li><a href="#custom-resource-allocations">Custom Resource Allocations</a></li></ul></li><li><a href="#see-also">See Also</a></li><li><a href="#summary">Summary</a></li></ul></nav><div class="tip custom-block"><p class="custom-block-title">Quick taste</p><p>If you only want to experience the operator, follow the <a href="./quickstart.html">Quick Start guide</a> instead.</p></div><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>This guide covers the <strong>development workflow</strong> for making code changes to Tenant Operator and testing them locally on Minikube.</p><p><strong>Use this guide when you want to:</strong></p><ul><li>✅ Modify Tenant Operator source code</li><li>✅ Add new features or fix bugs</li><li>✅ Test code changes locally before committing</li><li>✅ Debug the operator with breakpoints</li><li>✅ Iterate quickly on code changes</li></ul><p><strong>For initial setup:</strong> Follow the <a href="./quickstart.html">Quick Start guide</a> first to set up your Minikube environment.</p><h2 id="prerequisites" tabindex="-1">Prerequisites <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;Prerequisites&quot;">​</a></h2><div class="info custom-block"><p class="custom-block-title">Prerequisites</p><p>Complete the <a href="./quickstart.html">Quick Start guide</a> first. You should have:</p><ul><li>✅ Minikube cluster running (<code>tenant-operator</code> profile)</li><li>✅ Tenant Operator deployed</li><li>✅ MySQL test database (optional, for full testing)</li></ul></div><p>Additional development tools:</p><ul><li><strong>Go</strong> 1.22+</li><li><strong>make</strong></li><li><strong>golangci-lint</strong> (optional, for linting)</li><li><strong>delve</strong> (optional, for debugging)</li></ul><h2 id="development-workflow" tabindex="-1">Development Workflow <a class="header-anchor" href="#development-workflow" aria-label="Permalink to &quot;Development Workflow&quot;">​</a></h2><h3 id="typical-development-cycle" tabindex="-1">Typical Development Cycle <a class="header-anchor" href="#typical-development-cycle" aria-label="Permalink to &quot;Typical Development Cycle&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 1. Make code changes</span></span>
<span class="line"><span style="color:#B392F0;">vim</span><span style="color:#9ECBFF;"> internal/controller/tenant_controller.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 2. Run unit tests</span></span>
<span class="line"><span style="color:#B392F0;">make</span><span style="color:#9ECBFF;"> test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 3. Run linter</span></span>
<span class="line"><span style="color:#B392F0;">make</span><span style="color:#9ECBFF;"> lint</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 4. Build and deploy to Minikube</span></span>
<span class="line"><span style="color:#B392F0;">./scripts/deploy-to-minikube.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 5. View operator logs</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> control-plane=controller-manager</span><span style="color:#79B8FF;"> -f</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 6. Test changes</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> apply</span><span style="color:#79B8FF;"> -f</span><span style="color:#9ECBFF;"> config/samples/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 7. Verify results</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenants</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> all</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">ui</span><span style="color:#E1E4E8;">d</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 8. Repeat steps 1-7 as needed</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">Iteration speed</p><p>Expect roughly 1–2 minutes per build + deploy cycle when using the provided scripts.</p></div><h2 id="code-changes-rebuilding" tabindex="-1">Code Changes &amp; Rebuilding <a class="header-anchor" href="#code-changes-rebuilding" aria-label="Permalink to &quot;Code Changes &amp; Rebuilding&quot;">​</a></h2><h3 id="quick-rebuild-and-deploy" tabindex="-1">Quick Rebuild and Deploy <a class="header-anchor" href="#quick-rebuild-and-deploy" aria-label="Permalink to &quot;Quick Rebuild and Deploy&quot;">​</a></h3><p>After making code changes:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Rebuild and redeploy operator</span></span>
<span class="line"><span style="color:#B392F0;">./scripts/deploy-to-minikube.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>This script:</p><ol><li>Builds new Docker image with timestamp tag</li><li>Loads image into Minikube&#39;s internal registry</li><li>Updates operator deployment</li><li>Waits for readiness</li></ol><p><strong>Why timestamp tags?</strong> Each deployment gets a unique tag, preventing Kubernetes from using cached old images.</p><h3 id="custom-image-tag" tabindex="-1">Custom Image Tag <a class="header-anchor" href="#custom-image-tag" aria-label="Permalink to &quot;Custom Image Tag&quot;">​</a></h3><p>Use a custom tag for easier identification:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">IMG</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">tenant-operator:my-feature</span><span style="color:#B392F0;"> ./scripts/deploy-to-minikube.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="manual-build-if-needed" tabindex="-1">Manual Build (if needed) <a class="header-anchor" href="#manual-build-if-needed" aria-label="Permalink to &quot;Manual Build (if needed)&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Build binary locally</span></span>
<span class="line"><span style="color:#B392F0;">make</span><span style="color:#9ECBFF;"> build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Build Docker image</span></span>
<span class="line"><span style="color:#B392F0;">make</span><span style="color:#9ECBFF;"> docker-build</span><span style="color:#9ECBFF;"> IMG=tenant-operator:dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Load into Minikube</span></span>
<span class="line"><span style="color:#B392F0;">minikube</span><span style="color:#79B8FF;"> -p</span><span style="color:#9ECBFF;"> tenant-operator</span><span style="color:#9ECBFF;"> image</span><span style="color:#9ECBFF;"> load</span><span style="color:#9ECBFF;"> tenant-operator:dev</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="running-operator-locally-outside-cluster" tabindex="-1">Running Operator Locally (Outside Cluster) <a class="header-anchor" href="#running-operator-locally-outside-cluster" aria-label="Permalink to &quot;Running Operator Locally (Outside Cluster)&quot;">​</a></h2><p>For fastest iteration, run the operator locally on your machine while connecting to the Minikube cluster:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Ensure CRDs are installed</span></span>
<span class="line"><span style="color:#B392F0;">make</span><span style="color:#9ECBFF;"> install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Run operator locally</span></span>
<span class="line"><span style="color:#B392F0;">make</span><span style="color:#9ECBFF;"> run</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">Benefits</p><ul><li>✅ Instant restarts (no image build/load)</li><li>✅ Direct Go debugging with breakpoints</li><li>✅ Real-time logs in your terminal</li><li>✅ Fast feedback loop (~5 seconds)</li></ul></div><div class="warning custom-block"><p class="custom-block-title">Limitations</p><ul><li>⚠️ Webhooks unavailable (TLS requires in-cluster deployment)</li><li>⚠️ Runtime differs from production environment</li></ul></div><p><strong>When to use:</strong></p><ul><li>Controller logic changes</li><li>Quick iteration on reconciliation loops</li><li>Debugging with delve</li></ul><p><strong>When NOT to use:</strong></p><ul><li>Testing webhooks</li><li>Verifying in-cluster networking</li><li>Final testing before PR</li></ul><p><strong>Testing with local run:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Terminal 1: Run operator</span></span>
<span class="line"><span style="color:#B392F0;">make</span><span style="color:#9ECBFF;"> run</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Terminal 2: Apply resources</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> apply</span><span style="color:#79B8FF;"> -f</span><span style="color:#9ECBFF;"> config/samples/</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenants</span><span style="color:#79B8FF;"> --watch</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Terminal 3: View database changes</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> exec</span><span style="color:#79B8FF;"> -it</span><span style="color:#9ECBFF;"> deployment/mysql</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-test</span><span style="color:#79B8FF;"> --</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#9ECBFF;">  mysql</span><span style="color:#79B8FF;"> -u</span><span style="color:#9ECBFF;"> tenant_reader</span><span style="color:#79B8FF;"> -p</span><span style="color:#9ECBFF;"> tenants</span><span style="color:#79B8FF;"> -e</span><span style="color:#9ECBFF;"> &quot;SELECT * FROM tenant_configs;&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="debugging" tabindex="-1">Debugging <a class="header-anchor" href="#debugging" aria-label="Permalink to &quot;Debugging&quot;">​</a></h2><h3 id="debug-with-delve" tabindex="-1">Debug with Delve <a class="header-anchor" href="#debug-with-delve" aria-label="Permalink to &quot;Debug with Delve&quot;">​</a></h3><p>Run operator with debugger:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Install delve if needed</span></span>
<span class="line"><span style="color:#B392F0;">go</span><span style="color:#9ECBFF;"> install</span><span style="color:#9ECBFF;"> github.com/go-delve/delve/cmd/dlv@latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Run with delve</span></span>
<span class="line"><span style="color:#B392F0;">dlv</span><span style="color:#9ECBFF;"> debug</span><span style="color:#9ECBFF;"> ./cmd/main.go</span><span style="color:#79B8FF;"> --</span><span style="color:#79B8FF;"> --zap-devel=true</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Then in delve:</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>(dlv) break internal/controller/tenant_controller.go:123</span></span>
<span class="line"><span>(dlv) continue</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="debug-operator-logs" tabindex="-1">Debug Operator Logs <a class="header-anchor" href="#debug-operator-logs" aria-label="Permalink to &quot;Debug Operator Logs&quot;">​</a></h3><p>View operator logs with different verbosity:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Default logs</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> control-plane=controller-manager</span><span style="color:#79B8FF;"> -f</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Filter for specific tenant</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> control-plane=controller-manager</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> grep</span><span style="color:#9ECBFF;"> acme-corp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Follow logs for errors only</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> control-plane=controller-manager</span><span style="color:#79B8FF;"> -f</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> grep</span><span style="color:#79B8FF;"> -i</span><span style="color:#9ECBFF;"> error</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># View logs from previous crash</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> control-plane=controller-manager</span><span style="color:#79B8FF;"> --previous</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="debug-test-resources" tabindex="-1">Debug Test Resources <a class="header-anchor" href="#debug-test-resources" aria-label="Permalink to &quot;Debug Test Resources&quot;">​</a></h3><p>View what the operator sees:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Check Tenant CR status</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#9ECBFF;"> acme-corp-test-template</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check registry sync status</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenantregistry</span><span style="color:#9ECBFF;"> test-registry</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> yq</span><span style="color:#9ECBFF;"> &#39;.status&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check template</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenanttemplate</span><span style="color:#9ECBFF;"> test-template</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># View events</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> events</span><span style="color:#79B8FF;"> --sort-by=</span><span style="color:#9ECBFF;">&#39;.lastTimestamp&#39;</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Describe resource for events</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> describe</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#9ECBFF;"> acme-corp-test-template</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="testing" tabindex="-1">Testing <a class="header-anchor" href="#testing" aria-label="Permalink to &quot;Testing&quot;">​</a></h2><h3 id="unit-tests" tabindex="-1">Unit Tests <a class="header-anchor" href="#unit-tests" aria-label="Permalink to &quot;Unit Tests&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Run all tests</span></span>
<span class="line"><span style="color:#B392F0;">make</span><span style="color:#9ECBFF;"> test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Run with coverage</span></span>
<span class="line"><span style="color:#B392F0;">make</span><span style="color:#9ECBFF;"> test-coverage</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Run specific package</span></span>
<span class="line"><span style="color:#B392F0;">go</span><span style="color:#9ECBFF;"> test</span><span style="color:#9ECBFF;"> ./internal/controller/...</span><span style="color:#79B8FF;"> -v</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Run specific test</span></span>
<span class="line"><span style="color:#B392F0;">go</span><span style="color:#9ECBFF;"> test</span><span style="color:#9ECBFF;"> ./internal/controller/</span><span style="color:#79B8FF;"> -run</span><span style="color:#9ECBFF;"> TestTenantController_Reconcile</span><span style="color:#79B8FF;"> -v</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="integration-tests" tabindex="-1">Integration Tests <a class="header-anchor" href="#integration-tests" aria-label="Permalink to &quot;Integration Tests&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Requires running Minikube cluster</span></span>
<span class="line"><span style="color:#B392F0;">make</span><span style="color:#9ECBFF;"> test-integration</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="e2e-testing" tabindex="-1">E2E Testing <a class="header-anchor" href="#e2e-testing" aria-label="Permalink to &quot;E2E Testing&quot;">​</a></h3><p>Test complete workflow:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 1. Deploy fresh operator</span></span>
<span class="line"><span style="color:#B392F0;">./scripts/deploy-to-minikube.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 2. Deploy test database</span></span>
<span class="line"><span style="color:#B392F0;">./scripts/deploy-mysql.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 3. Deploy test registry and template</span></span>
<span class="line"><span style="color:#B392F0;">./scripts/deploy-tenantregistry.sh</span></span>
<span class="line"><span style="color:#B392F0;">./scripts/deploy-tenanttemplate.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 4. Verify tenants created</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenants</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> deployments,services</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> kubernetes-tenants.org/tenant</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 5. Test lifecycle: Add tenant</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> exec</span><span style="color:#79B8FF;"> -it</span><span style="color:#9ECBFF;"> deployment/mysql</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-test</span><span style="color:#79B8FF;"> --</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#9ECBFF;">  mysql</span><span style="color:#79B8FF;"> -u</span><span style="color:#9ECBFF;"> root</span><span style="color:#79B8FF;"> -p</span><span style="color:#9ECBFF;"> tenants</span><span style="color:#79B8FF;"> -e</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;INSERT INTO tenant_configs VALUES (&#39;delta-co&#39;, &#39;https://delta.example.com&#39;, 1, &#39;enterprise&#39;);&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Wait 30s, then verify</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#9ECBFF;"> delta-co-test-template</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 6. Test lifecycle: Deactivate tenant</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> exec</span><span style="color:#79B8FF;"> -it</span><span style="color:#9ECBFF;"> deployment/mysql</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-test</span><span style="color:#79B8FF;"> --</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#9ECBFF;">  mysql</span><span style="color:#79B8FF;"> -u</span><span style="color:#9ECBFF;"> root</span><span style="color:#79B8FF;"> -p</span><span style="color:#9ECBFF;"> tenants</span><span style="color:#79B8FF;"> -e</span><span style="color:#79B8FF;"> \\</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;UPDATE tenant_configs SET is_active = 0 WHERE tenant_id = &#39;acme-corp&#39;;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Wait 30s, then verify deletion</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#9ECBFF;"> acme-corp-test-template</span></span>
<span class="line"><span style="color:#6A737D;"># Should be NotFound</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h2 id="tips-for-fast-iteration" tabindex="-1">Tips for Fast Iteration <a class="header-anchor" href="#tips-for-fast-iteration" aria-label="Permalink to &quot;Tips for Fast Iteration&quot;">​</a></h2><h3 id="_1-skip-image-build-for-controller-changes" tabindex="-1">1. Skip Image Build for Controller Changes <a class="header-anchor" href="#_1-skip-image-build-for-controller-changes" aria-label="Permalink to &quot;1. Skip Image Build for Controller Changes&quot;">​</a></h3><p>If only changing controller logic (not CRDs, RBAC, etc.):</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Run locally instead of deploying</span></span>
<span class="line"><span style="color:#B392F0;">make</span><span style="color:#9ECBFF;"> run</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>~10x faster</strong> than full build/deploy cycle.</p><h3 id="_2-keep-logs-open" tabindex="-1">2. Keep Logs Open <a class="header-anchor" href="#_2-keep-logs-open" aria-label="Permalink to &quot;2. Keep Logs Open&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># In a dedicated terminal</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> control-plane=controller-manager</span><span style="color:#79B8FF;"> -f</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3-use-watch-commands" tabindex="-1">3. Use Watch Commands <a class="header-anchor" href="#_3-use-watch-commands" aria-label="Permalink to &quot;3. Use Watch Commands&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Watch tenants</span></span>
<span class="line"><span style="color:#B392F0;">watch</span><span style="color:#9ECBFF;"> kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenants</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Watch specific tenant</span></span>
<span class="line"><span style="color:#B392F0;">watch</span><span style="color:#9ECBFF;"> kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#9ECBFF;"> acme-corp-test-template</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_4-quick-mysql-queries" tabindex="-1">4. Quick MySQL Queries <a class="header-anchor" href="#_4-quick-mysql-queries" aria-label="Permalink to &quot;4. Quick MySQL Queries&quot;">​</a></h3><p>Create aliases:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">alias</span><span style="color:#E1E4E8;"> mysql-test</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;kubectl exec -it deployment/mysql -n tenant-operator-test -- mysql -u tenant_reader -p$(kubectl get secret mysql-credentials -n tenant-operator-test -o jsonpath=&quot;{.data.password}&quot; | base64 -d) tenants&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Then use:</span></span>
<span class="line"><span style="color:#B392F0;">mysql-test</span><span style="color:#79B8FF;"> -e</span><span style="color:#9ECBFF;"> &quot;SELECT * FROM tenant_configs;&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_5-fast-context-switching" tabindex="-1">5. Fast Context Switching <a class="header-anchor" href="#_5-fast-context-switching" aria-label="Permalink to &quot;5. Fast Context Switching&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Add to ~/.zshrc or ~/.bashrc</span></span>
<span class="line"><span style="color:#F97583;">alias</span><span style="color:#E1E4E8;"> kto</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;kubectl config use-context tenant-operator&#39;</span></span>
<span class="line"><span style="color:#F97583;">alias</span><span style="color:#E1E4E8;"> ktos</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;kubectl -n tenant-operator-system&#39;</span></span>
<span class="line"><span style="color:#F97583;">alias</span><span style="color:#E1E4E8;"> ktot</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;kubectl -n tenant-operator-test&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Usage:</span></span>
<span class="line"><span style="color:#B392F0;">kto</span><span style="color:#6A737D;">  # Switch to tenant-operator context</span></span>
<span class="line"><span style="color:#B392F0;">ktos</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> pods</span><span style="color:#6A737D;">  # Get pods in operator namespace</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="common-development-scenarios" tabindex="-1">Common Development Scenarios <a class="header-anchor" href="#common-development-scenarios" aria-label="Permalink to &quot;Common Development Scenarios&quot;">​</a></h2><h3 id="scenario-1-testing-template-changes" tabindex="-1">Scenario 1: Testing Template Changes <a class="header-anchor" href="#scenario-1-testing-template-changes" aria-label="Permalink to &quot;Scenario 1: Testing Template Changes&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 1. Modify template logic in tenant_controller.go</span></span>
<span class="line"><span style="color:#B392F0;">vim</span><span style="color:#9ECBFF;"> internal/controller/tenant_controller.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 2. Run locally for quick feedback</span></span>
<span class="line"><span style="color:#B392F0;">make</span><span style="color:#9ECBFF;"> run</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 3. In another terminal, apply test template</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> apply</span><span style="color:#79B8FF;"> -f</span><span style="color:#9ECBFF;"> config/samples/operator_v1_tenanttemplate.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 4. Watch logs and verify rendered resources</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> control-plane=controller-manager</span><span style="color:#79B8FF;"> -f</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> grep</span><span style="color:#79B8FF;"> -A</span><span style="color:#79B8FF;"> 10</span><span style="color:#9ECBFF;"> &quot;spec:&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="scenario-2-testing-database-sync" tabindex="-1">Scenario 2: Testing Database Sync <a class="header-anchor" href="#scenario-2-testing-database-sync" aria-label="Permalink to &quot;Scenario 2: Testing Database Sync&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 1. Modify registry controller</span></span>
<span class="line"><span style="color:#B392F0;">vim</span><span style="color:#9ECBFF;"> internal/controller/tenantregistry_controller.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 2. Deploy to test in-cluster</span></span>
<span class="line"><span style="color:#B392F0;">./scripts/deploy-to-minikube.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 3. Change database and watch sync</span></span>
<span class="line"><span style="color:#B392F0;">mysql-test</span><span style="color:#79B8FF;"> -e</span><span style="color:#9ECBFF;"> &quot;UPDATE tenant_configs SET subscription_plan = &#39;premium&#39; WHERE tenant_id = &#39;acme-corp&#39;;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 4. Verify Tenant CR updated</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> tenant</span><span style="color:#9ECBFF;"> acme-corp-test-template</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> yaml</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> grep</span><span style="color:#9ECBFF;"> planId</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="scenario-3-testing-crd-changes" tabindex="-1">Scenario 3: Testing CRD Changes <a class="header-anchor" href="#scenario-3-testing-crd-changes" aria-label="Permalink to &quot;Scenario 3: Testing CRD Changes&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 1. Modify CRD in api/v1/</span></span>
<span class="line"><span style="color:#B392F0;">vim</span><span style="color:#9ECBFF;"> api/v1/tenant_types.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 2. Regenerate manifests</span></span>
<span class="line"><span style="color:#B392F0;">make</span><span style="color:#9ECBFF;"> manifests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 3. Install updated CRDs</span></span>
<span class="line"><span style="color:#B392F0;">make</span><span style="color:#9ECBFF;"> install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 4. Rebuild and deploy operator</span></span>
<span class="line"><span style="color:#B392F0;">./scripts/deploy-to-minikube.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 5. Test with updated CRD</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> apply</span><span style="color:#79B8FF;"> -f</span><span style="color:#9ECBFF;"> config/samples/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="scenario-4-testing-webhook-validation" tabindex="-1">Scenario 4: Testing Webhook Validation <a class="header-anchor" href="#scenario-4-testing-webhook-validation" aria-label="Permalink to &quot;Scenario 4: Testing Webhook Validation&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 1. Modify webhook in api/v1/*_webhook.go</span></span>
<span class="line"><span style="color:#B392F0;">vim</span><span style="color:#9ECBFF;"> api/v1/tenanttemplate_webhook.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 2. Must deploy to cluster (webhooks need TLS)</span></span>
<span class="line"><span style="color:#B392F0;">./scripts/deploy-to-minikube.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 3. Test invalid resource</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> apply</span><span style="color:#79B8FF;"> -f</span><span style="color:#9ECBFF;"> -</span><span style="color:#F97583;"> &lt;&lt;</span><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"><span style="color:#9ECBFF;">apiVersion: operator.kubernetes-tenants.org/v1</span></span>
<span class="line"><span style="color:#9ECBFF;">kind: TenantTemplate</span></span>
<span class="line"><span style="color:#9ECBFF;">metadata:</span></span>
<span class="line"><span style="color:#9ECBFF;">  name: invalid-template</span></span>
<span class="line"><span style="color:#9ECBFF;">spec:</span></span>
<span class="line"><span style="color:#9ECBFF;">  registryId: non-existent-registry  # Should fail validation</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 4. Should see validation error</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="cleanup" tabindex="-1">Cleanup <a class="header-anchor" href="#cleanup" aria-label="Permalink to &quot;Cleanup&quot;">​</a></h2><h3 id="partial-cleanup-keep-cluster" tabindex="-1">Partial Cleanup (Keep Cluster) <a class="header-anchor" href="#partial-cleanup-keep-cluster" aria-label="Permalink to &quot;Partial Cleanup (Keep Cluster)&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Delete test resources</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> delete</span><span style="color:#9ECBFF;"> tenants</span><span style="color:#79B8FF;"> --all</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> delete</span><span style="color:#9ECBFF;"> tenanttemplate</span><span style="color:#9ECBFF;"> test-template</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> delete</span><span style="color:#9ECBFF;"> tenantregistry</span><span style="color:#9ECBFF;"> test-registry</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Delete MySQL</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> delete</span><span style="color:#9ECBFF;"> deployment,service,pvc</span><span style="color:#9ECBFF;"> mysql</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Delete operator</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> delete</span><span style="color:#9ECBFF;"> deployment</span><span style="color:#9ECBFF;"> tenant-operator-controller-manager</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="full-cleanup" tabindex="-1">Full Cleanup <a class="header-anchor" href="#full-cleanup" aria-label="Permalink to &quot;Full Cleanup&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Delete everything including cluster</span></span>
<span class="line"><span style="color:#B392F0;">./scripts/cleanup-minikube.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Answer &#39;y&#39; to all prompts for complete cleanup</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="fresh-start" tabindex="-1">Fresh Start <a class="header-anchor" href="#fresh-start" aria-label="Permalink to &quot;Fresh Start&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Complete reset</span></span>
<span class="line"><span style="color:#B392F0;">./scripts/cleanup-minikube.sh</span><span style="color:#6A737D;">  # Delete everything</span></span>
<span class="line"><span style="color:#B392F0;">./scripts/setup-minikube.sh</span><span style="color:#6A737D;">    # Recreate cluster</span></span>
<span class="line"><span style="color:#B392F0;">./scripts/deploy-to-minikube.sh</span><span style="color:#6A737D;">  # Deploy operator</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><h3 id="operator-won-t-start" tabindex="-1">Operator Won&#39;t Start <a class="header-anchor" href="#operator-won-t-start" aria-label="Permalink to &quot;Operator Won&#39;t Start&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Check pod status</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> pods</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check logs</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#79B8FF;"> -l</span><span style="color:#9ECBFF;"> control-plane=controller-manager</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Common issues:</span></span>
<span class="line"><span style="color:#6A737D;"># - cert-manager not ready: kubectl get pods -n cert-manager</span></span>
<span class="line"><span style="color:#6A737D;"># - Image not loaded: minikube -p tenant-operator image ls | grep tenant-operator</span></span>
<span class="line"><span style="color:#6A737D;"># - CRDs not installed: kubectl get crd | grep tenant</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="tests-failing" tabindex="-1">Tests Failing <a class="header-anchor" href="#tests-failing" aria-label="Permalink to &quot;Tests Failing&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Ensure test cluster is accessible</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> cluster-info</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Check if CRDs are installed</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> crd</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> grep</span><span style="color:#9ECBFF;"> tenant</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Run tests with verbose output</span></span>
<span class="line"><span style="color:#B392F0;">go</span><span style="color:#9ECBFF;"> test</span><span style="color:#9ECBFF;"> ./...</span><span style="color:#79B8FF;"> -v</span><span style="color:#79B8FF;"> -count=1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="image-not-updating" tabindex="-1">Image Not Updating <a class="header-anchor" href="#image-not-updating" aria-label="Permalink to &quot;Image Not Updating&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Force rebuild without cache</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#9ECBFF;"> build</span><span style="color:#79B8FF;"> --no-cache</span><span style="color:#79B8FF;"> -t</span><span style="color:#9ECBFF;"> tenant-operator:dev</span><span style="color:#9ECBFF;"> .</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Reload into Minikube</span></span>
<span class="line"><span style="color:#B392F0;">minikube</span><span style="color:#79B8FF;"> -p</span><span style="color:#9ECBFF;"> tenant-operator</span><span style="color:#9ECBFF;"> image</span><span style="color:#9ECBFF;"> load</span><span style="color:#9ECBFF;"> tenant-operator:dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Restart operator pod</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> rollout</span><span style="color:#9ECBFF;"> restart</span><span style="color:#9ECBFF;"> deployment</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> tenant-operator-system</span><span style="color:#9ECBFF;"> tenant-operator-controller-manager</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="advanced-workflows" tabindex="-1">Advanced Workflows <a class="header-anchor" href="#advanced-workflows" aria-label="Permalink to &quot;Advanced Workflows&quot;">​</a></h2><h3 id="multiple-minikube-profiles" tabindex="-1">Multiple Minikube Profiles <a class="header-anchor" href="#multiple-minikube-profiles" aria-label="Permalink to &quot;Multiple Minikube Profiles&quot;">​</a></h3><p>Work on multiple features simultaneously:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Feature A cluster</span></span>
<span class="line"><span style="color:#E1E4E8;">MINIKUBE_PROFILE</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">feature-a</span><span style="color:#B392F0;"> ./scripts/setup-minikube.sh</span></span>
<span class="line"><span style="color:#E1E4E8;">MINIKUBE_PROFILE</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">feature-a</span><span style="color:#B392F0;"> ./scripts/deploy-to-minikube.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Feature B cluster</span></span>
<span class="line"><span style="color:#E1E4E8;">MINIKUBE_PROFILE</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">feature-b</span><span style="color:#B392F0;"> ./scripts/setup-minikube.sh</span></span>
<span class="line"><span style="color:#E1E4E8;">MINIKUBE_PROFILE</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">feature-b</span><span style="color:#B392F0;"> ./scripts/deploy-to-minikube.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Switch between them</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> config</span><span style="color:#9ECBFF;"> use-context</span><span style="color:#9ECBFF;"> feature-a</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> config</span><span style="color:#9ECBFF;"> use-context</span><span style="color:#9ECBFF;"> feature-b</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="custom-resource-allocations" tabindex="-1">Custom Resource Allocations <a class="header-anchor" href="#custom-resource-allocations" aria-label="Permalink to &quot;Custom Resource Allocations&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># More powerful cluster for load testing</span></span>
<span class="line"><span style="color:#E1E4E8;">MINIKUBE_CPUS</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">8</span><span style="color:#B392F0;"> \\</span></span>
<span class="line"><span style="color:#E1E4E8;">MINIKUBE_MEMORY=16384 </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">./scripts/setup-minikube.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="see-also" tabindex="-1">See Also <a class="header-anchor" href="#see-also" aria-label="Permalink to &quot;See Also&quot;">​</a></h2><ul><li><a href="./quickstart.html">Quick Start</a> - Initial setup guide</li><li><a href="./development.html">Development Guide</a> - General development practices</li><li><a href="https://github.com/kubernetes-tenants/tenant-operator/blob/main/CONTRIBUTING.md" target="_blank" rel="noreferrer">Contributing</a> - Contribution guidelines</li><li><a href="./troubleshooting.html">Troubleshooting</a> - Common issues</li></ul><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">​</a></h2><p><strong>Fast iteration workflow:</strong></p><ol><li>Make code changes</li><li>Run <code>make run</code> for controller changes (5s feedback)</li><li>Or run <code>./scripts/deploy-to-minikube.sh</code> for full testing (2min)</li><li>Test with <code>kubectl apply -f config/samples/</code></li><li>Iterate</li></ol><p><strong>Key takeaways:</strong></p><ul><li>Use <code>make run</code> for fastest iteration (no webhooks)</li><li>Use <code>./scripts/deploy-to-minikube.sh</code> for full testing (with webhooks)</li><li>Keep logs open in a separate terminal</li><li>Test E2E with real MySQL database</li><li>Clean up and reset when needed</li></ul><p>Happy coding! 🚀</p>`,111)])])}const y=n(p,[["render",o]]);export{d as __pageData,y as default};
